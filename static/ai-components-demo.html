<!DOCTYPE html>
<html lang="fr">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>D√©mo Composants IA - Crypto Rebalancing</title>

    <!-- Styles -->
    <link rel="stylesheet" href="shared-theme.css">
    <link rel="stylesheet" href="theme-compat.css">
    <link rel="stylesheet" href="simple-navigation.css">
    <script src="simple-navigation.js"></script>
    <link rel="stylesheet" href="navigation-fix.css">
    <link rel="stylesheet" href="ai-components.css">
    <style>
        /* Styles sp√©cifiques √† la d√©mo */
        body {
            margin: 0;
            padding: 0;
            font-family: system-ui, -apple-system, 'Segoe UI', Roboto, Arial, sans-serif;
            background: var(--theme-background);
            color: var(--theme-text);
            min-height: 100vh;
        }

        /* Ajustement pour navigation simple (80px) */
        body.has-simple-nav {
            margin-left: 80px;
        }

        .demo-container {
            padding: 2rem;
            min-height: 100vh;
            transition: margin-left 0.3s ease;
        }

        /* Responsive pour mobile */
        @media (max-width: 768px) {
            body.has-simple-nav {
                margin-left: 0;
            }
        }

        .demo-header {
            background: var(--theme-surface);
            border: 1px solid var(--theme-border);
            border-radius: var(--radius-lg);
            padding: 2rem;
            margin-bottom: 2rem;
            box-shadow: var(--shadow-sm);
        }

        .demo-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: var(--brand-primary);
            margin: 0 0 0.5rem 0;
        }

        .demo-subtitle {
            font-size: 1.25rem;
            color: var(--theme-text-muted);
            margin: 0 0 1rem 0;
        }

        .demo-controls {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
        }

        .demo-btn {
            padding: 0.75rem 1.5rem;
            background: var(--brand-primary);
            color: white;
            border: none;
            border-radius: var(--radius-md);
            font-weight: 600;
            cursor: pointer;
            transition: all var(--transition-normal);
            box-shadow: var(--shadow-sm);
        }

        .demo-btn:hover {
            background: var(--brand-primary-hover);
            transform: translateY(-2px);
            box-shadow: var(--shadow-lg);
        }

        .demo-section {
            margin-bottom: 3rem;
        }

        .section-title {
            font-size: 1.75rem;
            font-weight: 700;
            color: var(--theme-text);
            margin: 0 0 1.5rem 0;
        }

        .components-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(400px, 1fr));
            gap: 2rem;
        }

        .components-grid.single-column {
            grid-template-columns: 1fr;
        }

        .demo-stats {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            padding: 1.5rem;
            color: white;
            margin-bottom: 2rem;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
        }

        .stat-item {
            text-align: center;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 800;
            margin-bottom: 0.25rem;
        }

        .stat-label {
            font-size: 0.875rem;
            opacity: 0.8;
        }

        @media (max-width: 768px) {
            .demo-container {
                margin-left: 0;
                padding: 1rem;
            }

            .demo-title {
                font-size: 2rem;
            }

            .components-grid {
                grid-template-columns: 1fr;
                gap: 1rem;
            }
        }

        /* Animation de chargement */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            z-index: 10000;
            transition: opacity 0.5s ease-out;
        }

        .loading-overlay.hidden {
            opacity: 0;
            pointer-events: none;
        }

        .loading-spinner {
            width: 60px;
            height: 60px;
            border: 4px solid rgba(255, 255, 255, 0.3);
            border-top-color: white;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 2rem;
        }

        @keyframes spin {
            to {
                transform: rotate(360deg);
            }
        }

        .loading-text {
            font-size: 1.5rem;
            font-weight: 600;
            margin-bottom: 0.5rem;
        }

        .loading-subtext {
            opacity: 0.8;
        }
    </style>
</head>

<body>
    <!-- Overlay de chargement -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Initialisation des services IA</div>
        <div class="loading-subtext">Connexion aux mod√®les de pr√©diction...</div>
    </div>


    <!-- Contenu principal -->
    <main class="demo-container">
        <!-- En-t√™te de la d√©mo -->
        <header class="demo-header">
            <h1 class="demo-title">ü§ñ Composants IA R√©utilisables</h1>
            <p class="demo-subtitle">
                D√©monstration interactive des composants frontend pour les services d'intelligence artificielle
            </p>
            <div class="demo-controls">
                <button class="demo-btn" onclick="forceUpdateAll()">
                    üîÑ Actualiser Tout
                </button>
                <button class="demo-btn" onclick="toggleRealTime()">
                    ‚èØÔ∏è <span id="realtimeToggle">Temps R√©el</span>
                </button>
                <button class="demo-btn" onclick="showStats()">
                    üìä Statistiques
                </button>
                <button class="demo-btn" onclick="addRandomSymbol()">
                    ‚ûï Ajouter Symbole
                </button>
            </div>
        </header>

        <!-- Statistiques en temps r√©el -->
        <div class="demo-stats" id="statsContainer" style="display: none;">
            <h3>üìà Statistiques du Syst√®me IA</h3>
            <div class="stats-grid">
                <div class="stat-item">
                    <div class="stat-value" id="cacheHits">--</div>
                    <div class="stat-label">Cache Hits</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="apiCalls">--</div>
                    <div class="stat-label">API Calls</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="activeComponents">--</div>
                    <div class="stat-label">Composants Actifs</div>
                </div>
                <div class="stat-item">
                    <div class="stat-value" id="lastUpdate">--</div>
                    <div class="stat-label">Derni√®re MAJ</div>
                </div>
            </div>
        </div>

        <!-- Section Pr√©dictions -->
        <section class="demo-section">
            <h2 class="section-title">üîÆ Pr√©dictions de Volatilit√©</h2>
            <div class="components-grid">
                <volatility-display symbol="BTC" horizon="24" auto-update></volatility-display>
                <volatility-display symbol="ETH" horizon="24" auto-update></volatility-display>
            </div>
        </section>

        <!-- Section R√©gime de March√© -->
        <section class="demo-section">
            <h2 class="section-title">üéØ Analyse de March√©</h2>
            <div class="components-grid">
                <market-regime-display></market-regime-display>
                <sentiment-indicator symbol="BTC"></sentiment-indicator>
            </div>
        </section>

        <!-- Section Corr√©lations -->
        <section class="demo-section">
            <h2 class="section-title">üîó Matrice de Corr√©lation</h2>
            <div class="components-grid single-column">
                <correlation-matrix symbols="BTC,ETH,ADA,DOT,LINK,UNI"></correlation-matrix>
            </div>
        </section>

        <!-- Section Sentiment Compact -->
        <section class="demo-section">
            <h2 class="section-title">üí≠ Indicateurs de Sentiment</h2>
            <div class="components-grid">
                <sentiment-indicator symbol="ETH" compact></sentiment-indicator>
                <sentiment-indicator symbol="ADA" compact></sentiment-indicator>
                <sentiment-indicator symbol="DOT" compact></sentiment-indicator>
                <sentiment-indicator symbol="LINK" compact></sentiment-indicator>
            </div>
        </section>

        <!-- Section R√©√©quilibrage -->
        <section class="demo-section">
            <h2 class="section-title">‚öñÔ∏è Suggestions de R√©√©quilibrage</h2>
            <div class="components-grid single-column">
                <rebalancing-suggestions></rebalancing-suggestions>
            </div>
        </section>
    </main>

    <!-- Scripts -->
    <script src="ai-services.js"></script>
    <script src="ai-state-manager.js"></script>
    <script src="ai-components.js"></script>

    <script>
        // Variables globales pour la d√©mo
        let realTimeEnabled = true;
        let statsVisible = false;

        // Symboles disponibles pour la d√©mo
        const availableSymbols = ['BTC', 'ETH', 'ADA', 'DOT', 'LINK', 'UNI', 'MATIC', 'ATOM', 'AVAX', 'SOL'];

        /**
         * Initialisation de la d√©mo
         */
        async function initializeDemo() {
            console.log('üöÄ Initializing AI Components Demo...');

            try {
                // Appliquer le th√®me
                if (window.globalConfig && window.globalConfig.applyTheme) {
                    window.globalConfig.applyTheme();
                }
                if (window.applyAppearance) {
                    window.applyAppearance();
                }

                // Cr√©er la navigation simple
                if (typeof createSimpleNavigation !== 'undefined') {
                    createSimpleNavigation('ai-components-demo');
                }

                // Attendre l'initialisation des services IA
                await waitForAIServices();

                // Initialiser les composants IA
                window.AIComponents.initializeAll();

                // Configurer les √©v√©nements
                setupEventListeners();

                // Masquer l'overlay de chargement
                hideLoadingOverlay();

                console.log('‚úÖ AI Components Demo initialized successfully');

            } catch (error) {
                console.error('‚ùå Demo initialization failed:', error);
                showError('Erreur d\'initialisation: ' + error.message);
            }
        }

        /**
         * Attendre que les services IA soient pr√™ts ou simuler leur fonctionnement
         */
        async function waitForAIServices() {
            return new Promise((resolve, reject) => {
                let attempts = 0;
                const maxAttempts = 10; // 5 secondes maximum

                const checkServices = () => {
                    attempts++;

                    if (window.aiServiceManager && window.aiStateManager &&
                        window.aiServiceManager.isInitialized && window.aiStateManager.isInitialized) {
                        resolve();
                    } else if (attempts >= maxAttempts) {
                        console.warn('‚ö†Ô∏è AI Services timeout - creating fallback services');
                        createFallbackServices();
                        resolve();
                    } else {
                        setTimeout(checkServices, 500);
                    }
                };
                checkServices();
            });
        }

        /**
         * Cr√©er des services IA simul√©s
         */
        function createFallbackServices() {
            // Service manager simul√©
            window.aiServiceManager = {
                isInitialized: true,
                getService: (name) => ({
                    predict: () => Promise.resolve({ value: Math.random() * 100, confidence: 0.75 }),
                    getRegime: () => Promise.resolve({ type: 'BULL', confidence: 0.82 }),
                    getSentiment: () => Promise.resolve({ score: 0.6, label: 'NEUTRAL' })
                })
            };

            // State manager simul√©
            window.aiStateManager = {
                isInitialized: true,
                on: (event, callback) => console.log(`Event listener registered: ${event}`),
                forceUpdate: () => Promise.resolve(),
                resumeUpdates: () => console.log('Updates resumed'),
                pauseUpdates: () => console.log('Updates paused'),
                getStats: () => ({
                    cacheHits: Math.floor(Math.random() * 1000),
                    apiCalls: Math.floor(Math.random() * 500),
                    lastUpdate: Date.now()
                }),
                getTrackedSymbols: () => ['BTC', 'ETH', 'ADA', 'DOT', 'LINK', 'UNI'],
                addTrackedSymbol: (symbol) => console.log(`Added ${symbol} to tracking`)
            };

            // Composants IA simul√©s
            window.AIComponents = {
                initializeAll: () => {
                    console.log('ü§ñ Initialized fallback AI components');
                    // Cr√©er des composants simul√©s
                    document.querySelectorAll('volatility-display, market-regime-display, correlation-matrix, sentiment-indicator, rebalancing-suggestions').forEach(comp => {
                        comp.innerHTML = `
                            <div style="background: rgba(255, 165, 0, 0.1); border: 1px solid #ffa500; border-radius: 8px; padding: 1rem; text-align: center;">
                                <div style="color: #ffa500; font-weight: bold; margin-bottom: 0.5rem;">‚ö†Ô∏è Demo Mode</div>
                                <div style="opacity: 0.8; font-size: 0.9rem;">AI service simulation active</div>
                            </div>
                        `;
                    });
                },
                create: (type, attrs) => {
                    const element = document.createElement('div');
                    element.innerHTML = `
                        <div style="background: rgba(255, 165, 0, 0.1); border: 1px solid #ffa500; border-radius: 8px; padding: 1rem; text-align: center;">
                            <div style="color: #ffa500; font-weight: bold;">${type.toUpperCase()}</div>
                            <div style="opacity: 0.8; font-size: 0.9rem;">Simulation: ${attrs.symbol || 'N/A'}</div>
                        </div>
                    `;
                    return element;
                }
            };
        }

        /**
         * Configuration des √©v√©nements
         */
        function setupEventListeners() {
            // √âcouter les √©v√©nements du gestionnaire d'√©tat
            window.aiStateManager.on('health:updated', (data) => {
                updateLoadingStatus('Services IA op√©rationnels');
            });

            window.aiStateManager.on('error', (data) => {
                console.warn('AI State Manager error:', data);
            });

            window.aiStateManager.on('regime:changed', (data) => {
                showNotification(`Changement de r√©gime d√©tect√©: ${data.newRegime.type}`);
            });

            // Mise √† jour des statistiques
            setInterval(updateStats, 10000); // 10 secondes
        }

        /**
         * Masquer l'overlay de chargement
         */
        function hideLoadingOverlay() {
            const overlay = document.getElementById('loadingOverlay');
            overlay.classList.add('hidden');
            setTimeout(() => {
                overlay.style.display = 'none';
            }, 500);
        }

        /**
         * Mettre √† jour le statut de chargement
         */
        function updateLoadingStatus(message) {
            const subtext = document.querySelector('.loading-subtext');
            if (subtext) {
                subtext.textContent = message;
            }
        }

        /**
         * Force la mise √† jour de tous les composants
         */
        async function forceUpdateAll() {
            try {
                console.log('üîÑ Force updating all components...');

                // Forcer la mise √† jour du gestionnaire d'√©tat
                await window.aiStateManager.forceUpdate();

                // Actualiser tous les composants
                const components = document.querySelectorAll('volatility-display, market-regime-display, correlation-matrix, sentiment-indicator, rebalancing-suggestions');
                components.forEach(component => {
                    if (typeof component.refresh === 'function') {
                        component.refresh();
                    } else if (typeof component.loadData === 'function') {
                        component.loadData();
                    }
                });

                showNotification('‚úÖ Tous les composants ont √©t√© actualis√©s');

            } catch (error) {
                console.error('Force update failed:', error);
                showNotification('‚ùå Erreur lors de la mise √† jour', 'error');
            }
        }

        /**
         * Basculer le mode temps r√©el
         */
        function toggleRealTime() {
            realTimeEnabled = !realTimeEnabled;
            const toggleText = document.getElementById('realtimeToggle');

            if (realTimeEnabled) {
                window.aiStateManager.resumeUpdates();
                toggleText.textContent = 'Pause';
                showNotification('üü¢ Mode temps r√©el activ√©');
            } else {
                window.aiStateManager.pauseUpdates();
                toggleText.textContent = 'Reprendre';
                showNotification('üü° Mode temps r√©el en pause');
            }
        }

        /**
         * Afficher/masquer les statistiques
         */
        function showStats() {
            statsVisible = !statsVisible;
            const container = document.getElementById('statsContainer');
            container.style.display = statsVisible ? 'block' : 'none';

            if (statsVisible) {
                updateStats();
            }
        }

        /**
         * Mettre √† jour les statistiques
         */
        function updateStats() {
            if (!statsVisible) return;

            const stats = window.aiStateManager.getStats();

            document.getElementById('cacheHits').textContent = stats.cacheHits || '--';
            document.getElementById('apiCalls').textContent = stats.apiCalls || '--';
            document.getElementById('activeComponents').textContent = document.querySelectorAll('volatility-display, market-regime-display, correlation-matrix, sentiment-indicator, rebalancing-suggestions').length;
            document.getElementById('lastUpdate').textContent = stats.lastUpdate ?
                new Date(stats.lastUpdate).toLocaleTimeString() : '--';
        }

        /**
         * Ajouter un symbole al√©atoire
         */
        function addRandomSymbol() {
            const currentSymbols = window.aiStateManager.getTrackedSymbols();
            const availableNew = availableSymbols.filter(s => !currentSymbols.includes(s));

            if (availableNew.length === 0) {
                showNotification('Tous les symboles sont d√©j√† suivis', 'warning');
                return;
            }

            const randomSymbol = availableNew[Math.floor(Math.random() * availableNew.length)];
            window.aiStateManager.addTrackedSymbol(randomSymbol);

            // Cr√©er et ajouter de nouveaux composants
            const volatilitySection = document.querySelector('.demo-section .components-grid');
            const newVolatility = window.AIComponents.create('volatility-display', {
                symbol: randomSymbol,
                horizon: '24',
                'auto-update': ''
            });

            const sentimentSection = document.querySelectorAll('.demo-section')[3].querySelector('.components-grid');
            const newSentiment = window.AIComponents.create('sentiment-indicator', {
                symbol: randomSymbol,
                compact: ''
            });

            volatilitySection.appendChild(newVolatility);
            sentimentSection.appendChild(newSentiment);

            showNotification(`‚úÖ ${randomSymbol} ajout√© au suivi`);
        }

        /**
         * Afficher une notification
         */
        function showNotification(message, type = 'info') {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 2rem;
                right: 2rem;
                background: ${type === 'error' ? '#ef4444' : type === 'warning' ? '#f59e0b' : '#10b981'};
                color: white;
                padding: 1rem;
                border-radius: 8px;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
                z-index: 10001;
                animation: slideIn 0.3s ease-out;
                max-width: 300px;
                word-wrap: break-word;
            `;

            notification.textContent = message;
            document.body.appendChild(notification);

            setTimeout(() => {
                notification.style.animation = 'slideOut 0.3s ease-in forwards';
                setTimeout(() => {
                    document.body.removeChild(notification);
                }, 300);
            }, 3000);
        }

        /**
         * Afficher une erreur
         */
        function showError(message) {
            updateLoadingStatus('Erreur: ' + message);
            setTimeout(() => {
                hideLoadingOverlay();
                showNotification(message, 'error');
            }, 2000);
        }

        // Styles pour les animations de notification
        const notificationStyles = document.createElement('style');
        notificationStyles.textContent = `
            @keyframes slideIn {
                from {
                    transform: translateX(100%);
                    opacity: 0;
                }
                to {
                    transform: translateX(0);
                    opacity: 1;
                }
            }
            
            @keyframes slideOut {
                from {
                    transform: translateX(0);
                    opacity: 1;
                }
                to {
                    transform: translateX(100%);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(notificationStyles);

        // Initialisation au chargement de la page
        document.addEventListener('DOMContentLoaded', initializeDemo);

        // Nettoyage lors de la fermeture
        window.addEventListener('beforeunload', () => {
            if (window.aiStateManager) {
                window.aiStateManager.dispose();
            }
        });

        // Debug global
        window.demoDebug = {
            forceUpdateAll,
            showStats,
            toggleRealTime,
            addRandomSymbol,
            getState: () => window.aiStateManager.getFullState(),
            getStats: () => window.aiStateManager.getStats()
        };
    </script>

    <script>
        // Initialisation de la navigation th√©matique
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Initializing themed navigation...');
            
            // Attendre que tous les scripts soient charg√©s
            setTimeout(() => {
                if (typeof createSimpleNavigation !== 'undefined') {
                    console.log('Creating simple navigation...');
                    window.simpleNavigation = createSimpleNavigation('ai');
                    console.log('Simple navigation created:', window.simpleNavigation);
                } else {
                    console.error('createSimpleNavigation function not found');
                }
            }, 100);
        });
    </script>
</body>

</html>