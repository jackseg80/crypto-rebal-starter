<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test Direct API</title>
    <script src="global-config.js"></script>
</head>
<body>
    <h1>üß™ Test Direct Strategy API</h1>
    <div id="output">Loading...</div>

    <script type="module">
        console.log('Starting direct API test...');
        
        async function testDirectAPI() {
            try {
                // Wait a bit for global-config to load
                await new Promise(resolve => setTimeout(resolve, 200));
                
                const baseUrl = window.globalConfig?.get?.('api_base_url') || window.location.origin;
                console.log('Using base URL:', baseUrl);
                
                // Test 1: Templates
                console.log('Testing /api/strategy/templates...');
                const templatesResponse = await fetch(`${baseUrl}/api/strategy/templates`);
                if (!templatesResponse.ok) throw new Error(`Templates failed: ${templatesResponse.status}`);
                const templates = await templatesResponse.json();
                console.log('‚úÖ Templates:', templates);
                
                // Test 2: Preview
                console.log('Testing /api/strategy/preview...');
                const previewResponse = await fetch(`${baseUrl}/api/strategy/preview`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        template_id: 'balanced', 
                        force_refresh: true 
                    })
                });
                if (!previewResponse.ok) throw new Error(`Preview failed: ${previewResponse.status}`);
                const preview = await previewResponse.json();
                console.log('‚úÖ Preview:', preview);
                
                document.getElementById('output').innerHTML = `
                    <h2>‚úÖ Direct API Success!</h2>
                    <h3>Templates:</h3>
                    <pre>${JSON.stringify(templates, null, 2)}</pre>
                    <h3>Preview (Balanced):</h3>
                    <pre>${JSON.stringify(preview, null, 2)}</pre>
                `;
                
            } catch (error) {
                console.error('‚ùå Direct API test failed:', error);
                document.getElementById('output').innerHTML = `
                    <h2>‚ùå Direct API Error</h2>
                    <p>${error.message}</p>
                    <pre>${error.stack}</pre>
                `;
            }
        }
        
        window.addEventListener('DOMContentLoaded', testDirectAPI);
    </script>
</body>
</html>