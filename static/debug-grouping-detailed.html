<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Debug Asset Grouping Detailed</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { border: 1px solid #ccc; padding: 15px; margin: 10px 0; }
        pre { background: #f5f5f5; padding: 10px; overflow: auto; }
        .asset { margin: 5px 0; padding: 5px; background: #e8f4f8; }
        .error { color: red; }
        .success { color: green; }
    </style>
</head>
<body>
    <h1>Debug Asset Grouping Detailed</h1>

    <button onclick="runTest()">üîÑ Reload Test</button>

    <div class="test-section">
        <h2>Taxonomy API Response</h2>
        <div id="taxonomy-response"></div>
    </div>

    <div class="test-section">
        <h2>Shared Asset Groups Module State</h2>
        <div id="module-state"></div>
    </div>

    <div class="test-section">
        <h2>Test Classifications</h2>
        <div id="test-classifications"></div>
    </div>

    <div class="test-section">
        <h2>Test Grouping Function</h2>
        <div id="test-grouping"></div>
    </div>

    <script type="module">
        import { getAssetGroup, groupAssetsByClassification, KNOWN_ASSET_MAPPING, GROUP_ORDER } from './shared-asset-groups.js';

        async function runTest() {
            console.log('üß™ Starting debug test...');

            // 1. Test API directly
            try {
                const response = await fetch('/taxonomy');
                const apiData = await response.json();
                document.getElementById('taxonomy-response').innerHTML = `
                    <div class="success">‚úÖ API Response:</div>
                    <pre>${JSON.stringify(apiData, null, 2)}</pre>
                `;
                console.log('API Response:', apiData);
            } catch (error) {
                document.getElementById('taxonomy-response').innerHTML = `
                    <div class="error">‚ùå API Error: ${error.message}</div>
                `;
            }

            // 2. Check module state
            document.getElementById('module-state').innerHTML = `
                <div>KNOWN_ASSET_MAPPING keys: ${Object.keys(KNOWN_ASSET_MAPPING).length}</div>
                <div>GROUP_ORDER: [${GROUP_ORDER.join(', ')}]</div>
                <div>USDC mapping: ${KNOWN_ASSET_MAPPING['USDC'] || 'NOT FOUND'}</div>
                <div>ETH mapping: ${KNOWN_ASSET_MAPPING['ETH'] || 'NOT FOUND'}</div>
                <div>STETH mapping: ${KNOWN_ASSET_MAPPING['STETH'] || 'NOT FOUND'}</div>
                <div>RETH mapping: ${KNOWN_ASSET_MAPPING['RETH'] || 'NOT FOUND'}</div>
            `;

            // 3. Test individual classifications
            const testSymbols = ['ETH', 'STETH', 'RETH', 'WETH', 'USDC', 'USDT', 'DAI', 'BTC', 'WBTC'];
            let classificationsHtml = '<table border="1"><tr><th>Symbol</th><th>Group</th></tr>';

            testSymbols.forEach(symbol => {
                const group = getAssetGroup(symbol);
                classificationsHtml += `<tr><td>${symbol}</td><td>${group}</td></tr>`;
                console.log(`${symbol} -> ${group}`);
            });
            classificationsHtml += '</table>';
            document.getElementById('test-classifications').innerHTML = classificationsHtml;

            // 4. Test grouping function
            const testAssets = [
                { symbol: 'ETH', value_usd: 1000 },
                { symbol: 'STETH', value_usd: 500 },
                { symbol: 'RETH', value_usd: 300 },
                { symbol: 'WETH', value_usd: 200 },
                { symbol: 'USDC', value_usd: 800 },
                { symbol: 'USDT', value_usd: 600 },
                { symbol: 'DAI', value_usd: 400 },
                { symbol: 'BTC', value_usd: 2000 },
                { symbol: 'WBTC', value_usd: 1500 }
            ];

            const grouped = groupAssetsByClassification(testAssets);
            document.getElementById('test-grouping').innerHTML = `
                <div>Input assets: ${testAssets.length}</div>
                <div>Output groups: ${grouped.length}</div>
                <pre>${JSON.stringify(grouped, null, 2)}</pre>
            `;
            console.log('Grouped result:', grouped);
        }

        // Run test on load
        window.runTest = runTest;
        runTest();
    </script>
</body>
</html>