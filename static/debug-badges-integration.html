<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Debug Badges Integration</title>
    <link rel="stylesheet" href="shared-theme.css">
    <style>
        body { font-family: system-ui; padding: 2rem; background: var(--theme-background); color: var(--theme-text); }
        .test-section { background: var(--theme-surface); border: 1px solid var(--theme-border); border-radius: 8px; padding: 1.5rem; margin: 1rem 0; }
        .test-item { padding: 0.5rem 0; border-bottom: 1px solid var(--theme-border); display: flex; justify-content: space-between; align-items: center; }
        .test-item:last-child { border-bottom: none; }
        .status-ok { color: var(--success); }
        .status-error { color: var(--danger); }
        .status-warning { color: var(--warning); }
        iframe { width: 100%; height: 200px; border: 1px solid var(--theme-border); border-radius: 4px; }
    </style>
</head>
<body>
    <h1>🔍 Debug Badges Integration</h1>

    <div class="test-section">
        <h2>Test des Containers dans les Pages</h2>
        <div id="container-tests">⏳ Testant...</div>
        <button onclick="runContainerTests()">🔍 Re-test Containers</button>
    </div>

    <div class="test-section">
        <h2>Test d'Accès aux Pages</h2>
        <div class="test-item">
            <span>Risk Dashboard</span>
            <span><a href="risk-dashboard.html" target="_blank">🔗 Ouvrir</a></span>
        </div>
        <div class="test-item">
            <span>Saxo Dashboard</span>
            <span><a href="saxo-dashboard.html" target="_blank">🔗 Ouvrir</a></span>
        </div>
        <div class="test-item">
            <span>Settings</span>
            <span><a href="settings.html" target="_blank">🔗 Ouvrir</a></span>
        </div>
    </div>

    <div class="test-section">
        <h2>Test de Navigation Menu</h2>
        <div id="menu-test">⏳ Testant le menu...</div>
        <button onclick="checkNavigation()">🔍 Check Navigation</button>
    </div>

    <script>
        function addResult(container, label, status, details) {
            const statusClass = status === 'ok' ? 'status-ok' : status === 'error' ? 'status-error' : 'status-warning';
            const statusIcon = status === 'ok' ? '✅' : status === 'error' ? '❌' : '⚠️';

            container.innerHTML += `
                <div class="test-item">
                    <span>${label}</span>
                    <span class="${statusClass}">${statusIcon} ${details}</span>
                </div>
            `;
        }

        function runContainerTests() {
            const container = document.getElementById('container-tests');
            container.innerHTML = '';

            // Test si les containers badges existent dans les pages
            const pages = [
                { name: 'Risk Dashboard', url: 'risk-dashboard.html', containerId: 'badges-risk' },
                { name: 'Saxo Dashboard', url: 'saxo-dashboard.html', containerId: 'badges-saxo' },
                { name: 'Settings', url: 'settings.html', containerId: 'badges-settings' }
            ];

            pages.forEach(page => {
                // Simuler un test de fetch pour vérifier si la page existe
                fetch(page.url)
                    .then(response => {
                        if (response.ok) {
                            return response.text();
                        }
                        throw new Error(`HTTP ${response.status}`);
                    })
                    .then(html => {
                        if (html.includes(`id="${page.containerId}"`)) {
                            addResult(container, `${page.name} - Container`, 'ok', `#${page.containerId} trouvé`);
                        } else {
                            addResult(container, `${page.name} - Container`, 'error', `#${page.containerId} manquant`);
                        }

                        // Vérifier l'import renderBadges
                        if (html.includes('renderBadges')) {
                            addResult(container, `${page.name} - Import`, 'ok', 'renderBadges importé');
                        } else {
                            addResult(container, `${page.name} - Import`, 'error', 'renderBadges non importé');
                        }

                        // Vérifier l'initialisation
                        if (html.includes('getElementById') && html.includes(page.containerId)) {
                            addResult(container, `${page.name} - Init`, 'ok', 'Initialisation présente');
                        } else {
                            addResult(container, `${page.name} - Init`, 'error', 'Initialisation manquante');
                        }
                    })
                    .catch(error => {
                        addResult(container, `${page.name}`, 'error', `Erreur: ${error.message}`);
                    });
            });
        }

        function checkNavigation() {
            const container = document.getElementById('menu-test');
            container.innerHTML = '';

            // Vérifier si les pages sont dans le menu de navigation
            fetch('components/nav.js')
                .then(response => response.text())
                .then(navCode => {
                    // Chercher les références aux pages
                    const pages = ['risk-dashboard', 'saxo-dashboard', 'settings'];

                    pages.forEach(page => {
                        if (navCode.includes(page)) {
                            addResult(container, `Navigation - ${page}`, 'ok', 'Référence trouvée');
                        } else {
                            addResult(container, `Navigation - ${page}`, 'warning', 'Référence manquante?');
                        }
                    });
                })
                .catch(error => {
                    addResult(container, 'Navigation', 'error', `Erreur nav.js: ${error.message}`);
                });

            // Test direct des URLs
            addResult(container, 'URL Test', 'ok', 'Utilise les liens ci-dessus pour tester');
        }

        // Auto-run tests
        document.addEventListener('DOMContentLoaded', () => {
            runContainerTests();
            setTimeout(checkNavigation, 1000);
        });
    </script>
</body>
</html>