<!DOCTYPE html>
<html lang="fr">

<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Configuration - Crypto Rebalancer</title>
  <link rel="stylesheet" href="shared-theme.css">
  <link rel="stylesheet" href="theme-compat.css">
  <script type="module" src="components/nav.js"></script>
  <script type="module" src="components/tooltips.js"></script>

  <script src="debug-logger.js"></script>
  <script src="input-validator.js"></script>
  <script src="performance-optimizer.js"></script>
  <script src="global-config.js"></script>
  <script src="appearance.js"></script>
  <script type="module" src="sources-manager.js"></script>
  <style>
    * {
      box-sizing: border-box
    }

    body {
      margin: 0;
      background: var(--theme-background);
      color: var(--theme-text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif
    }

    header {
      position: sticky;
      top: 0;
      background: var(--theme-surface-elevated);
      backdrop-filter: blur(6px);
      border-bottom: 1px solid var(--theme-border);
      z-index: 10
    }

    .wrap {
      max-width: 95vw;
      margin: 0 auto;
      padding: 16px
    }

    h1 {
      margin: 0 0 8px 0;
      font-size: 24px;
      font-weight: 800
    }

    h2 {
      margin: 0 0 12px 0;
      font-size: 18px;
      font-weight: 600
    }

    h3 {
      margin: 0 0 8px 0;
      font-size: 16px;
      font-weight: 600
    }

    .nav {
      display: flex;
      gap: 12px;
      margin: 12px 0
    }

    .nav a {
      padding: 8px 16px;
      border-radius: 8px;
      text-decoration: none;
      color: var(--theme-text-muted);
      border: 1px solid var(--theme-border);
      transition: all 0.2s
    }

    .nav a.active,
    .nav a:hover {
      background: var(--brand-primary);
      color: white;
      border-color: var(--brand-primary)
    }

    .card {
      background: var(--theme-surface);
      border: 1px solid var(--theme-border);
      border-radius: var(--radius-lg);
      padding: var(--space-xl);
      margin-bottom: var(--space-xl)
    }

    /* Tabs */
    .tabs {
      display: flex;
      gap: .5rem;
      border-bottom: 1px solid var(--theme-border);
      margin-bottom: var(--space-md);
      flex-wrap: wrap;
    }

    .tab-btn {
      padding: .6rem .9rem;
      border: 1px solid var(--theme-border);
      background: var(--theme-surface);
      color: var(--theme-text);
      border-radius: 8px 8px 0 0;
      cursor: pointer;
    }

    .tab-btn.active {
      border-color: var(--brand-primary);
      color: var(--brand-primary);
      background: color-mix(in oklab, var(--brand-primary) 10%, transparent);
    }

    .tab-panel {
      display: none;
    }

    .tab-panel.active {
      display: block;
    }

    .card.success {
      border-color: var(--success);
      background: var(--success-bg)
    }

    .card.warning {
      border-color: var(--warning);
      background: var(--warning-bg)
    }

    .form-group {
      margin-bottom: 20px
    }

    .form-group label {
      display: block;
      margin-bottom: 6px;
      font-weight: 600;
      color: var(--theme-text)
    }

    .form-group .help {
      font-size: 13px;
      color: var(--theme-text-muted);
      margin-top: 4px
    }

    .form-row {
      display: flex;
      gap: 16px;
      align-items: center;
      margin-bottom: 12px
    }

    .form-row.vertical {
      flex-direction: column;
      align-items: flex-start
    }

    input,
    select,
    textarea {
      padding: 10px 12px;
      border-radius: 10px;
      border: 1px solid var(--theme-border);
      background: var(--theme-surface);
      color: var(--theme-text);
      width: 100%;
      max-width: 400px;
      font-size: 14px;
    }

    input:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: var(--brand-primary);
      box-shadow: var(--focus-ring);
    }

    button {
      padding: 10px 20px;
      border-radius: 10px;
      border: 0;
      cursor: pointer;
      font-weight: 600;
      transition: all 0.2s;
    }

    .btn {
      background: var(--brand-primary);
      color: white
    }

    .btn:hover {
      background: var(--brand-primary-hover)
    }

    .btn.secondary {
      background: var(--theme-surface-elevated);
      color: var(--theme-text);
      border: 1px solid var(--theme-border)
    }

    .btn.danger {
      background: var(--danger);
      color: white
    }

    .btn.small {
      padding: 6px 12px;
      font-size: 13px
    }

    .radio-group {
      display: flex;
      gap: 16px;
      flex-wrap: wrap
    }

    .radio-option {
      display: flex;
      align-items: center;
      gap: 8px;
      padding: 8px 12px;
      border: 1px solid var(--theme-border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s
    }

    .radio-option:hover {
      background: var(--brand-primary-subtle);
      border-color: var(--brand-primary)
    }

    .radio-option input[type="radio"] {
      width: auto;
      margin: 0
    }

    .radio-option.selected {
      background: var(--brand-primary-subtle);
      border-color: var(--brand-primary)
    }

    .status-indicator {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 6px 12px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
    }

    .status-ok {
      background: var(--success);
      color: white
    }

    .status-warning {
      background: var(--warning);
      color: white
    }

    .status-error {
      background: var(--danger);
      color: white
    }

    .test-section {
      background: var(--theme-surface-elevated);
      border: 1px solid var(--theme-border);
      border-radius: 10px;
      padding: 16px;
      margin-top: 12px
    }

    .test-result {
      font-family: monospace;
      background: var(--theme-surface);
      border: 1px solid var(--theme-border);
      border-radius: 6px;
      padding: 12px;
      margin-top: 8px;
      font-size: 12px;
      color: var(--theme-text)
    }

    @media(max-width: 768px) {
      .wrap {
        padding: 12px
      }

      .form-row {
        flex-direction: column;
        align-items: flex-start;
        gap: 8px
      }

      .radio-group {
        flex-direction: column;
        gap: 8px
      }

      input,
      select,
      textarea {
        max-width: 100%
      }
    }
  </style>

  <style>
    /* Ajustement pour la navigation simple */
    body.has-simple-nav {
      margin-left: 80px;
    }

    /* Responsive pour mobile */
    @media (max-width: 768px) {
      body.has-simple-nav {
        margin-left: 0;
      }
    }
  </style>
</head>

<body class="has-simple-nav">


  <div class="wrap">

    <!-- Tab header -->
    <div class="tabs" id="settings-tabs">
      <button class="tab-btn active" data-target="#tab-overview">R√©sum√©</button>
      <!-- <button class="tab-btn" data-target="#tab-data">Source</button> Ancien onglet masqu√© - utiliser Sources -->
      <button class="tab-btn" data-target="#tab-pricing">Pricing</button>
      <button class="tab-btn" data-target="#tab-api">Cl√©s API</button>
      <button class="tab-btn" data-target="#tab-sources">Sources</button>
      <button class="tab-btn" data-target="#tab-interface">Interface</button>
      <button class="tab-btn" data-target="#tab-advanced">Avanc√©</button>
    </div>


    <!-- Overview Tab -->
    <section class="tab-panel active" id="tab-overview">
      <div class="card" id="global-status"
        data-tooltip="Statut global du syst√®me avec indicateurs de sant√© des connexions API et services."
        data-source="Tests de connectivit√© en temps r√©el">
        <div style="display: flex; align-items: center; justify-content: space-between;">
          <div>
            <h3>üìä Statut Global</h3>
            <div id="status-summary">Chargement de la configuration...</div>
          </div>
          <div>
            <button class="btn" onclick="saveAllSettings()">üíæ Sauvegarder</button>
            <button class="btn secondary small" onclick="resetToDefaults()">üîÑ D√©faut</button>
          </div>
        </div>
      </div>

      <!-- Quick Settings: options les plus utilis√©es -->
      <div class="card" data-tooltip="R√©glages rapides les plus courants" data-source="globalConfig">
        <h3>‚öôÔ∏è R√©glages Rapides</h3>
        <div class="form-row">
          <div style="flex:1; min-width: 240px;">
            <label>Source de donn√©es</label>
            <select id="quick_data_source"></select>
            <div class="help">Impacte tous les dashboards (balances, analytics et rebalancing)</div>
          </div>
          <div style="flex:1; min-width: 240px;">
            <label>Mode de pricing</label>
            <select id="quick_pricing">
              <option value="local">üè† Local</option>
              <option value="auto">üöÄ Auto</option>
            </select>
            <div class="help">Local = prix depuis donn√©es, Auto = prix march√©</div>
          </div>
        </div>
        <div class="form-row">
          <div style="flex:1; min-width: 240px;">
            <label>Seuil minimum (USD)</label>
            <input type="number" id="quick_min_usd" min="0" step="0.01">
          </div>
          <div style="flex:1; min-width: 240px;">
            <label>Devise d'affichage</label>
            <select id="quick_currency">
              <option value="USD">USD ($)</option>
              <option value="EUR">EUR (‚Ç¨)</option>
              <option value="BTC">BTC (‚Çø)</option>
            </select>
          </div>
        </div>
        <div class="form-row">
          <div style="flex:1; min-width: 240px;">
            <label>Th√®me</label>
            <select id="quick_theme">
              <option value="auto">üåì Automatique</option>
              <option value="light">‚òÄÔ∏è Clair</option>
              <option value="dark">üåô Sombre</option>
            </select>
          </div>
          <div style="flex:1; min-width: 240px;">
            <label>URL API backend</label>
            <input type="text" id="quick_api_base_url" placeholder="http://127.0.0.1:8000">
          </div>
        </div>
        <div style="display:flex; gap:8px; margin-top: 8px;">
          <button class="btn" id="quick_save_btn">üíæ Sauvegarder</button>
          <button class="btn secondary" id="quick_apply_btn">Appliquer sans sauvegarder</button>
        </div>
      </div>
    </section>

    <!-- Pricing Tab -->
    <section class="tab-panel" id="tab-pricing">
      <div class="card"
        data-tooltip="Configuration des prix de r√©f√©rence et devises pour les calculs de valeur du portefeuille."
        data-source="CoinGecko, CoinGlass, ou prix manuels">
        <h3>üí∞ Pricing & Devises</h3>
        <div class="form-group">
          <label>Mode de pricing</label>
          <div class="radio-group">
            <div class="radio-option" onclick="selectPricing('local')">
              <input type="radio" name="pricing" value="local" id="pricing_local">
              <label for="pricing_local">üè† <strong>Local</strong> - Prix depuis les donn√©es</label>
            </div>
            <div class="radio-option" onclick="selectPricing('auto')">
              <input type="radio" name="pricing" value="auto" id="pricing_auto">
              <label for="pricing_auto">üöÄ <strong>Auto</strong> - Prix automatiques</label>
            </div>
          </div>
          <div class="help">Local utilise les prix dans vos donn√©es, Auto r√©cup√®re les prix actuels via API.</div>
        </div>

        <div class="form-row">
          <div style="flex: 1;">
            <label>Devise d'affichage</label>
            <select id="display_currency">
              <option value="USD">USD ($)</option>
              <option value="EUR">EUR (‚Ç¨)</option>
              <option value="BTC">BTC (‚Çø)</option>
            </select>
          </div>
          <div style="flex: 1;">
            <label>Seuil minimum (USD)</label>
            <input type="number" id="min_usd_threshold" min="0" step="0.01" value="1.00">
          </div>
        </div>
      </div>
    </section>

    <!-- API Keys Tab -->
    <section class="tab-panel" id="tab-api">
      <div class="card"
        data-tooltip="Gestion s√©curis√©e des cl√©s API pour les exchanges et services de donn√©es (stockage local chiffr√©)."
        data-source="Stockage local s√©curis√© + validation API">
        <h3>üîë Cl√©s API</h3>

        <div class="form-group">
          <label>CoinGecko API Key</label>
          <div style="display: flex; gap: 8px; align-items: center;">
            <input type="password" id="coingecko_api_key" placeholder="Optionnel - pour plus de requ√™tes"
              style="flex: 1;">
            <button class="btn small secondary" onclick="toggleApiKeyVisibility('coingecko_api_key')"
              style="min-width: 60px;">üëÅÔ∏è</button>
            <span id="coingecko_status" class="status-indicator status-warning" style="font-size: 10px;">Vide</span>
          </div>
          <div class="help">Cl√© Demo API CoinGecko pour la classification automatique et donn√©es de march√©.</div>
        </div>

        <div class="form-group">
          <label>CoinTracking API Key</label>
          <div style="display: flex; gap: 8px; align-items: center;">
            <input type="password" id="cointracking_api_key" placeholder="Obligatoire pour source API" style="flex: 1;">
            <button class="btn small secondary" onclick="toggleApiKeyVisibility('cointracking_api_key')"
              style="min-width: 60px;">üëÅÔ∏è</button>
            <span id="cointracking_key_status" class="status-indicator status-warning"
              style="font-size: 10px;">Vide</span>
          </div>
          <div class="help">Cl√© API CoinTracking pour acc√®s temps r√©el √† vos balances.</div>
        </div>

        <div class="form-group">
          <label>CoinTracking API Secret</label>
          <div style="display: flex; gap: 8px; align-items: center;">
            <input type="password" id="cointracking_api_secret" placeholder="Obligatoire pour source API"
              style="flex: 1;">
            <button class="btn small secondary" onclick="toggleApiKeyVisibility('cointracking_api_secret')"
              style="min-width: 60px;">üëÅÔ∏è</button>
            <span id="cointracking_secret_status" class="status-indicator status-warning"
              style="font-size: 10px;">Vide</span>
          </div>
          <div class="help">Cl√© secr√®te CoinTracking (g√©n√©r√©e avec la cl√© API).</div>
        </div>

        <div class="form-group">
          <label>FRED API Key (Federal Reserve Economic Data)</label>
          <div style="display: flex; gap: 8px; align-items: center;">
            <input type="password" id="fred_api_key" placeholder="Cl√© pour donn√©es Bitcoin historiques"
              style="flex: 1;">
            <button class="btn small secondary" onclick="toggleApiKeyVisibility('fred_api_key')"
              style="min-width: 60px;">üëÅÔ∏è</button>
            <span id="fred_status" class="status-indicator status-warning" style="font-size: 10px;">Vide</span>
          </div>
          <div class="help">Cl√© API gratuite FRED pour historique Bitcoin complet depuis 2014 (vs 365j CoinGecko).</div>
        </div>

        <div class="form-group">
          <label>Debug Token (requis pour sync .env)</label>
          <div style="display: flex; gap: 8px; align-items: center;">
            <input type="password" id="debug_token" placeholder="Token s√©curis√© pour acc√®s debug" style="flex: 1;">
            <button class="btn small secondary" onclick="toggleApiKeyVisibility('debug_token')"
              style="min-width: 60px;">üëÅÔ∏è</button>
          </div>
          <div class="help">Token requis pour certains endpoints de debug</div>
        </div>

        <!-- Actions sp√©cifiques Cl√©s API -->
        <div style="display:flex; gap:8px; margin: 8px 0 12px 0;">
          <button class="btn" onclick="saveAllSettings()">üíæ Sauvegarder</button>
          <button class="btn secondary" onclick="updateStatusSummary()">Appliquer sans sauvegarder</button>
        </div>


        <div class="test-section">
          <button class="btn secondary small" onclick="testApiKeys()">üß™ Tester les APIs</button>
          <div id="api-keys-test"></div>
        </div>
      </div>
    </section>


    <!-- Interface Tab -->
    <section class="tab-panel" id="tab-interface">

      <!-- Pr√©f√©rences Interface -->
      <div class="card"
        data-tooltip="Personnalisation de l'interface utilisateur : th√®mes, langue, format des nombres et raccourcis."
        data-source="Pr√©f√©rences utilisateur locales">
        <h3>üé® Interface & Pr√©f√©rences</h3>

        <div class="form-group">
          <label>Th√®me de l'interface</label>
          <div class="radio-group">
            <div class="radio-option" onclick="selectTheme('auto')">
              <input type="radio" name="theme" value="auto" id="theme_auto">
              <label for="theme_auto">üåì <strong>Automatique</strong> - Suit les pr√©f√©rences syst√®me</label>
            </div>
            <div class="radio-option" onclick="selectTheme('light')">
              <input type="radio" name="theme" value="light" id="theme_light">
              <label for="theme_light">‚òÄÔ∏è <strong>Clair</strong> - Mode jour</label>
            </div>
            <div class="radio-option" onclick="selectTheme('dark')">
              <input type="radio" name="theme" value="dark" id="theme_dark">
              <label for="theme_dark">üåô <strong>Sombre</strong> - Mode nuit</label>
            </div>
          </div>
          <div class="help">Le th√®me s'applique automatiquement sur toutes les pages de l'application.</div>
        </div>

        <!-- ====== Apparence / Style UI ====== -->
        <div class="card">
          <h2>Apparence</h2>
          <div class="form-group">
            <label>Style UI</label>
            <div class="style-grid" style="display:flex;gap:12px;flex-wrap:wrap">
              <label class="style-card"
                style="display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:1px solid var(--theme-border);background:var(--theme-surface-elevated);cursor:pointer">
                <input type="radio" name="ui-style" value="modern"> Modern
              </label>
              <label class="style-card"
                style="display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:1px solid var(--theme-border);background:var(--theme-surface-elevated);cursor:pointer">
                <input type="radio" name="ui-style" value="glass"> Glass
              </label>
              <label class="style-card"
                style="display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:1px solid var(--theme-border);background:var(--theme-surface-elevated);cursor:pointer">
                <input type="radio" name="ui-style" value="terminal"> Terminal
              </label>
              <label class="style-card"
                style="display:flex;align-items:center;gap:8px;padding:10px 12px;border-radius:10px;border:1px solid var(--theme-border);background:var(--theme-surface-elevated);cursor:pointer">
                <input type="radio" name="ui-style" value="minimal"> Minimal
              </label>
            </div>
            <div class="help">Change uniquement l‚Äôhabillage (coins/ombres/surfaces). Aucune incidence sur la logique.
            </div>
          </div>
        </div>

        <script>
          document.addEventListener('DOMContentLoaded', () => {
            const saved = window.globalConfig?.get?.('style') || 'modern';
            document.querySelectorAll('input[name="ui-style"]').forEach(r => {
              r.checked = (r.value === saved);
              r.addEventListener('change', e => {
                window.globalConfig?.set?.('style', e.target.value);
                window.applyAppearance?.();
              });
            });
            // s‚Äôassure que le style s‚Äôapplique si on arrive direct
            window.applyAppearance?.();
          });
        </script>

        <div class="form-row">
          <div style="flex: 1;">
            <label>URL API Backend</label>
            <input type="text" id="api_base_url" value="http://127.0.0.1:8000">
            <div class="help">URL du serveur FastAPI backend</div>
          </div>
          <div style="flex: 1;">
            <label>Fr√©quence auto-refresh (min)</label>
            <input type="number" id="refresh_interval" min="1" max="60" value="5">
          </div>
        </div>

        <div class="form-group">
          <label>Fonctionnalit√©s actives</label>
          <div style="display: flex; flex-direction: column; gap: 8px; margin-top: 8px;">
            <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
              <input type="checkbox" id="enable_coingecko_classification" checked>
              Classification automatique CoinGecko
            </label>
            <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
              <input type="checkbox" id="enable_portfolio_snapshots" checked>
              Snapshots automatiques du portfolio
            </label>
            <label style="display: flex; align-items: center; gap: 8px; font-weight: normal;">
              <input type="checkbox" id="enable_performance_tracking" checked>
              Suivi de performance historique
            </label>
          </div>
        </div>
      </div>
    </section>

<!-- Sources Tab Unified - Remplace CSV + Int√©grations -->
<section class="tab-panel" id="tab-sources">
  <div class="card" data-tooltip="G√©rez toutes vos sources de donn√©es (CoinTracking, Saxo, etc.) depuis un point central unifi√©."
    data-source="Syst√®me sources unifi√© v2">
    <h3>üìä Sources de Donn√©es</h3>
    <div class="help" style="margin-bottom: 16px;">
      Point d'entr√©e unique pour g√©rer toutes vos sources : scan, import et refresh des donn√©es CoinTracking, Saxo Bank et autres.
    </div>

    <!-- Status global des sources -->
    <div class="status-grid" id="sources_status_grid">
      <div class="status-item">
        <span class="label">Modules actifs:</span>
        <span class="value" id="sources_active_count">Loading...</span>
      </div>
      <div class="status-item">
        <span class="label">Derni√®re activit√©:</span>
        <span class="value" id="sources_last_activity">-</span>
      </div>
      <div class="status-item">
        <span class="label">Status global:</span>
        <span class="value" id="sources_status">Initialisation...</span>
      </div>
    </div>

    <!-- Grille des modules sources -->
    <div class="modules-grid" id="sources_modules_grid" style="margin-top: 16px;">
      <!-- Les cartes de modules seront inject√©es dynamiquement par sources-manager.js -->
      <div class="loading-placeholder">
        <div class="spinner"></div>
        <span>Chargement des modules sources...</span>
      </div>
    </div>

    <!-- Actions globales -->
    <div style="margin-top: 16px;">
      <div class="flex-row" style="gap: 12px; flex-wrap: wrap;">
        <button class="btn primary" onclick="scanAllSources()">
          üîç Scanner toutes les sources
        </button>
        <button class="btn info" onclick="refreshSourcesStatus()">
          üîÑ Actualiser status
        </button>
        <button class="btn secondary" onclick="showSourcesConfiguration()">
          ‚öôÔ∏è Configuration avanc√©e
        </button>
      </div>
    </div>

    <!-- Configuration sources (collapsible) -->
    <details class="config-details" id="sources_config_details" style="margin-top: 16px;">
      <summary>‚öôÔ∏è Configuration Sources Avanc√©e</summary>
      <div class="config-content">

        <div class="form-group">
          <label for="sources_snapshot_ttl">TTL des snapshots (heures)</label>
          <input type="number" id="sources_snapshot_ttl" value="24" min="1" max="168">
          <div class="help">Dur√©e avant qu'un snapshot soit consid√©r√© comme obsol√®te (d√©faut: 24h)</div>
        </div>

        <div class="form-group">
          <label for="sources_warning_threshold">Seuil d'alerte (heures)</label>
          <input type="number" id="sources_warning_threshold" value="12" min="1" max="72">
          <div class="help">Dur√©e avant d'afficher un avertissement de staleness (d√©faut: 12h)</div>
        </div>

        <div class="form-group">
          <label for="sources_auto_refresh">Actualisation automatique</label>
          <input type="checkbox" id="sources_auto_refresh" checked>
          <div class="help">Actualise automatiquement le statut toutes les 30 secondes</div>
        </div>

        <div style="margin-top: 16px;">
          <button class="btn secondary" onclick="saveSourcesConfiguration()">
            üíæ Sauvegarder configuration
          </button>
        </div>

      </div>
    </details>

    <!-- Logs sources -->
    <div id="sources_logs" style="margin-top: 16px; display: none;">
      <h4>üìã Logs r√©cents</h4>
      <div class="logs-container" id="sources_logs_content" style="max-height: 200px; overflow-y: auto; background: var(--theme-surface); padding: 8px; border-radius: 4px; font-family: monospace; font-size: 12px;">
        <!-- Les logs seront ajout√©s dynamiquement -->
      </div>
      <div style="margin-top: 8px;">
        <button class="btn small secondary" onclick="toggleSourcesLogs()">
          üìã Basculer les logs
        </button>
        <button class="btn small info" onclick="clearSourcesLogs()">
          üóëÔ∏è Effacer
        </button>
      </div>
    </div>

  </div>
</section>

<!-- CSS sp√©cifique pour la section Sources -->
<style>
/* Grille des modules sources */
.modules-grid {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  gap: 16px;
}

/* Cartes individuelles des modules */
.module-card {
  background: var(--theme-surface);
  border: 1px solid var(--theme-border);
  border-radius: 8px;
  padding: 16px;
  transition: all 0.2s ease;
}

.module-card:hover {
  border-color: var(--theme-accent);
  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.module-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 12px;
}

.module-header h4 {
  margin: 0;
  font-size: 16px;
  font-weight: 600;
}

/* Badges de status */
.status-badge {
  padding: 4px 8px;
  border-radius: 12px;
  font-size: 12px;
  font-weight: 500;
  text-transform: uppercase;
}

.status-badge.enabled, .status-badge.success {
  background: #d4edda;
  color: #155724;
}

.status-badge.warning {
  background: #fff3cd;
  color: #856404;
}

.status-badge.disabled, .status-badge.error {
  background: #f8d7da;
  color: #721c24;
}

/* Statistiques des modules */
.module-stats {
  margin: 12px 0;
}

.stat-item {
  display: flex;
  justify-content: space-between;
  margin-bottom: 4px;
  font-size: 14px;
}

.stat-item .label {
  color: var(--theme-text-muted);
}

.stat-item .value {
  font-weight: 500;
}

/* Actions des modules */
.module-actions {
  margin-top: 12px;
  display: flex;
  gap: 8px;
  flex-wrap: wrap;
}

.btn-sm {
  padding: 6px 12px;
  font-size: 12px;
}

/* Loading placeholder */
.loading-placeholder {
  grid-column: 1 / -1;
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 12px;
  padding: 40px;
  color: var(--theme-text-muted);
  font-style: italic;
}

.spinner {
  width: 20px;
  height: 20px;
  border: 2px solid var(--theme-border);
  border-top: 2px solid var(--theme-accent);
  border-radius: 50%;
  animation: spin 1s linear infinite;
}

@keyframes spin {
  0% { transform: rotate(0deg); }
  100% { transform: rotate(360deg); }
}

/* Sources radio buttons compacts */
.sources-section {
  margin-top: 12px;
}

.sources-section h5 {
  margin: 0 0 8px 0;
  font-size: 14px;
  color: var(--theme-text-muted);
}

.sources-list {
  display: flex;
  flex-direction: column;
  gap: 4px;
}

.source-option {
  display: flex;
  align-items: center;
  gap: 8px;
  padding: 6px 8px;
  border-radius: 4px;
  cursor: pointer;
  transition: background-color 0.2s;
  font-size: 13px;
}

.source-option:hover {
  background-color: var(--theme-surface-elevated);
}

.source-option input[type="radio"] {
  margin: 0;
  flex-shrink: 0;
  width: 14px;
  height: 14px;
}

.source-details {
  flex: 1;
  line-height: 1.3;
}

.source-details small {
  color: var(--theme-text-muted);
  font-size: 11px;
}

.legacy {
  color: #fd7e14;
  font-weight: 500;
}

/* Status grid am√©lior√© */
.status-grid .value.error {
  color: #dc3545;
}

.status-grid .value.warning {
  color: #fd7e14;
}

.status-grid .value.success {
  color: #28a745;
}

/* CSS pour la modal d'upload */
.modal-overlay {
  position: fixed;
  top: 0;
  left: 0;
  right: 0;
  bottom: 0;
  background: rgba(0, 0, 0, 0.6);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 9999;
  backdrop-filter: blur(4px);
  transition: opacity 0.2s ease;
}

.modal-content {
  background: var(--theme-surface);
  border: 1px solid var(--theme-border);
  border-radius: 12px;
  width: 90%;
  max-width: 500px;
  max-height: 80vh;
  overflow: hidden;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);
}

.modal-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 16px 20px;
  border-bottom: 1px solid var(--theme-border);
  background: var(--theme-surface-elevated);
}

.modal-header h3 {
  margin: 0;
  font-size: 18px;
  font-weight: 600;
}

.close-btn {
  background: none;
  border: none;
  font-size: 24px;
  cursor: pointer;
  color: var(--theme-text-secondary);
  padding: 0;
  width: 32px;
  height: 32px;
  display: flex;
  align-items: center;
  justify-content: center;
  border-radius: 6px;
  transition: all 0.2s ease;
}

.close-btn:hover {
  background: var(--theme-surface);
  color: var(--theme-text);
}

.modal-body {
  padding: 20px;
  max-height: 50vh;
  overflow-y: auto;
}

.modal-footer {
  display: flex;
  justify-content: flex-end;
  gap: 8px;
  padding: 16px 20px;
  border-top: 1px solid var(--theme-border);
  background: var(--theme-surface-elevated);
}

/* Zone d'upload */
.upload-area {
  border: 2px dashed var(--theme-border);
  border-radius: 8px;
  padding: 32px 16px;
  text-align: center;
  cursor: pointer;
  transition: all 0.2s ease;
  background: var(--theme-surface-elevated);
  margin: 16px 0;
}

.upload-area:hover {
  border-color: var(--theme-accent);
  background: var(--theme-surface);
}

.upload-area.drag-over {
  border-color: var(--theme-success);
  background: rgba(40, 167, 69, 0.1);
}

.upload-placeholder {
  color: var(--theme-text-secondary);
  font-size: 16px;
}

/* Liste des fichiers */
.file-list {
  margin: 16px 0;
}

.file-item {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px 12px;
  background: var(--theme-surface-elevated);
  border: 1px solid var(--theme-border);
  border-radius: 6px;
  margin-bottom: 8px;
}

.file-name {
  font-weight: 500;
}

.file-size {
  color: var(--theme-text-secondary);
  font-size: 14px;
}

/* Barre de progression */
.upload-progress {
  margin: 16px 0;
}

.progress-bar {
  width: 100%;
  height: 8px;
  background: var(--theme-surface-elevated);
  border-radius: 4px;
  overflow: hidden;
  margin-bottom: 8px;
}

.progress-fill {
  height: 100%;
  background: var(--theme-accent);
  transition: width 0.3s ease;
  width: 0%;
}

.progress-text {
  text-align: center;
  font-size: 14px;
  color: var(--theme-text-secondary);
}
</style>

<!-- JavaScript d'initialisation -->

<script src="modules/settings-sources-utils.js"></script>


    <!-- Advanced Tab -->
    <section class="tab-panel" id="tab-advanced">
      <div class="card"
        data-tooltip="Outils avanc√©s pour maintenance, cache, et op√©rations syst√®me critiques (utiliser avec pr√©caution)."
        data-source="Fonctions syst√®me internes">
        <h3>üîß Actions Avanc√©es</h3>

        <div style="display: flex; gap: 12px; flex-wrap: wrap;">
          <button class="btn secondary" onclick="exportSettings()">üì§ Exporter Config</button>
          <button class="btn secondary" onclick="importSettings()">üì• Importer Config</button>
          <button class="btn secondary" onclick="clearCache()">üóëÔ∏è Vider Cache</button>
          <button class="btn danger" onclick="resetAllData()">‚ö†Ô∏è Reset Complet</button>
        </div>

        <div class="test-section" style="margin-top: 16px;">
          <h4>üß™ Test Complet du Syst√®me</h4>
          <button class="btn" onclick="runFullSystemTest()">üöÄ Lancer Test Complet</button>
          <div id="full-system-test"></div>
        </div>
      </div>
    </section>

  </div>


  <script src="modules/settings-tabs-controller.js"></script>
  <script type="module" src="modules/settings-main-controller.js"></script>



  <script>
    // Initialisation automatique de la navigation simple
    document.addEventListener('DOMContentLoaded', function () {
      /* unified nav enabled via components/nav.js; legacy init removed */
    });
  </script>
</body>

</html>