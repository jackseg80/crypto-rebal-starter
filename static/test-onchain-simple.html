<!DOCTYPE html>
<html>
<head>
    <title>Simple On-Chain Test</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #fff; }
        pre { background: #000; padding: 10px; border-radius: 3px; overflow-x: auto; }
        .success { color: #51cf66; }
        .error { color: #ff6b6b; }
        button { padding: 10px 20px; margin: 5px; background: #4dabf7; color: white; border: none; border-radius: 3px; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç Simple On-Chain Test</h1>

    <button onclick="testDirectAPI()">Test Direct API</button>
    <button onclick="testIndicatorsModule()">Test Module</button>

    <div id="results"></div>

    <script src="global-config.js"></script>
    <script type="module">
        window.testDirectAPI = async function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div>Testing direct API...</div>';

            try {
                const response = await fetch('/api/crypto-toolbox');
                const data = await response.json();

                resultsDiv.innerHTML = `
                    <div class="success">‚úÖ Direct API Test Success</div>
                    <pre>${JSON.stringify(data, null, 2).substring(0, 1000)}...</pre>
                `;
            } catch (e) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Direct API Test Failed: ${e.message}</div>`;
            }
        };

        window.testIndicatorsModule = async function() {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = '<div>Testing indicators module...</div>';

            try {
                // Wait for globalConfig to be ready
                let attempts = 0;
                while (!window.globalConfig && attempts < 50) {
                    await new Promise(resolve => setTimeout(resolve, 100));
                    attempts++;
                }

                if (!window.globalConfig) {
                    throw new Error('globalConfig not available');
                }

                // Import the module
                const timestamp = Date.now();
                const onchain = await import(`./modules/onchain-indicators.js?v=${timestamp}`);

                // Test fetchAllIndicators
                const indicators = await onchain.fetchAllIndicators();

                const count = Object.keys(indicators).filter(k => !k.startsWith('_')).length;

                resultsDiv.innerHTML = `
                    <div class="success">‚úÖ Module Test Success</div>
                    <div>Indicator count: ${count}</div>
                    <pre>${JSON.stringify(indicators, null, 2).substring(0, 1000)}...</pre>
                `;
            } catch (e) {
                resultsDiv.innerHTML = `<div class="error">‚ùå Module Test Failed: ${e.message}</div><pre>${e.stack}</pre>`;
            }
        };
    </script>
</body>
</html>