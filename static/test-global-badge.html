<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Test Global Badge</title>
    <link rel="stylesheet" href="shared-theme.css">
    <link rel="stylesheet" href="theme-compat.css">
    <script type="module" src="components/nav.js"></script>

    <style>
        body {
            font-family: system-ui;
            background: var(--theme-background);
            color: var(--theme-text);
            margin: 0;
            padding: 2rem;
        }

        .test-content {
            max-width: 800px;
            margin: 2rem auto;
            background: var(--theme-surface);
            border: 1px solid var(--theme-border);
            border-radius: 8px;
            padding: 2rem;
        }

        .test-log {
            background: var(--theme-bg);
            border: 1px solid var(--theme-border);
            border-radius: 4px;
            padding: 1rem;
            font-family: monospace;
            font-size: 0.85rem;
            max-height: 300px;
            overflow-y: auto;
            white-space: pre-wrap;
            margin: 1rem 0;
        }

        .demo-data {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin: 1rem 0;
        }

        .demo-card {
            background: var(--theme-bg);
            border: 1px solid var(--theme-border);
            border-radius: 4px;
            padding: 1rem;
            text-align: center;
        }

        .value {
            font-size: 1.5rem;
            font-weight: 700;
            color: var(--brand-primary);
        }
    </style>
</head>
<body>
    <div class="test-content">
        <h1>üåç Test du Badge Global</h1>
        <p>Cette page teste le badge de statut global int√©gr√© dans la <strong>WealthContextBar</strong>.</p>

        <div class="test-log" id="test-log">
            [Initializing...] Test du badge global dans WealthContextBar
        </div>

        <h2>üìä Donn√©es Simul√©es</h2>
        <div class="demo-data">
            <div class="demo-card">
                <div class="value" id="demo-source">Backend</div>
                <div>Source</div>
            </div>
            <div class="demo-card">
                <div class="value" id="demo-time">--:--:--</div>
                <div>Updated (Zurich)</div>
            </div>
            <div class="demo-card">
                <div class="value" id="demo-contradiction">25%</div>
                <div>Contradiction</div>
            </div>
            <div class="demo-card">
                <div class="value" id="demo-cap">10%</div>
                <div>Cap</div>
            </div>
            <div class="demo-card">
                <div class="value" id="demo-overrides">2</div>
                <div>Overrides</div>
            </div>
            <div class="demo-card">
                <div class="value" id="demo-status">Healthy</div>
                <div>Status</div>
            </div>
        </div>

        <h2>‚ú® Instructions</h2>
        <ol>
            <li><strong>Regarde en haut de la page</strong> : Tu devrais voir la barre avec Household/Compte/Module/Devise</li>
            <li><strong>√Ä droite de cette barre</strong>, avant le bouton "‚ü≤ Reset", tu devrais voir le <strong>badge de statut global</strong></li>
            <li><strong>Le badge affiche</strong> : "Source ‚Ä¢ Updated HH:MM:SS ‚Ä¢ Contrad XX% ‚Ä¢ Cap YY% ‚Ä¢ Overrides N"</li>
            <li><strong>Check la console</strong> (F12) pour les logs de debug</li>
        </ol>

        <p><strong>Avantages de cette approche :</strong></p>
        <ul>
            <li>‚úÖ Badge visible sur toutes les pages (une seule fois)</li>
            <li>‚úÖ Positionn√© logiquement avec les autres contextes (Household, etc.)</li>
            <li>‚úÖ Pas de duplication de code</li>
            <li>‚úÖ Statut global coh√©rent</li>
        </ul>
    </div>

    <script type="module">
        import { formatZurich } from './components/Badges.js';

        const testLog = document.getElementById('test-log');

        function log(message) {
            const timestamp = new Date().toLocaleTimeString('fr-FR');
            testLog.textContent += `\n[${timestamp}] ${message}`;
            console.log(`[GlobalBadgeTest] ${message}`);
            testLog.scrollTop = testLog.scrollHeight;
        }

        document.addEventListener('DOMContentLoaded', async () => {
            log('Page loaded, testing global badge integration...');

            // Update demo values with real data
            document.getElementById('demo-time').textContent = formatZurich(new Date());

            // Check if WealthContextBar is loaded
            setTimeout(() => {
                const wealthBar = document.querySelector('.wealth-context-bar');
                if (wealthBar) {
                    log('‚úÖ WealthContextBar found and loaded');

                    const globalBadge = document.getElementById('global-status-badge');
                    if (globalBadge) {
                        log('‚úÖ global-status-badge container found');

                        if (globalBadge.innerHTML.trim()) {
                            log('‚úÖ Global badge rendered successfully!');
                            log(`Badge content: ${globalBadge.textContent.substring(0, 100)}...`);
                        } else {
                            log('‚ö†Ô∏è Global badge container is empty');
                        }
                    } else {
                        log('‚ùå global-status-badge container not found');
                    }
                } else {
                    log('‚ùå WealthContextBar not found - check if nav.js is loading WealthContextBar');
                }
            }, 2000); // Wait 2 seconds for everything to load

            // Update time every second
            setInterval(() => {
                document.getElementById('demo-time').textContent = formatZurich(new Date());
            }, 1000);

            log('Global badge test initialized - check above for the badge!');
        });
    </script>
</body>
</html>