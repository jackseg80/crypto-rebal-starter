<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Clear Cache</title>
</head>
<body>
    <h1>Clear All Caches</h1>
    <button onclick="clearAllCaches()">üóëÔ∏è Clear All Caches</button>
    <div id="result"></div>

    <script>
        function clearAllCaches() {
            const result = document.getElementById('result');
            result.innerHTML = 'Clearing caches...';

            try {
                // Clear localStorage completely
                const keys = Object.keys(localStorage);
                console.log('Found localStorage keys:', keys);

                // Clear all analytics cache
                const analyticsKeys = keys.filter(k => k.includes('analytics_unified'));
                analyticsKeys.forEach(key => {
                    localStorage.removeItem(key);
                    console.log('Removed:', key);
                });

                // Clear taxonomy cache
                const taxonomyKeys = keys.filter(k => k.includes('taxonomy') || k.includes('asset_groups'));
                taxonomyKeys.forEach(key => {
                    localStorage.removeItem(key);
                    console.log('Removed:', key);
                });

                // Clear risk scores cache
                const riskKeys = keys.filter(k => k.includes('risk_score'));
                riskKeys.forEach(key => {
                    localStorage.removeItem(key);
                    console.log('Removed:', key);
                });

                // Clear any other relevant caches
                const otherKeys = keys.filter(k =>
                    k.includes('cache') ||
                    k.includes('unified') ||
                    k.includes('groups') ||
                    k.includes('classification')
                );
                otherKeys.forEach(key => {
                    localStorage.removeItem(key);
                    console.log('Removed:', key);
                });

                result.innerHTML = `
                    <p>‚úÖ Cleared caches:</p>
                    <ul>
                        <li>Analytics: ${analyticsKeys.length} keys</li>
                        <li>Taxonomy: ${taxonomyKeys.length} keys</li>
                        <li>Risk scores: ${riskKeys.length} keys</li>
                        <li>Other: ${otherKeys.length} keys</li>
                    </ul>
                    <p><strong>Total: ${analyticsKeys.length + taxonomyKeys.length + riskKeys.length + otherKeys.length} keys removed</strong></p>
                    <p>Now refresh dashboard.html and analytics-unified.html</p>
                `;

                // Force a reload of shared-asset-groups.js
                setTimeout(() => {
                    window.location.href = '/static/dashboard.html';
                }, 2000);

            } catch (error) {
                result.innerHTML = `‚ùå Error: ${error.message}`;
            }
        }
    </script>
</body>
</html>