<!DOCTYPE html>
<html>
<head>
    <title>Test Allocation Display</title>
</head>
<body>
    <h1>Test Allocation Sugg√©r√©e</h1>
    <pre id="output"></pre>

    <script type="module">
        import { getUnifiedState } from './core/unified-insights-v2.js';

        const output = document.getElementById('output');

        function log(message) {
            output.textContent += message + '\n';
            console.log(message);
        }

        async function testAllocation() {
            log('üß™ Testing allocation display...');

            try {
                const unifiedState = await getUnifiedState();

                log('\nüìä Unified State Analysis:');
                log(`Decision score: ${unifiedState.decision?.score}`);
                log(`Decision source: ${unifiedState.decision?.source}`);
                log(`Strategy targets count: ${unifiedState.strategy?.targets?.length || 0}`);
                log(`Intelligence allocation keys: ${unifiedState.intelligence?.allocation ? Object.keys(unifiedState.intelligence.allocation).length : 0}`);

                if (unifiedState.strategy?.targets && unifiedState.strategy.targets.length > 0) {
                    log('\n‚úÖ Strategy Targets Found:');
                    unifiedState.strategy.targets.forEach(target => {
                        log(`  ${target.symbol}: ${(target.weight * 100).toFixed(1)}%`);
                    });
                } else {
                    log('\n‚ùå No strategy targets found');
                }

                if (unifiedState.intelligence?.allocation) {
                    log('\n‚úÖ Intelligence Allocation Found:');
                    Object.entries(unifiedState.intelligence.allocation).forEach(([asset, weight]) => {
                        log(`  ${asset}: ${weight.toFixed(1)}%`);
                    });
                } else {
                    log('\n‚ùå No intelligence allocation found');
                }

                // Test LocalStorage
                const storedAllocation = localStorage.getItem('unified_suggested_allocation');
                if (storedAllocation) {
                    const parsed = JSON.parse(storedAllocation);
                    log('\nüì¶ LocalStorage allocation found:');
                    Object.entries(parsed.targets || {}).forEach(([asset, weight]) => {
                        log(`  ${asset}: ${weight}%`);
                    });
                } else {
                    log('\nüì¶ No localStorage allocation found');
                }

            } catch (error) {
                log(`‚ùå Error: ${error.message}`);
                log(`Stack: ${error.stack}`);
            }
        }

        // Run test when page loads
        testAllocation();
    </script>
</body>
</html>