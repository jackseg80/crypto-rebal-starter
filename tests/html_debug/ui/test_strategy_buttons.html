<!DOCTYPE html>
<html>
<head>
    <title>Strategy Buttons Debug</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        .error { background: #ffebee; border: 1px solid #f44336; padding: 10px; margin: 10px 0; }
        .success { background: #e8f5e9; border: 1px solid #4caf50; padding: 10px; margin: 10px 0; }
        .info { background: #e3f2fd; border: 1px solid #2196f3; padding: 10px; margin: 10px 0; }
        button { padding: 10px; margin: 5px; }
    </style>
</head>
<body>
    <h1>Debug Strategy Buttons</h1>
    <div id="results"></div>
    
    <div>
        <h3>Test Buttons:</h3>
        <button onclick="testStrategy('macro')">Test Macro</button>
        <button onclick="testStrategy('ccs')">Test CCS</button>
        <button onclick="testStrategy('cycle')">Test Cycle</button>
        <button onclick="testStrategy('blend')">Test Blend</button>
        <button onclick="testApplyTargets()">Test Apply Targets</button>
    </div>
    
    <script type="module">
        const results = document.getElementById('results');
        
        function log(message, type = 'info') {
            const div = document.createElement('div');
            div.className = type;
            div.textContent = new Date().toLocaleTimeString() + ': ' + message;
            results.appendChild(div);
            console.log(message);
        }
        
        // Test module imports
        try {
            log('üîÑ Testing module imports...', 'info');
            
            const storeModule = await import('./core/risk-dashboard-store.js');
            log('‚úÖ Store module imported successfully', 'success');
            
            const fetcherModule = await import('./core/fetcher.js'); 
            log('‚úÖ Fetcher module imported successfully', 'success');
            
            const signalsModule = await import('./modules/signals-engine.js');
            log('‚úÖ Signals engine imported successfully', 'success');
            
            const cycleModule = await import('./modules/cycle-navigator.js');
            log('‚úÖ Cycle navigator imported successfully', 'success');
            
            const targetsModule = await import('./modules/targets-coordinator.js');
            log('‚úÖ Targets coordinator imported successfully', 'success');
            
            // Test function availability
            const { proposeTargets, applyTargets } = targetsModule;
            if (proposeTargets && applyTargets) {
                log('‚úÖ Core functions available', 'success');
            } else {
                log('‚ùå Core functions missing', 'error');
            }
            
            // Make functions available globally for button tests
            window.testStrategy = async function(mode) {
                try {
                    log(`üß™ Testing strategy: ${mode}`, 'info');
                    
                    const proposal = proposeTargets(mode);
                    log(`‚úÖ Proposal generated: ${proposal.strategy}`, 'success');
                    log(`üìä Targets: ${JSON.stringify(proposal.targets)}`, 'info');
                    
                } catch (error) {
                    log(`‚ùå Error testing ${mode}: ${error.message}`, 'error');
                }
            };
            
            window.testApplyTargets = async function() {
                try {
                    log('üß™ Testing Apply Targets...', 'info');
                    
                    const blendedProposal = proposeTargets('blend');
                    log(`üìã Generated proposal: ${blendedProposal.strategy}`, 'info');
                    
                    await applyTargets(blendedProposal);
                    log('‚úÖ Apply Targets completed successfully!', 'success');
                    
                    // Check localStorage
                    const savedTargets = localStorage.getItem('last_targets');
                    if (savedTargets) {
                        log('‚úÖ Targets saved to localStorage', 'success');
                        log(`üìÇ Saved data: ${savedTargets.substring(0, 200)}...`, 'info');
                    } else {
                        log('‚ùå No targets found in localStorage', 'error');
                    }
                    
                } catch (error) {
                    log(`‚ùå Error in Apply Targets: ${error.message}`, 'error');
                }
            };
            
        } catch (error) {
            log(`‚ùå Module import failed: ${error.message}`, 'error');
            log(`Stack: ${error.stack}`, 'error');
        }
        
        // Catch any errors
        window.addEventListener('error', (event) => {
            log(`‚ùå JavaScript Error: ${event.error?.message || event.message}`, 'error');
            if (event.error?.stack) {
                log(`Stack: ${event.error.stack}`, 'error');
            }
        });
        
        window.addEventListener('unhandledrejection', (event) => {
            log(`‚ùå Unhandled Promise Rejection: ${event.reason}`, 'error');
        });
    </script>
</body>
</html>