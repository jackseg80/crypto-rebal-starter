<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Debug LocalStorage Scores</title>
    <style>
        body { font-family: monospace; padding: 20px; background: #1a1a1a; color: #00ff00; }
        .score-row { margin: 10px 0; padding: 5px; background: #333; }
        .missing { color: #ff6666; }
        .present { color: #66ff66; }
        button { margin: 5px; padding: 10px; background: #333; color: white; border: none; cursor: pointer; }
    </style>
</head>
<body>
    <h1>üîç Debug LocalStorage Scores</h1>
    <div id="output"></div>
    <button onclick="checkScores()">üîÑ Check Scores</button>
    <button onclick="clearScores()">üóëÔ∏è Clear All Scores</button>
    
    <script src="global-config.js"></script>
    <script>
        function checkScores() {
            const output = document.getElementById('output');
            const dataSource = globalConfig?.get('data_source') || 'unknown';
            
            const scores = {
                'risk_score_onchain': localStorage.getItem('risk_score_onchain'),
                'risk_score_risk': localStorage.getItem('risk_score_risk'),
                'risk_score_blended': localStorage.getItem('risk_score_blended'),
                'risk_score_ccs': localStorage.getItem('risk_score_ccs'),
                'risk_score_timestamp': localStorage.getItem('risk_score_timestamp'),
                'risk_score_data_source': localStorage.getItem('risk_score_data_source')
            };
            
            let html = `<h2>üìä Current Data Source: ${dataSource}</h2>`;
            html += `<p>üïí Time: ${new Date().toLocaleString()}</p>`;
            
            Object.entries(scores).forEach(([key, value]) => {
                const present = value !== null && value !== '';
                const className = present ? 'present' : 'missing';
                const displayValue = present ? value : '(empty)';
                html += `<div class="score-row ${className}">
                    <strong>${key}:</strong> ${displayValue}
                </div>`;
            });
            
            // Also check if scores are numbers
            const numericScores = ['risk_score_onchain', 'risk_score_risk', 'risk_score_blended', 'risk_score_ccs'];
            html += '<h3>üî¢ Numeric Validation:</h3>';
            numericScores.forEach(key => {
                const value = localStorage.getItem(key);
                const isValid = value && !isNaN(parseFloat(value));
                const className = isValid ? 'present' : 'missing';
                html += `<div class="score-row ${className}">
                    ${key}: ${isValid ? '‚úì Valid number' : '‚úó Invalid/missing'}
                </div>`;
            });
            
            output.innerHTML = html;
        }
        
        function clearScores() {
            const keys = ['risk_score_onchain', 'risk_score_risk', 'risk_score_blended', 'risk_score_ccs', 'risk_score_timestamp', 'risk_score_data_source'];
            keys.forEach(key => localStorage.removeItem(key));
            console.log('üóëÔ∏è All scores cleared from localStorage');
            checkScores();
        }
        
        // Auto-check on load
        checkScores();
        
        // Listen for storage changes
        window.addEventListener('storage', (e) => {
            if (e.key && e.key.startsWith('risk_score_')) {
                console.log('üîÑ Score updated:', e.key, '‚Üí', e.newValue);
                setTimeout(checkScores, 100);
            }
        });
    </script>
</body>
</html>