INFO:     Will watch for changes in these directories: ['D:\\Python\\crypto-rebal-starter']
INFO:     Uvicorn running on http://127.0.0.1:8000 (Press CTRL+C to quit)
INFO:     Started reloader process [16980] using WatchFiles
2025-10-09 10:43:56,626 INFO services.execution.exchange_adapter: Registered exchange: simulator (simulator)
2025-10-09 10:43:56,628 INFO services.execution.exchange_adapter: Registered exchange: enhanced_simulator (simulator)
2025-10-09 10:43:56,628 WARNING services.execution.exchange_adapter: Binance API key not found in environment - will use simulator mode
2025-10-09 10:43:56,628 INFO services.execution.exchange_adapter: Registered exchange: binance (centralized)
2025-10-09 10:43:56,628 WARNING services.execution.exchange_adapter: Kraken API key not found in environment - will use simulator mode
2025-10-09 10:43:56,628 INFO services.execution.exchange_adapter: Registered exchange: kraken (centralized)
2025-10-09 10:43:56,628 INFO services.execution.exchange_adapter: Default exchanges configured
2025-10-09 10:43:59,345 INFO services.intelligence.explainable_ai: ExplainableAI Engine initialized - SHAP: False, LIME: False
2025-10-09 10:43:59,345 INFO services.intelligence.human_loop: HumanInTheLoop Engine initialized
2025-10-09 10:43:59,345 INFO services.intelligence.feedback_learning: FeedbackLearning Engine initialized
2025-10-09 10:43:59,345 INFO services.orchestration.hybrid_orchestrator: HybridOrchestrator initialized
2025-10-09 10:43:59,345 INFO services.execution.governance: Phase 3C Hybrid Intelligence components initialized
2025-10-09 10:43:59,345 INFO services.execution.governance: GovernanceEngine initialized with TTL/cooldown separation, Hybrid Intelligence: True
2025-10-09 10:43:59,395 INFO services.analytics.history_manager: Loaded 0 rebalance sessions from history
2025-10-09 10:43:59,496 INFO services.analytics.execution_history: Loaded 0 recent sessions
2025-10-09 10:43:59,506 INFO services.notifications.alert_manager: Alert rule added: Portfolio Drift Alert
2025-10-09 10:43:59,506 INFO services.notifications.alert_manager: Alert rule added: Execution Failure Rate
2025-10-09 10:43:59,506 INFO services.notifications.alert_manager: Alert rule added: Low Performance Alert
2025-10-09 10:43:59,707 INFO services.notifications.notification_sender: Notification config added: console
2025-10-09 10:43:59,747 INFO services.ml_pipeline_manager_optimized: Optimized ML Pipeline Manager initialized with cache size 8, max memory 3072MB
2025-10-09 10:44:00,038 INFO crypto-rebalancer: FastAPI initialized: docs=/docs redoc=/redoc openapi=/openapi.json
2025-10-09 10:44:00,226 WARNING services.monitoring.phase3_health_monitor: Redis not available for health monitoring storage: duplicate base class TimeoutError
2025-10-09 10:44:00,288 INFO crypto-rebalancer: \U0001f3ad Crypto-Toolbox: FastAPI native scraper enabled
INFO:     Started server process [23584]
INFO:     Waiting for application startup.
2025-10-09 10:44:00,293 INFO api.startup: \U0001f680 FastAPI started successfully
2025-10-09 10:44:00,293 INFO api.startup: \u26a1 ML models will load on first request (lazy loading)
INFO:     Application startup complete.
2025-10-09 10:44:00,404 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:00,406 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:00,406 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:00,416 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 365 days
2025-10-09 10:44:00,573 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:00,573 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:00,574 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:00,574 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:00,680 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 85.0
2025-10-09 10:44:00,680 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:00,680 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:44:00,680 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:44:00,680 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:44:00,680 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:44:00,680 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:00,680 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:00,680 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:00,775 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:44:00,775 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=85.0, penalties=0.0, final=85.0
2025-10-09 10:44:00,775 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:00,775 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:00,775 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:00,775 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:00,775 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:00,945 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:44:00,945 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.33, Vol=0.20, MaxDD=-10.64%, RiskScore=85.0, RiskStructural=47.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:00,945 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:44:00,946 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 85.0, 'risk_score_v2': 85.0, 'sharpe_legacy': 1.3262890739554856, 'sharpe_v2': 1.3262890739554856, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 47.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 5.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:00,947 INFO crypto-rebalancer: {"ts": 1759999440.947535, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 546.58, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:00,947 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (546 ms)
INFO:     127.0.0.1:6019 - "GET /api/risk/dashboard?min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:44:03,294 INFO api.startup: \U0001f4e6 Starting background ML models initialization...
2025-10-09 10:44:03,337 INFO services.ml.models.volatility_predictor: Using device: cuda
2025-10-09 10:44:03,337 INFO services.ml.models.correlation_forecaster: CorrelationForecaster initialized with device: cuda
2025-10-09 10:44:03,338 INFO services.ml.models.regime_detector: RegimeDetector using device: cuda
2025-10-09 10:44:03,338 INFO services.ml.models.volatility_predictor: Using device: cuda
2025-10-09 10:44:03,338 INFO services.ml.models.regime_detector: RegimeDetector using device: cuda
2025-10-09 10:44:03,338 INFO services.ml.models.correlation_forecaster: CorrelationForecaster initialized with device: cuda
2025-10-09 10:44:03,339 INFO services.ml.models.rebalancing_engine: RebalancingEngine initialized with safety level: moderate
2025-10-09 10:44:03,339 INFO services.risk.advanced_risk_engine: AdvancedRiskEngine initialized: VaR methods=['parametric', 'historical', 'monte_carlo'], stress scenarios=5, MC sims=10000
2025-10-09 10:44:03,339 INFO services.ml.orchestrator: ML Orchestrator initialized with configuration support
2025-10-09 10:44:03,339 INFO api.startup: \u2705 5 ML models forced to ready status
2025-10-09 10:44:03,613 INFO crypto-rebalancer: {"ts": 1759999443.6138976, "method": "GET", "path": "/api/config/data-source", "status": 200, "duration_ms": 1.12, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:44:03,614 INFO crypto-rebalancer: GET /api/config/data-source -> 200 (1 ms)
INFO:     127.0.0.1:3280 - "GET /api/config/data-source HTTP/1.1" 200 OK
2025-10-09 10:44:03,614 INFO httpx: HTTP Request: GET http://127.0.0.1:8000/api/config/data-source "HTTP/1.1 200 OK"
2025-10-09 10:44:03,615 INFO services.ml.orchestrator: Using data source from config API: cointracking
2025-10-09 10:44:03,621 INFO services.ml.data_pipeline: Price data fetched for BTC: 90 days
2025-10-09 10:44:03,626 INFO services.ml.data_pipeline: Price data fetched for ETH: 90 days
2025-10-09 10:44:03,631 INFO services.ml.data_pipeline: Price data fetched for SOL: 90 days
2025-10-09 10:44:03,631 INFO services.ml.orchestrator: Ensemble prediction generated: bullish (confidence: 0.64)
2025-10-09 10:44:03,631 INFO api.startup: \u2705 Governance Engine initialized: 78.2% confidence, 4 sources
2025-10-09 10:44:03,632 INFO services.alerts.alert_engine: Loaded configuration from config\alerts_rules.json
2025-10-09 10:44:03,632 INFO services.execution.phase_engine: PhaseEngine initialized with 3min cache TTL
2025-10-09 10:44:03,632 INFO services.alerts.alert_engine: Multi-timeframe analysis enabled with temporal gating
2025-10-09 10:44:03,632 INFO services.alerts.cross_asset_correlation: CrossAssetCorrelationAnalyzer initialized: mode=ConcentrationMode.CLUSTERING, windows=['1h', '4h', '1d']
2025-10-09 10:44:03,632 INFO services.alerts.alert_engine: Cross-asset correlation analysis enabled
2025-10-09 10:44:03,632 INFO services.alerts.alert_engine: ML Alert Predictor disabled
2025-10-09 10:44:03,632 INFO services.risk.advanced_risk_engine: AdvancedRiskEngine initialized: VaR methods=['parametric', 'historical', 'monte_carlo'], stress scenarios=5, MC sims=10000
2025-10-09 10:44:03,632 INFO services.alerts.alert_engine: Advanced Risk Engine enabled - VaR/Stress testing active
2025-10-09 10:44:03,632 INFO services.alerts.alert_engine: Phase 3B Real-time alert streaming enabled
2025-10-09 10:44:03,632 INFO services.alerts.alert_engine: Phase-aware alerting enabled: lag=15min, persistence=3
2025-10-09 10:44:03,632 INFO services.alerts.alert_engine: AlertEngine initialized for host Asus_G18:23584 with config: config/alerts_rules.json
2025-10-09 10:44:03,632 INFO api.alerts_endpoints: Alert engine initialized for API endpoints
2025-10-09 10:44:03,634 INFO api.startup: \u2705 Unified alert facade initialized for legacy system migration
2025-10-09 10:44:03,634 INFO services.alerts.alert_storage: File scheduler lock acquired by Asus_G18:23584
2025-10-09 10:44:03,635 INFO services.alerts.alert_engine: Alert scheduler active on Asus_G18:23584
2025-10-09 10:44:03,635 INFO api.startup: \u2705 AlertEngine scheduler started successfully
2025-10-09 10:44:03,635 INFO api.startup: \U0001f3ad Initializing Playwright browser for crypto-toolbox scraping...
2025-10-09 10:44:03,635 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:44:03,635 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0700 (7.00%), cap_smoothed=0.0780 (7.80%), cap_engine=0.0780 (7.80%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0780 (7.80%), cap_final=0.0780 (7.80%), var_state=normal, stale_state=normal, signals_age=0s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:03,785 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-10' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:44:03,788 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:44:03,788 WARNING api.startup: \u26a0\ufe0f Playwright initialization failed (non-blocking): 
2025-10-09 10:44:03,788 INFO api.startup: \U0001f4ca crypto-toolbox endpoints will use lazy browser launch on first request
2025-10-09 10:44:03,868 INFO api.scheduler: \U0001f680 Initializing APScheduler...
2025-10-09 10:44:03,928 INFO apscheduler.scheduler: Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-10-09 10:44:03,928 INFO apscheduler.scheduler: Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-10-09 10:44:03,928 INFO apscheduler.scheduler: Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-10-09 10:44:03,928 INFO apscheduler.scheduler: Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-10-09 10:44:03,928 INFO apscheduler.scheduler: Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-10-09 10:44:03,929 INFO apscheduler.scheduler: Adding job tentatively -- it will be properly scheduled when the scheduler starts
2025-10-09 10:44:03,930 INFO apscheduler.scheduler: Added job "P&L Snapshot Intraday" to job store "default"
2025-10-09 10:44:03,930 INFO apscheduler.scheduler: Added job "P&L Snapshot EOD" to job store "default"
2025-10-09 10:44:03,930 INFO apscheduler.scheduler: Added job "OHLCV Update Daily" to job store "default"
2025-10-09 10:44:03,930 INFO apscheduler.scheduler: Added job "OHLCV Update Hourly" to job store "default"
2025-10-09 10:44:03,930 INFO apscheduler.scheduler: Added job "Staleness Monitor" to job store "default"
2025-10-09 10:44:03,930 INFO apscheduler.scheduler: Added job "API Warmers" to job store "default"
2025-10-09 10:44:03,930 INFO apscheduler.scheduler: Scheduler started
2025-10-09 10:44:03,930 INFO api.scheduler: \u2705 APScheduler started with 6 jobs:
2025-10-09 10:44:03,930 INFO api.scheduler:    - pnl_intraday: next run at 2025-10-09 10:45:26 CEST
2025-10-09 10:44:03,930 INFO api.scheduler:    - api_warmers: next run at 2025-10-09 10:54:50 CEST
2025-10-09 10:44:03,930 INFO api.scheduler:    - ohlcv_hourly: next run at 2025-10-09 11:05:16 CEST
2025-10-09 10:44:03,930 INFO api.scheduler:    - staleness_monitor: next run at 2025-10-09 11:15:00 CEST
2025-10-09 10:44:03,930 INFO api.scheduler:    - pnl_eod: next run at 2025-10-09 23:59:29 CEST
2025-10-09 10:44:03,930 INFO api.scheduler:    - ohlcv_daily: next run at 2025-10-10 03:10:15 CEST
2025-10-09 10:44:03,930 INFO api.startup: \u2705 Task scheduler initialized successfully
2025-10-09 10:44:03,930 INFO api.startup: \U0001f3af Startup complete: ML=5 models, Governance=\u2705, Alerts=\u2705, Playwright=\u23ed\ufe0f, Scheduler=\u2705
2025-10-09 10:44:04,220 INFO httpx: HTTP Request: GET https://api.coingecko.com/api/v3/global "HTTP/1.1 200 OK"
2025-10-09 10:44:04,626 INFO api.market_endpoints: Fetching market prices for 10 symbols over 30 days
2025-10-09 10:44:04,626 WARNING api.market_endpoints: BTC data not available for relative strength calculation
2025-10-09 10:44:04,626 INFO api.market_endpoints: Market prices returned for 10 symbols
2025-10-09 10:44:04,627 INFO crypto-rebalancer: {"ts": 1759999444.6271243, "method": "GET", "path": "/api/market/prices", "status": 200, "duration_ms": 0.75, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:44:04,627 INFO crypto-rebalancer: GET /api/market/prices -> 200 (0 ms)
INFO:     127.0.0.1:5476 - "GET /api/market/prices?days=30 HTTP/1.1" 200 OK
2025-10-09 10:44:04,627 INFO httpx: HTTP Request: GET http://localhost:8000/api/market/prices?days=30 "HTTP/1.1 200 OK"
2025-10-09 10:44:05,044 INFO api.analytics_endpoints: Calculating market breadth metrics
2025-10-09 10:44:05,044 ERROR api.analytics_endpoints: Error calculating market breadth: No module named 'api.balances'
2025-10-09 10:44:05,045 INFO crypto-rebalancer: {"ts": 1759999445.044973, "method": "GET", "path": "/api/analytics/market-breadth", "status": 200, "duration_ms": 0.86, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:44:05,045 INFO crypto-rebalancer: GET /api/analytics/market-breadth -> 200 (1 ms)
INFO:     127.0.0.1:5478 - "GET /api/analytics/market-breadth HTTP/1.1" 200 OK
2025-10-09 10:44:05,045 INFO httpx: HTTP Request: GET http://localhost:8000/api/analytics/market-breadth "HTTP/1.1 200 OK"
2025-10-09 10:44:05,055 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0700 (7.00%), cap_smoothed=0.0764 (7.64%), cap_engine=0.0764 (7.64%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0764 (7.64%), cap_final=0.0764 (7.64%), var_state=normal, stale_state=normal, signals_age=1s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:05,055 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0700 (7.00%), cap_smoothed=0.0751 (7.51%), cap_engine=0.0751 (7.51%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0751 (7.51%), cap_final=0.0751 (7.51%), var_state=normal, stale_state=normal, signals_age=1s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:05,055 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0700 (7.00%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=1s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:05,055 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=1s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:05,055 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:44:05,055 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:44:17,600 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:17,602 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:17,603 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:17,614 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:44:17,692 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:17,692 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:17,692 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:17,693 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:17,788 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:44:17,788 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:17,788 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:44:17,788 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:44:17,788 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:44:17,788 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:44:17,788 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:17,788 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:17,788 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:17,883 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:44:17,883 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:44:17,883 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:17,883 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:17,883 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:17,883 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:17,883 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:18,058 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:44:18,058 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:18,058 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:44:18,058 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:18,060 INFO crypto-rebalancer: {"ts": 1759999458.060007, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 460.58, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:7322 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:44:18,060 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (460 ms)
2025-10-09 10:44:18,061 INFO services.risk.advanced_risk_engine: AdvancedRiskEngine initialized: VaR methods=['parametric', 'historical', 'monte_carlo'], stress scenarios=5, MC sims=10000
2025-10-09 10:44:18,061 INFO services.intelligence.explainable_ai: ExplainableAI Engine initialized - SHAP: False, LIME: False
2025-10-09 10:44:18,061 INFO services.intelligence.human_loop: HumanInTheLoop Engine initialized
2025-10-09 10:44:18,061 INFO services.intelligence.feedback_learning: FeedbackLearning Engine initialized
2025-10-09 10:44:18,061 INFO services.orchestration.hybrid_orchestrator: HybridOrchestrator initialized
2025-10-09 10:44:18,061 INFO services.intelligence.explainable_ai: ExplainableAI Engine initialized - SHAP: False, LIME: False
2025-10-09 10:44:18,061 INFO services.intelligence.human_loop: HumanInTheLoop Engine initialized
2025-10-09 10:44:18,061 INFO services.intelligence.feedback_learning: FeedbackLearning Engine initialized
2025-10-09 10:44:18,061 INFO services.orchestration.hybrid_orchestrator: HybridOrchestrator initialized
2025-10-09 10:44:18,061 INFO services.execution.governance: Phase 3C Hybrid Intelligence components initialized
2025-10-09 10:44:18,061 INFO services.execution.governance: GovernanceEngine initialized with TTL/cooldown separation, Hybrid Intelligence: True
2025-10-09 10:44:18,061 INFO services.streaming.realtime_engine: Initializing RealtimeEngine...
2025-10-09 10:44:18,063 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:18,064 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:18,064 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:18,073 INFO crypto-rebalancer: {"ts": 1759999458.073094, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 12.57, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:18,073 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:18,075 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:18,075 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:18,183 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:44:18,255 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:18,255 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:18,255 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:18,256 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:18,374 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:44:18,374 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:18,374 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:44:18,374 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:44:18,374 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:44:18,374 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:44:18,374 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:18,374 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:18,374 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:18,472 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:44:18,472 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:44:18,472 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:18,472 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:18,472 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:18,472 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:18,472 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:18,663 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:44:18,663 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:18,663 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:44:18,663 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:18,664 INFO crypto-rebalancer: GET /balances/current -> 200 (604 ms)
INFO:     127.0.0.1:8519 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:44:18,665 INFO crypto-rebalancer: {"ts": 1759999458.665087, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 601.92, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:18,665 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (602 ms)
INFO:     127.0.0.1:7322 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:44:18,666 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:18,668 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:18,668 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:18,676 INFO crypto-rebalancer: {"ts": 1759999458.676449, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 10.47, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:18,676 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=15s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:18,677 INFO crypto-rebalancer: GET /balances/current -> 200 (11 ms)
INFO:     127.0.0.1:9110 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:44:18,677 INFO crypto-rebalancer: {"ts": 1759999458.6773918, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 0.98, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:18,677 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (1 ms)
INFO:     127.0.0.1:7322 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:44:22,118 ERROR services.streaming.realtime_engine: Failed to initialize Redis Streams: Error Multiple exceptions: [Errno 10061] Connect call failed ('::1', 6379, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 6379) connecting to localhost:6379.
2025-10-09 10:44:22,118 WARNING services.streaming.realtime_engine: Redis Streams not available - running in WebSocket-only mode
2025-10-09 10:44:22,118 INFO services.streaming.realtime_engine: RealtimeEngine initialized successfully
2025-10-09 10:44:22,118 INFO api.unified_phase3_endpoints: All Phase 3 components initialized successfully
2025-10-09 10:44:22,118 INFO crypto-rebalancer: {"ts": 1759999462.118751, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 4058.19, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:22,118 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (4058 ms)
INFO:     127.0.0.1:10939 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:44:22,120 INFO crypto-rebalancer: {"ts": 1759999462.120781, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 0.68, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:22,120 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (0 ms)
INFO:     127.0.0.1:7322 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:44:39,337 INFO crypto-rebalancer: {"ts": 1759999479.3373077, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 0.82, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:39,337 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (1 ms)
INFO:     127.0.0.1:2325 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:44:39,338 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:39,340 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:39,340 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:39,346 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:44:39,419 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:39,419 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:39,419 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:39,419 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:39,510 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:44:39,510 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:39,510 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:44:39,510 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:44:39,510 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:44:39,510 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:44:39,510 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:39,510 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:39,511 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:39,606 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:44:39,606 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:44:39,606 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:39,607 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:39,607 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:39,607 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:39,607 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:39,782 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:44:39,782 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:39,782 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:44:39,782 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:39,783 INFO crypto-rebalancer: {"ts": 1759999479.7838104, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 446.05, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:39,784 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (446 ms)
INFO:     127.0.0.1:13714 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:44:39,784 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:39,785 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:39,785 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:39,793 INFO crypto-rebalancer: {"ts": 1759999479.7938519, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 10.5, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:39,794 INFO crypto-rebalancer: GET /balances/current -> 200 (455 ms)
INFO:     127.0.0.1:12683 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:44:40,874 INFO crypto-rebalancer: {"ts": 1759999480.874032, "method": "GET", "path": "/static/analytics-unified.html", "status": 200, "duration_ms": 38.79, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:40,874 INFO crypto-rebalancer: GET /static/analytics-unified.html -> 200 (39 ms)
INFO:     127.0.0.1:12683 - "GET /static/analytics-unified.html HTTP/1.1" 200 OK
2025-10-09 10:44:40,906 INFO crypto-rebalancer: {"ts": 1759999480.9067492, "method": "GET", "path": "/.well-known/appspecific/com.chrome.devtools.json", "status": 404, "duration_ms": 1.03, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:40,906 INFO crypto-rebalancer: GET /.well-known/appspecific/com.chrome.devtools.json -> 404 (1 ms)
INFO:     127.0.0.1:12683 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
2025-10-09 10:44:41,058 INFO crypto-rebalancer: {"ts": 1759999481.0582726, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 0.84, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:41,058 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (1 ms)
INFO:     127.0.0.1:12683 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:44:41,061 INFO services.streaming.realtime_engine: Initializing RealtimeEngine...
2025-10-09 10:44:41,065 INFO crypto-rebalancer: {"ts": 1759999481.065307, "method": "GET", "path": "/config/users.json", "status": 200, "duration_ms": 3.43, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:41,065 INFO crypto-rebalancer: GET /config/users.json -> 200 (3 ms)
INFO:     127.0.0.1:13714 - "GET /config/users.json HTTP/1.1" 200 OK
2025-10-09 10:44:41,070 INFO api.deps: Active user: jack
2025-10-09 10:44:41,073 INFO crypto-rebalancer: {"ts": 1759999481.0735984, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 4.29, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:41,073 INFO crypto-rebalancer: GET /api/users/sources -> 200 (4 ms)
INFO:     127.0.0.1:13714 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:44:41,075 INFO api.crypto_toolbox_endpoints: \U0001f504 Scraping fresh data...
2025-10-09 10:44:41,075 WARNING api.crypto_toolbox_endpoints: \u26a0\ufe0f Browser not connected, re-launching...
2025-10-09 10:44:41,076 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:44:41,076 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-41' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:44:41,078 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:44:41,079 ERROR api.crypto_toolbox_endpoints: \u274c Crypto-toolbox scraping error
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 377, in get_crypto_toolbox_data
    return await _get_data(force=force)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 345, in _get_data
    data = await _scrape_crypto_toolbox()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 219, in _scrape_crypto_toolbox
    browser = await _ensure_browser()
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 166, in _ensure_browser
    await startup_playwright()
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 109, in startup_playwright
    _playwright_instance = await async_playwright().start()
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 51, in start
    return await self.__aenter__()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 46, in __aenter__
    playwright = AsyncPlaywright(next(iter(done)).result())
                                 ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:44:41,082 INFO crypto-rebalancer: {"ts": 1759999481.082451, "method": "GET", "path": "/api/crypto-toolbox", "status": 502, "duration_ms": 7.5, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:41,082 INFO api.deps: Active user: jack
2025-10-09 10:44:41,084 INFO crypto-rebalancer: GET /api/crypto-toolbox -> 502 (9 ms)
INFO:     127.0.0.1:12683 - "GET /api/crypto-toolbox HTTP/1.1" 502 Bad Gateway
2025-10-09 10:44:41,084 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=37s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:41,084 INFO services.execution.score_registry: ScoreRegistry initialized with config path: config\score_registry.json
2025-10-09 10:44:41,085 INFO services.execution.score_registry: Score config loaded successfully (version: 1.0)
2025-10-09 10:44:41,085 INFO services.execution.phase_engine: PhaseEngine initialized with 3min cache TTL
2025-10-09 10:44:41,250 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:44:41,252 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:44:41,252 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:44:41,269 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:44:41,271 INFO crypto-rebalancer: {"ts": 1759999481.2714133, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 195.09, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:41,271 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:41,273 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:41,273 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:41,281 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 365 days
2025-10-09 10:44:41,528 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:41,528 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:41,528 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:41,528 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:41,670 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 85.0
2025-10-09 10:44:41,670 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:41,671 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:44:41,671 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:44:41,671 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:44:41,671 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:44:41,671 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:41,671 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:41,671 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:41,847 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:44:41,847 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=85.0, penalties=0.0, final=85.0
2025-10-09 10:44:41,847 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:41,847 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:41,847 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:41,848 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:41,848 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:42,123 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:44:42,123 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.33, Vol=0.20, MaxDD=-10.64%, RiskScore=85.0, RiskStructural=47.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:42,123 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:44:42,123 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 85.0, 'risk_score_v2': 85.0, 'sharpe_legacy': 1.3262890739554856, 'sharpe_v2': 1.3262890739554856, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 47.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 5.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:42,125 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (1050 ms)
INFO:     127.0.0.1:2325 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:44:42,126 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:44:42,317 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:42,317 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:42,317 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:42,318 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:42,508 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:44:42,508 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:42,508 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:44:42,508 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:44:42,508 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:44:42,508 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:44:42,508 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:42,508 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:42,508 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:42,675 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:44:42,675 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:44:42,675 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:42,675 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:42,675 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:42,675 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:42,676 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:42,973 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63079261519336
2025-10-09 10:44:42,973 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:42,973 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:44:42,973 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226625212667007, 'sharpe_v2': 1.6226625212667007, 'portfolio_structure_score': 82.63079261519336, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763666421847605, 'gri': 16.69284074262188, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.36920738480664, 'final_score': 82.63079261519336, 'inputs': {'hhi': 0.1851293656358313, 'memes_pct': 0.016909166054619014, 'gri': 3.338568148524376, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:42,976 INFO crypto-rebalancer: {"ts": 1759999482.976465, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 1725.84, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:42,978 INFO crypto-rebalancer: {"ts": 1759999482.9784646, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 1897.36, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:42,978 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (1894 ms)
INFO:     127.0.0.1:3147 - "GET /api/risk/dashboard?min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:44:42,979 INFO api.deps: Active user: jack
INFO:     127.0.0.1:13714 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:44:42,979 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (1898 ms)
2025-10-09 10:44:42,982 INFO crypto-rebalancer: {"ts": 1759999482.9827073, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 6.99, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:42,983 INFO crypto-rebalancer: GET /api/users/sources -> 200 (7 ms)
INFO:     127.0.0.1:12683 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:44:42,985 INFO crypto-rebalancer: {"ts": 1759999482.9849787, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 5.73, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:42,985 INFO crypto-rebalancer: GET /taxonomy -> 200 (6 ms)
INFO:     127.0.0.1:9940 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:44:42,990 INFO crypto-rebalancer: {"ts": 1759999482.9903224, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.1, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:42,990 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:9940 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:44:42,997 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:43,000 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:43,000 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:43,013 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:44:43,137 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:43,137 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:43,137 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:43,137 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:43,320 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:44:43,320 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:43,320 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:44:43,320 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:44:43,320 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:44:43,320 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:44:43,320 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:43,320 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:43,320 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:43,464 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:44:43,464 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:44:43,464 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:43,464 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:43,464 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:43,464 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:43,464 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:43,771 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:44:43,771 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:43,771 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:44:43,772 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:43,781 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:43,784 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:43,784 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:43,797 INFO crypto-rebalancer: {"ts": 1759999483.7973664, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 801.92, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:43,797 INFO crypto-rebalancer: {"ts": 1759999483.7976875, "method": "GET", "path": "/api/ml/debug/pipeline-info", "status": 200, "duration_ms": 800.73, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:43,798 INFO crypto-rebalancer: {"ts": 1759999483.7986772, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 802.45, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:43,798 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (803 ms)
INFO:     127.0.0.1:9940 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:44:43,799 INFO crypto-rebalancer: GET /api/ml/debug/pipeline-info -> 200 (802 ms)
INFO:     127.0.0.1:13714 - "GET /api/ml/debug/pipeline-info HTTP/1.1" 200 OK
2025-10-09 10:44:43,799 INFO crypto-rebalancer: GET /balances/current -> 200 (803 ms)
INFO:     127.0.0.1:12683 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:44:43,799 INFO api.deps: Active user: jack
2025-10-09 10:44:43,799 INFO crypto-rebalancer: {"ts": 1759999483.7998998, "method": "GET", "path": "/favicon.ico", "status": 200, "duration_ms": 2.64, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:43,803 INFO crypto-rebalancer: GET /favicon.ico -> 200 (6 ms)
INFO:     127.0.0.1:2325 - "GET /favicon.ico HTTP/1.1" 200 OK
2025-10-09 10:44:43,803 INFO crypto-rebalancer: {"ts": 1759999483.8038764, "method": "GET", "path": "/api/users/settings", "status": 200, "duration_ms": 6.68, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:43,804 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=40s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:43,804 INFO crypto-rebalancer: GET /api/users/settings -> 200 (8 ms)
INFO:     127.0.0.1:3147 - "GET /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:44:43,805 INFO crypto-rebalancer: {"ts": 1759999483.8054318, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 1.59, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:43,806 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (2 ms)
INFO:     127.0.0.1:9940 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:44:43,808 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=40s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:43,808 INFO crypto-rebalancer: {"ts": 1759999483.8087919, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 1.06, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:43,809 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (1 ms)
INFO:     127.0.0.1:3147 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:44:43,822 INFO services.ml.data_pipeline: Price data fetched for BTC: 90 days
2025-10-09 10:44:43,823 INFO crypto-rebalancer: {"ts": 1759999483.8233705, "method": "GET", "path": "/api/ml/volatility/predict/BTC", "status": 200, "duration_ms": 12.09, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:43,823 INFO crypto-rebalancer: GET /api/ml/volatility/predict/BTC -> 200 (12 ms)
INFO:     127.0.0.1:2325 - "GET /api/ml/volatility/predict/BTC?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:44:43,823 INFO api.deps: Active user: jack
2025-10-09 10:44:43,826 INFO api.user_settings_endpoints: Settings saved for user jack: 17 keys
2025-10-09 10:44:43,826 INFO crypto-rebalancer: {"ts": 1759999483.8268747, "method": "PUT", "path": "/api/users/settings", "status": 200, "duration_ms": 17.36, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:43,827 INFO crypto-rebalancer: PUT /api/users/settings -> 200 (18 ms)
INFO:     127.0.0.1:9940 - "PUT /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:44:43,837 INFO services.ml.data_pipeline: Price data fetched for ETH: 90 days
2025-10-09 10:44:43,838 INFO crypto-rebalancer: {"ts": 1759999483.838099, "method": "GET", "path": "/api/ml/volatility/predict/ETH", "status": 200, "duration_ms": 10.88, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:43,838 INFO crypto-rebalancer: GET /api/ml/volatility/predict/ETH -> 200 (11 ms)
INFO:     127.0.0.1:2325 - "GET /api/ml/volatility/predict/ETH?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:44:44,088 INFO httpx: HTTP Request: GET https://api.coingecko.com/api/v3/global "HTTP/1.1 200 OK"
2025-10-09 10:44:44,317 INFO crypto-rebalancer: {"ts": 1759999484.317648, "method": "GET", "path": "/api/config/data-source", "status": 200, "duration_ms": 1.7, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:44:44,317 INFO crypto-rebalancer: GET /api/config/data-source -> 200 (2 ms)
INFO:     127.0.0.1:9546 - "GET /api/config/data-source HTTP/1.1" 200 OK
2025-10-09 10:44:44,318 INFO httpx: HTTP Request: GET http://127.0.0.1:8000/api/config/data-source "HTTP/1.1 200 OK"
2025-10-09 10:44:44,319 INFO services.ml.orchestrator: Using data source from config API: cointracking
2025-10-09 10:44:44,319 INFO crypto-rebalancer: {"ts": 1759999484.3195899, "method": "GET", "path": "/api/ml/regime/current", "status": 200, "duration_ms": 477.91, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:44,319 INFO crypto-rebalancer: GET /api/ml/regime/current -> 200 (478 ms)
INFO:     127.0.0.1:2325 - "GET /api/ml/regime/current HTTP/1.1" 200 OK
2025-10-09 10:44:44,324 INFO crypto-rebalancer: {"ts": 1759999484.324612, "method": "GET", "path": "/api/ml/sentiment/fear-greed", "status": 200, "duration_ms": 1.14, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:44,324 INFO crypto-rebalancer: GET /api/ml/sentiment/fear-greed -> 200 (1 ms)
INFO:     127.0.0.1:2325 - "GET /api/ml/sentiment/fear-greed?days=1 HTTP/1.1" 200 OK
2025-10-09 10:44:44,571 INFO api.market_endpoints: Fetching market prices for 10 symbols over 30 days
2025-10-09 10:44:44,571 WARNING api.market_endpoints: BTC data not available for relative strength calculation
2025-10-09 10:44:44,571 INFO api.market_endpoints: Market prices returned for 10 symbols
2025-10-09 10:44:44,572 INFO crypto-rebalancer: {"ts": 1759999484.5721354, "method": "GET", "path": "/api/market/prices", "status": 200, "duration_ms": 1.71, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:44:44,572 INFO crypto-rebalancer: GET /api/market/prices -> 200 (2 ms)
INFO:     127.0.0.1:9548 - "GET /api/market/prices?days=30 HTTP/1.1" 200 OK
2025-10-09 10:44:44,573 INFO httpx: HTTP Request: GET http://localhost:8000/api/market/prices?days=30 "HTTP/1.1 200 OK"
2025-10-09 10:44:44,822 INFO crypto-rebalancer: {"ts": 1759999484.8223662, "method": "GET", "path": "/static/components/UnifiedInsights.js", "status": 200, "duration_ms": 6.68, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:44,822 INFO crypto-rebalancer: GET /static/components/UnifiedInsights.js -> 200 (7 ms)
INFO:     127.0.0.1:2325 - "GET /static/components/UnifiedInsights.js?v=2025-10-09T08:44:44.813Z HTTP/1.1" 200 OK
2025-10-09 10:44:44,838 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=41s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:44,838 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:44:44,838 INFO crypto-rebalancer: {"ts": 1759999484.8386421, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.43, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:44,838 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:2325 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:44:44,842 INFO api.deps: Active user: jack
2025-10-09 10:44:44,843 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:44:44,859 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:44:44,859 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:44:44,866 INFO crypto-rebalancer: {"ts": 1759999484.8661673, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 24.18, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:44,866 INFO crypto-rebalancer: GET /balances/current -> 200 (24 ms)
INFO:     127.0.0.1:2325 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:44:45,002 INFO crypto-rebalancer: {"ts": 1759999485.0024202, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.41, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:45,002 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:2325 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:44:45,044 INFO api.analytics_endpoints: Calculating market breadth metrics
2025-10-09 10:44:45,045 ERROR api.analytics_endpoints: Error calculating market breadth: No module named 'api.balances'
2025-10-09 10:44:45,045 INFO crypto-rebalancer: {"ts": 1759999485.0458426, "method": "GET", "path": "/api/analytics/market-breadth", "status": 200, "duration_ms": 1.31, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:44:45,046 INFO crypto-rebalancer: GET /api/analytics/market-breadth -> 200 (1 ms)
INFO:     127.0.0.1:9551 - "GET /api/analytics/market-breadth HTTP/1.1" 200 OK
2025-10-09 10:44:45,046 INFO httpx: HTTP Request: GET http://localhost:8000/api/analytics/market-breadth "HTTP/1.1 200 OK"
2025-10-09 10:44:45,047 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:44:45,047 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:44:45,048 INFO crypto-rebalancer: {"ts": 1759999485.0485013, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 3965.86, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:45,048 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (3966 ms)
INFO:     127.0.0.1:2242 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:44:45,823 ERROR services.streaming.realtime_engine: Failed to initialize Redis Streams: Error Multiple exceptions: [Errno 10061] Connect call failed ('::1', 6379, 0, 0), [Errno 10061] Connect call failed ('127.0.0.1', 6379) connecting to localhost:6379.
2025-10-09 10:44:45,823 WARNING services.streaming.realtime_engine: Redis Streams not available - running in WebSocket-only mode
2025-10-09 10:44:45,824 INFO services.streaming.realtime_engine: RealtimeEngine initialized successfully
INFO:     ('127.0.0.1', 14544) - "WebSocket /api/realtime/ws?client_id=nav_badge" [accepted]
2025-10-09 10:44:45,824 INFO services.streaming.realtime_engine: WebSocket connected: nav_badge, total connections: 1
INFO:     connection open
2025-10-09 10:44:45,827 INFO crypto-rebalancer: {"ts": 1759999485.8273842, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 0.69, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:45,827 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (0 ms)
INFO:     127.0.0.1:2242 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:44:46,028 INFO api.deps: Active user: jack
2025-10-09 10:44:46,029 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:44:46,032 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:44:46,032 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:44:46,036 INFO crypto-rebalancer: {"ts": 1759999486.0367818, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 9.59, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:46,037 INFO crypto-rebalancer: GET /balances/current -> 200 (10 ms)
INFO:     127.0.0.1:2325 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:44:46,038 INFO crypto-rebalancer: {"ts": 1759999486.0379958, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 11.0, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:46,038 INFO crypto-rebalancer: GET /taxonomy -> 200 (11 ms)
INFO:     127.0.0.1:2242 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:44:46,048 INFO crypto-rebalancer: {"ts": 1759999486.0481596, "method": "GET", "path": "/static/components/decision-index-panel.js", "status": 200, "duration_ms": 3.63, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:46,048 INFO crypto-rebalancer: GET /static/components/decision-index-panel.js -> 200 (3 ms)
INFO:     127.0.0.1:2242 - "GET /static/components/decision-index-panel.js?v=1759999486043 HTTP/1.1" 200 OK
2025-10-09 10:44:46,059 INFO crypto-rebalancer: {"ts": 1759999486.059388, "method": "GET", "path": "/static/core/unified-insights-v2.js", "status": 200, "duration_ms": 6.27, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:46,059 INFO crypto-rebalancer: GET /static/core/unified-insights-v2.js -> 200 (6 ms)
INFO:     127.0.0.1:2242 - "GET /static/core/unified-insights-v2.js?v=1759999486043 HTTP/1.1" 200 OK
2025-10-09 10:44:46,066 INFO crypto-rebalancer: {"ts": 1759999486.0660038, "method": "GET", "path": "/static/utils/di-history.js", "status": 200, "duration_ms": 2.69, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:46,066 INFO crypto-rebalancer: GET /static/utils/di-history.js -> 200 (3 ms)
INFO:     127.0.0.1:2242 - "GET /static/utils/di-history.js?v=1759999486043 HTTP/1.1" 200 OK
2025-10-09 10:44:46,071 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=42s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:46,071 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:44:46,071 INFO crypto-rebalancer: {"ts": 1759999486.0715742, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.58, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:46,071 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:2242 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:44:46,082 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=42s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:46,082 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:44:46,083 INFO crypto-rebalancer: {"ts": 1759999486.083417, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.62, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:46,083 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:2242 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:44:47,510 INFO services.streaming.realtime_engine: WebSocket disconnected: nav_badge, remaining: 0
INFO:     connection closed
2025-10-09 10:44:47,523 INFO crypto-rebalancer: {"ts": 1759999487.5231736, "method": "GET", "path": "/static/analytics-unified.html", "status": 200, "duration_ms": 7.33, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,523 INFO crypto-rebalancer: GET /static/analytics-unified.html -> 200 (7 ms)
INFO:     127.0.0.1:2242 - "GET /static/analytics-unified.html HTTP/1.1" 200 OK
2025-10-09 10:44:47,543 INFO crypto-rebalancer: {"ts": 1759999487.5437949, "method": "GET", "path": "/.well-known/appspecific/com.chrome.devtools.json", "status": 404, "duration_ms": 2.02, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,544 INFO crypto-rebalancer: GET /.well-known/appspecific/com.chrome.devtools.json -> 404 (2 ms)
INFO:     127.0.0.1:2242 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
2025-10-09 10:44:47,562 INFO crypto-rebalancer: {"ts": 1759999487.5628781, "method": "GET", "path": "/static/shared-theme.css", "status": 200, "duration_ms": 9.69, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,563 INFO crypto-rebalancer: GET /static/shared-theme.css -> 200 (10 ms)
INFO:     127.0.0.1:2242 - "GET /static/shared-theme.css HTTP/1.1" 200 OK
2025-10-09 10:44:47,565 INFO crypto-rebalancer: {"ts": 1759999487.5658386, "method": "GET", "path": "/static/theme-compat.css", "status": 200, "duration_ms": 10.58, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,566 INFO crypto-rebalancer: {"ts": 1759999487.5660677, "method": "GET", "path": "/static/debug-logger.js", "status": 200, "duration_ms": 10.41, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,566 INFO crypto-rebalancer: {"ts": 1759999487.5662372, "method": "GET", "path": "/static/components/governance-panel.css", "status": 200, "duration_ms": 10.83, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,566 INFO crypto-rebalancer: GET /static/theme-compat.css -> 200 (11 ms)
INFO:     127.0.0.1:2325 - "GET /static/theme-compat.css HTTP/1.1" 200 OK
2025-10-09 10:44:47,568 INFO crypto-rebalancer: GET /static/debug-logger.js -> 200 (13 ms)
INFO:     127.0.0.1:12683 - "GET /static/debug-logger.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,569 INFO crypto-rebalancer: GET /static/components/governance-panel.css -> 200 (13 ms)
INFO:     127.0.0.1:9940 - "GET /static/components/governance-panel.css HTTP/1.1" 200 OK
2025-10-09 10:44:47,571 INFO crypto-rebalancer: {"ts": 1759999487.5710616, "method": "GET", "path": "/static/components/decision-index-panel.css", "status": 200, "duration_ms": 15.38, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,571 INFO crypto-rebalancer: {"ts": 1759999487.5715456, "method": "GET", "path": "/static/global-config.js", "status": 200, "duration_ms": 15.67, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,572 INFO crypto-rebalancer: GET /static/components/decision-index-panel.css -> 200 (16 ms)
INFO:     127.0.0.1:3147 - "GET /static/components/decision-index-panel.css?v=20250130h HTTP/1.1" 200 OK
2025-10-09 10:44:47,572 INFO crypto-rebalancer: GET /static/global-config.js -> 200 (16 ms)
INFO:     127.0.0.1:13714 - "GET /static/global-config.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,579 INFO crypto-rebalancer: {"ts": 1759999487.5790637, "method": "GET", "path": "/static/appearance.js", "status": 200, "duration_ms": 9.62, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,579 INFO crypto-rebalancer: GET /static/appearance.js -> 200 (12 ms)
INFO:     127.0.0.1:2242 - "GET /static/appearance.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,584 INFO crypto-rebalancer: {"ts": 1759999487.5844886, "method": "GET", "path": "/static/analytics-unified.js", "status": 200, "duration_ms": 11.24, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,586 INFO crypto-rebalancer: GET /static/analytics-unified.js -> 200 (13 ms)
INFO:     127.0.0.1:12683 - "GET /static/analytics-unified.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,588 INFO crypto-rebalancer: {"ts": 1759999487.588234, "method": "GET", "path": "/static/components/tooltips.js", "status": 200, "duration_ms": 14.9, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,588 INFO crypto-rebalancer: {"ts": 1759999487.588546, "method": "GET", "path": "/static/components/nav.js", "status": 200, "duration_ms": 15.89, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,588 INFO crypto-rebalancer: {"ts": 1759999487.5887868, "method": "GET", "path": "/static/core/fetcher.js", "status": 200, "duration_ms": 12.77, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,589 INFO crypto-rebalancer: {"ts": 1759999487.5889802, "method": "GET", "path": "/static/core/risk-dashboard-store.js", "status": 200, "duration_ms": 13.18, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,589 INFO crypto-rebalancer: GET /static/components/tooltips.js -> 200 (16 ms)
INFO:     127.0.0.1:9940 - "GET /static/components/tooltips.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,589 INFO crypto-rebalancer: GET /static/components/nav.js -> 200 (17 ms)
INFO:     127.0.0.1:2325 - "GET /static/components/nav.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,590 INFO crypto-rebalancer: GET /static/core/fetcher.js -> 200 (14 ms)
INFO:     127.0.0.1:13714 - "GET /static/core/fetcher.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,590 INFO crypto-rebalancer: GET /static/core/risk-dashboard-store.js -> 200 (15 ms)
INFO:     127.0.0.1:3147 - "GET /static/core/risk-dashboard-store.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,596 INFO crypto-rebalancer: {"ts": 1759999487.5960135, "method": "GET", "path": "/static/modules/signals-engine.js", "status": 200, "duration_ms": 12.39, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,596 INFO crypto-rebalancer: GET /static/modules/signals-engine.js -> 200 (13 ms)
INFO:     127.0.0.1:2242 - "GET /static/modules/signals-engine.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,600 INFO crypto-rebalancer: {"ts": 1759999487.6004355, "method": "GET", "path": "/static/modules/cycle-navigator.js", "status": 200, "duration_ms": 9.47, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,600 INFO crypto-rebalancer: GET /static/modules/cycle-navigator.js -> 200 (10 ms)
INFO:     127.0.0.1:12683 - "GET /static/modules/cycle-navigator.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,611 INFO crypto-rebalancer: {"ts": 1759999487.611245, "method": "GET", "path": "/static/core/risk-data-orchestrator.js", "status": 200, "duration_ms": 17.42, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,611 INFO crypto-rebalancer: {"ts": 1759999487.6114354, "method": "GET", "path": "/static/modules/market-regimes.js", "status": 200, "duration_ms": 18.13, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,611 INFO crypto-rebalancer: {"ts": 1759999487.611549, "method": "GET", "path": "/static/modules/targets-coordinator.js", "status": 200, "duration_ms": 18.05, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,611 INFO crypto-rebalancer: {"ts": 1759999487.6117978, "method": "GET", "path": "/static/modules/onchain-indicators.js", "status": 200, "duration_ms": 18.94, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,611 INFO crypto-rebalancer: GET /static/core/risk-data-orchestrator.js -> 200 (18 ms)
INFO:     127.0.0.1:3147 - "GET /static/core/risk-data-orchestrator.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,612 INFO crypto-rebalancer: GET /static/modules/market-regimes.js -> 200 (19 ms)
INFO:     127.0.0.1:2325 - "GET /static/modules/market-regimes.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,612 INFO crypto-rebalancer: GET /static/modules/targets-coordinator.js -> 200 (19 ms)
INFO:     127.0.0.1:13714 - "GET /static/modules/targets-coordinator.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,612 INFO crypto-rebalancer: GET /static/modules/onchain-indicators.js -> 200 (20 ms)
INFO:     127.0.0.1:9940 - "GET /static/modules/onchain-indicators.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,621 INFO crypto-rebalancer: {"ts": 1759999487.621889, "method": "GET", "path": "/static/components/risk-sidebar-full.js", "status": 200, "duration_ms": 4.32, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,622 INFO crypto-rebalancer: {"ts": 1759999487.6221032, "method": "GET", "path": "/static/components/flyout-panel.js", "status": 200, "duration_ms": 4.74, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,622 INFO crypto-rebalancer: GET /static/components/risk-sidebar-full.js -> 200 (4 ms)
INFO:     127.0.0.1:13714 - "GET /static/components/risk-sidebar-full.js HTTP/1.1" 200 OK
INFO:     127.0.0.1:9940 - "GET /static/components/flyout-panel.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,622 INFO crypto-rebalancer: GET /static/components/flyout-panel.js -> 200 (5 ms)
INFO:     ('127.0.0.1', 14357) - "WebSocket /api/realtime/ws?client_id=nav_badge" [accepted]
2025-10-09 10:44:47,877 INFO services.streaming.realtime_engine: WebSocket connected: nav_badge, total connections: 1
INFO:     connection open
2025-10-09 10:44:47,879 INFO crypto-rebalancer: {"ts": 1759999487.879489, "method": "GET", "path": "/static/components/deep-links.js", "status": 200, "duration_ms": 11.56, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,880 INFO crypto-rebalancer: GET /static/components/deep-links.js -> 200 (12 ms)
INFO:     127.0.0.1:9940 - "GET /static/components/deep-links.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,884 INFO crypto-rebalancer: {"ts": 1759999487.88487, "method": "GET", "path": "/static/modules/composite-score-v2.js", "status": 200, "duration_ms": 16.04, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,885 INFO crypto-rebalancer: {"ts": 1759999487.8856926, "method": "GET", "path": "/static/components/utils.js", "status": 200, "duration_ms": 15.86, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,886 INFO crypto-rebalancer: {"ts": 1759999487.8859506, "method": "GET", "path": "/static/selectors/governance.js", "status": 200, "duration_ms": 17.45, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,886 INFO crypto-rebalancer: {"ts": 1759999487.8861117, "method": "GET", "path": "/static/components/flyout-layout-adapter.js", "status": 200, "duration_ms": 16.22, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,886 INFO crypto-rebalancer: GET /static/modules/composite-score-v2.js -> 200 (17 ms)
INFO:     127.0.0.1:3147 - "GET /static/modules/composite-score-v2.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,886 INFO crypto-rebalancer: {"ts": 1759999487.8868542, "method": "GET", "path": "/static/components/GovernancePanel.js", "status": 200, "duration_ms": 18.08, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,887 INFO crypto-rebalancer: GET /static/components/utils.js -> 200 (17 ms)
INFO:     127.0.0.1:12683 - "GET /static/components/utils.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,887 INFO crypto-rebalancer: GET /static/selectors/governance.js -> 200 (19 ms)
INFO:     127.0.0.1:13714 - "GET /static/selectors/governance.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,887 INFO crypto-rebalancer: GET /static/components/flyout-layout-adapter.js -> 200 (17 ms)
INFO:     127.0.0.1:2242 - "GET /static/components/flyout-layout-adapter.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,888 INFO crypto-rebalancer: GET /static/components/GovernancePanel.js -> 200 (20 ms)
INFO:     127.0.0.1:2325 - "GET /static/components/GovernancePanel.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,892 INFO crypto-rebalancer: {"ts": 1759999487.8927593, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 4.44, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,894 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (6 ms)
INFO:     127.0.0.1:9940 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:44:47,894 INFO crypto-rebalancer: {"ts": 1759999487.8949049, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 2.5, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,895 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (3 ms)
INFO:     127.0.0.1:13714 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:44:47,901 INFO crypto-rebalancer: {"ts": 1759999487.9016657, "method": "GET", "path": "/config/users.json", "status": 200, "duration_ms": 10.09, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,902 INFO crypto-rebalancer: GET /config/users.json -> 200 (11 ms)
INFO:     127.0.0.1:3147 - "GET /config/users.json HTTP/1.1" 200 OK
2025-10-09 10:44:47,902 INFO crypto-rebalancer: {"ts": 1759999487.9028666, "method": "GET", "path": "/static/components/WealthContextBar.js", "status": 200, "duration_ms": 10.52, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,903 INFO crypto-rebalancer: GET /static/components/WealthContextBar.js -> 200 (11 ms)
INFO:     127.0.0.1:12683 - "GET /static/components/WealthContextBar.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,905 INFO crypto-rebalancer: {"ts": 1759999487.9050963, "method": "GET", "path": "/static/modules/dynamic-weighting.js", "status": 200, "duration_ms": 11.92, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,905 INFO crypto-rebalancer: {"ts": 1759999487.905618, "method": "GET", "path": "/static/modules/indicator-categories-v2.js", "status": 200, "duration_ms": 13.16, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,905 INFO crypto-rebalancer: GET /static/modules/dynamic-weighting.js -> 200 (13 ms)
INFO:     127.0.0.1:2325 - "GET /static/modules/dynamic-weighting.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,906 INFO crypto-rebalancer: GET /static/modules/indicator-categories-v2.js -> 200 (14 ms)
INFO:     127.0.0.1:2242 - "GET /static/modules/indicator-categories-v2.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,907 INFO crypto-rebalancer: {"ts": 1759999487.9078288, "method": "GET", "path": "/static/governance/stability-engine.js", "status": 200, "duration_ms": 11.69, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,908 INFO crypto-rebalancer: GET /static/governance/stability-engine.js -> 200 (12 ms)
INFO:     127.0.0.1:9940 - "GET /static/governance/stability-engine.js HTTP/1.1" 200 OK
2025-10-09 10:44:47,910 INFO api.deps: Active user: jack
2025-10-09 10:44:47,916 INFO crypto-rebalancer: {"ts": 1759999487.9162543, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 7.25, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,917 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=44s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:47,917 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:44:47,918 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:44:47,919 INFO api.crypto_toolbox_endpoints: \U0001f504 Scraping fresh data...
2025-10-09 10:44:47,920 WARNING api.crypto_toolbox_endpoints: \u26a0\ufe0f Browser not connected, re-launching...
2025-10-09 10:44:47,920 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:44:47,920 INFO crypto-rebalancer: GET /api/users/sources -> 200 (11 ms)
INFO:     127.0.0.1:2242 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:44:47,921 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-134' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:44:47,923 INFO api.deps: Active user: jack
2025-10-09 10:44:47,924 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:44:47,924 ERROR api.crypto_toolbox_endpoints: \u274c Crypto-toolbox scraping error
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 377, in get_crypto_toolbox_data
    return await _get_data(force=force)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 345, in _get_data
    data = await _scrape_crypto_toolbox()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 219, in _scrape_crypto_toolbox
    browser = await _ensure_browser()
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 166, in _ensure_browser
    await startup_playwright()
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 109, in startup_playwright
    _playwright_instance = await async_playwright().start()
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 51, in start
    return await self.__aenter__()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 46, in __aenter__
    playwright = AsyncPlaywright(next(iter(done)).result())
                                 ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:44:47,927 INFO crypto-rebalancer: {"ts": 1759999487.9270766, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 11.04, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:47,927 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:44:47,931 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:44:47,931 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:44:47,933 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:44:48,213 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:48,214 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:48,214 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:48,214 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:48,380 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:44:48,380 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:48,381 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:44:48,381 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:44:48,381 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:44:48,381 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:44:48,381 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:48,381 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:48,381 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:48,577 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:44:48,577 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:44:48,577 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:48,577 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:48,577 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:48,577 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:48,577 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:48,869 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63079261519336
2025-10-09 10:44:48,869 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:48,869 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:44:48,869 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226625212667007, 'sharpe_v2': 1.6226625212667007, 'portfolio_structure_score': 82.63079261519336, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763666421847605, 'gri': 16.69284074262188, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.36920738480664, 'final_score': 82.63079261519336, 'inputs': {'hhi': 0.1851293656358313, 'memes_pct': 0.016909166054619014, 'gri': 3.338568148524376, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:48,871 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (955 ms)
INFO:     127.0.0.1:13714 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:44:48,872 INFO crypto-rebalancer: {"ts": 1759999488.8724267, "method": "GET", "path": "/api/crypto-toolbox", "status": 502, "duration_ms": 956.28, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:48,872 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:44:48,873 INFO crypto-rebalancer: {"ts": 1759999488.8732123, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 957.12, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:48,873 INFO crypto-rebalancer: GET /api/crypto-toolbox -> 502 (957 ms)
INFO:     127.0.0.1:9940 - "GET /api/crypto-toolbox HTTP/1.1" 502 Bad Gateway
2025-10-09 10:44:48,874 INFO crypto-rebalancer: {"ts": 1759999488.8739812, "method": "GET", "path": "/static/components/Badges.js", "status": 200, "duration_ms": 963.49, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:48,874 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (958 ms)
INFO:     127.0.0.1:3147 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:44:48,874 INFO crypto-rebalancer: {"ts": 1759999488.8745437, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 958.58, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:48,874 INFO crypto-rebalancer: GET /static/components/Badges.js -> 200 (965 ms)
INFO:     127.0.0.1:2325 - "GET /static/components/Badges.js HTTP/1.1" 200 OK
2025-10-09 10:44:48,875 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:48,878 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:48,878 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:48,888 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 365 days
2025-10-09 10:44:49,147 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:49,147 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:49,147 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:49,147 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:49,261 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 85.0
2025-10-09 10:44:49,261 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:49,261 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:44:49,261 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:44:49,261 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:44:49,261 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:44:49,261 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:49,261 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:49,261 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:49,427 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:44:49,427 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=85.0, penalties=0.0, final=85.0
2025-10-09 10:44:49,427 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:49,427 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:49,427 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:49,427 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:49,427 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:49,640 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:44:49,640 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.33, Vol=0.20, MaxDD=-10.64%, RiskScore=85.0, RiskStructural=47.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:49,640 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:44:49,640 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 85.0, 'risk_score_v2': 85.0, 'sharpe_legacy': 1.3262890739554856, 'sharpe_v2': 1.3262890739554856, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 47.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 5.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:49,642 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (1727 ms)
INFO:     127.0.0.1:12683 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:44:49,644 INFO crypto-rebalancer: {"ts": 1759999489.6445138, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 772.21, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:49,646 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (775 ms)
INFO:     127.0.0.1:2242 - "GET /api/risk/dashboard?min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:44:49,648 INFO api.deps: Active user: jack
2025-10-09 10:44:49,668 INFO crypto-rebalancer: {"ts": 1759999489.668561, "method": "GET", "path": "/favicon.ico", "status": 200, "duration_ms": 21.72, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:49,669 INFO crypto-rebalancer: {"ts": 1759999489.6691115, "method": "GET", "path": "/api/ml/debug/pipeline-info", "status": 200, "duration_ms": 21.94, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:49,669 INFO crypto-rebalancer: GET /favicon.ico -> 200 (24 ms)
INFO:     127.0.0.1:2325 - "GET /favicon.ico HTTP/1.1" 200 OK
2025-10-09 10:44:49,670 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=46s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:49,670 INFO crypto-rebalancer: {"ts": 1759999489.670364, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 25.91, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:49,670 INFO crypto-rebalancer: GET /api/ml/debug/pipeline-info -> 200 (23 ms)
INFO:     127.0.0.1:12683 - "GET /api/ml/debug/pipeline-info HTTP/1.1" 200 OK
2025-10-09 10:44:49,670 INFO crypto-rebalancer: GET /api/users/sources -> 200 (26 ms)
INFO:     127.0.0.1:3147 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:44:49,671 INFO crypto-rebalancer: {"ts": 1759999489.671044, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 2.23, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:49,671 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (3 ms)
INFO:     127.0.0.1:2242 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:44:49,673 INFO crypto-rebalancer: {"ts": 1759999489.6730373, "method": "GET", "path": "/static/shared-asset-groups.js", "status": 200, "duration_ms": 798.54, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:49,673 INFO crypto-rebalancer: {"ts": 1759999489.6732662, "method": "GET", "path": "/static/utils/time.js", "status": 200, "duration_ms": 29.3, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:49,673 INFO crypto-rebalancer: GET /static/shared-asset-groups.js -> 200 (799 ms)
INFO:     127.0.0.1:13714 - "GET /static/shared-asset-groups.js HTTP/1.1" 200 OK
2025-10-09 10:44:49,674 INFO crypto-rebalancer: GET /static/utils/time.js -> 200 (30 ms)
INFO:     127.0.0.1:9940 - "GET /static/utils/time.js HTTP/1.1" 200 OK
2025-10-09 10:44:49,676 INFO api.deps: Active user: jack
2025-10-09 10:44:49,680 INFO crypto-rebalancer: {"ts": 1759999489.6801374, "method": "GET", "path": "/api/ml/volatility/predict/BTC", "status": 200, "duration_ms": 4.14, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:49,680 INFO crypto-rebalancer: GET /api/ml/volatility/predict/BTC -> 200 (4 ms)
INFO:     127.0.0.1:3147 - "GET /api/ml/volatility/predict/BTC?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:44:49,681 INFO crypto-rebalancer: {"ts": 1759999489.681244, "method": "GET", "path": "/api/users/settings", "status": 200, "duration_ms": 6.82, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:49,681 INFO crypto-rebalancer: GET /api/users/settings -> 200 (7 ms)
INFO:     127.0.0.1:2242 - "GET /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:44:49,683 INFO crypto-rebalancer: {"ts": 1759999489.6838982, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 3.9, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:49,684 INFO crypto-rebalancer: GET /taxonomy -> 200 (6 ms)
INFO:     127.0.0.1:9940 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:44:49,689 INFO crypto-rebalancer: {"ts": 1759999489.6891937, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.0, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:49,689 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:9940 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:44:49,697 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:49,700 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:49,700 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:49,712 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:44:49,848 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:49,848 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:49,848 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:49,848 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:49,963 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:44:49,963 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:49,963 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:44:49,963 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:44:49,963 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:44:49,963 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:44:49,964 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:49,964 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:49,964 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:50,075 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:44:50,075 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:44:50,075 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:50,075 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:50,075 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:50,075 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:50,075 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:50,324 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:44:50,325 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:50,325 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:44:50,325 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:50,328 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:50,329 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:50,329 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:50,342 INFO crypto-rebalancer: {"ts": 1759999490.3427553, "method": "GET", "path": "/api/ml/volatility/predict/ETH", "status": 200, "duration_ms": 647.44, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:50,343 INFO crypto-rebalancer: {"ts": 1759999490.3431945, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 648.95, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:50,343 INFO crypto-rebalancer: GET /api/ml/volatility/predict/ETH -> 200 (648 ms)
INFO:     127.0.0.1:3147 - "GET /api/ml/volatility/predict/ETH?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:44:50,343 INFO crypto-rebalancer: {"ts": 1759999490.3439412, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 648.85, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:50,344 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (649 ms)
INFO:     127.0.0.1:9940 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:44:50,345 INFO crypto-rebalancer: GET /balances/current -> 200 (650 ms)
INFO:     127.0.0.1:2242 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:44:50,346 INFO api.deps: Active user: jack
2025-10-09 10:44:50,348 INFO api.user_settings_endpoints: Settings saved for user jack: 17 keys
2025-10-09 10:44:50,349 INFO crypto-rebalancer: {"ts": 1759999490.3498888, "method": "PUT", "path": "/api/users/settings", "status": 200, "duration_ms": 653.23, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:50,571 INFO crypto-rebalancer: PUT /api/users/settings -> 200 (875 ms)
INFO:     127.0.0.1:13714 - "PUT /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:44:50,574 INFO crypto-rebalancer: {"ts": 1759999490.5748456, "method": "GET", "path": "/api/config/data-source", "status": 200, "duration_ms": 0.89, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:44:50,575 INFO crypto-rebalancer: GET /api/config/data-source -> 200 (1 ms)
INFO:     127.0.0.1:8973 - "GET /api/config/data-source HTTP/1.1" 200 OK
2025-10-09 10:44:50,575 INFO httpx: HTTP Request: GET http://127.0.0.1:8000/api/config/data-source "HTTP/1.1 200 OK"
2025-10-09 10:44:50,575 INFO services.ml.orchestrator: Using data source from config API: cointracking
2025-10-09 10:44:50,576 INFO crypto-rebalancer: {"ts": 1759999490.5763822, "method": "GET", "path": "/api/ml/regime/current", "status": 200, "duration_ms": 226.58, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:50,576 INFO crypto-rebalancer: GET /api/ml/regime/current -> 200 (226 ms)
INFO:     127.0.0.1:2242 - "GET /api/ml/regime/current HTTP/1.1" 200 OK
2025-10-09 10:44:50,581 INFO crypto-rebalancer: {"ts": 1759999490.5816548, "method": "GET", "path": "/api/ml/sentiment/fear-greed", "status": 200, "duration_ms": 1.21, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:50,581 INFO crypto-rebalancer: GET /api/ml/sentiment/fear-greed -> 200 (1 ms)
INFO:     127.0.0.1:2242 - "GET /api/ml/sentiment/fear-greed?days=1 HTTP/1.1" 200 OK
2025-10-09 10:44:50,707 INFO crypto-rebalancer: {"ts": 1759999490.7075799, "method": "GET", "path": "/static/components/UnifiedInsights.js", "status": 200, "duration_ms": 6.73, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:50,707 INFO crypto-rebalancer: GET /static/components/UnifiedInsights.js -> 200 (7 ms)
INFO:     127.0.0.1:2242 - "GET /static/components/UnifiedInsights.js?v=2025-10-09T08:44:50.698Z HTTP/1.1" 200 OK
2025-10-09 10:44:50,720 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=47s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:50,720 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:44:50,720 INFO crypto-rebalancer: {"ts": 1759999490.7209163, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.38, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:50,721 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:2242 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:44:50,725 INFO api.deps: Active user: jack
2025-10-09 10:44:50,725 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:44:50,729 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:44:50,729 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:44:50,733 INFO crypto-rebalancer: {"ts": 1759999490.7337236, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 9.27, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:50,733 INFO crypto-rebalancer: GET /balances/current -> 200 (9 ms)
INFO:     127.0.0.1:2242 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:44:50,871 INFO crypto-rebalancer: {"ts": 1759999490.8718219, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.56, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:50,872 INFO crypto-rebalancer: GET /taxonomy -> 200 (3 ms)
INFO:     127.0.0.1:2242 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:44:51,887 INFO api.deps: Active user: jack
2025-10-09 10:44:51,888 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:44:51,889 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:44:51,889 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:44:51,892 INFO crypto-rebalancer: {"ts": 1759999491.892689, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 6.01, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:51,892 INFO crypto-rebalancer: {"ts": 1759999491.8928208, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 6.33, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:51,892 INFO crypto-rebalancer: GET /balances/current -> 200 (6 ms)
INFO:     127.0.0.1:13714 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:44:51,893 INFO crypto-rebalancer: GET /taxonomy -> 200 (6 ms)
INFO:     127.0.0.1:2242 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:44:51,904 INFO crypto-rebalancer: {"ts": 1759999491.903987, "method": "GET", "path": "/static/components/decision-index-panel.js", "status": 200, "duration_ms": 4.15, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:51,904 INFO crypto-rebalancer: GET /static/components/decision-index-panel.js -> 200 (4 ms)
INFO:     127.0.0.1:2242 - "GET /static/components/decision-index-panel.js?v=1759999491897 HTTP/1.1" 200 OK
2025-10-09 10:44:51,913 INFO crypto-rebalancer: {"ts": 1759999491.9132252, "method": "GET", "path": "/static/core/unified-insights-v2.js", "status": 200, "duration_ms": 5.23, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:51,913 INFO crypto-rebalancer: GET /static/core/unified-insights-v2.js -> 200 (5 ms)
INFO:     127.0.0.1:2242 - "GET /static/core/unified-insights-v2.js?v=1759999491897 HTTP/1.1" 200 OK
2025-10-09 10:44:51,919 INFO crypto-rebalancer: {"ts": 1759999491.9195852, "method": "GET", "path": "/static/utils/di-history.js", "status": 200, "duration_ms": 2.51, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:51,919 INFO crypto-rebalancer: GET /static/utils/di-history.js -> 200 (2 ms)
INFO:     127.0.0.1:2242 - "GET /static/utils/di-history.js?v=1759999491897 HTTP/1.1" 200 OK
2025-10-09 10:44:51,924 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=48s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:51,924 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:44:51,924 INFO crypto-rebalancer: {"ts": 1759999491.9248502, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.38, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:51,925 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:2242 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:44:51,935 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=48s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:51,935 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:44:51,935 INFO crypto-rebalancer: {"ts": 1759999491.9357393, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.42, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:51,935 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:2242 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:44:54,588 INFO services.streaming.realtime_engine: WebSocket disconnected: nav_badge, remaining: 0
INFO:     connection closed
2025-10-09 10:44:54,650 INFO crypto-rebalancer: {"ts": 1759999494.6509066, "method": "GET", "path": "/.well-known/appspecific/com.chrome.devtools.json", "status": 404, "duration_ms": 1.76, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:54,651 INFO crypto-rebalancer: GET /.well-known/appspecific/com.chrome.devtools.json -> 404 (2 ms)
INFO:     127.0.0.1:2242 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
2025-10-09 10:44:54,736 INFO api.crypto_toolbox_endpoints: \U0001f504 Scraping fresh data...
2025-10-09 10:44:54,736 WARNING api.crypto_toolbox_endpoints: \u26a0\ufe0f Browser not connected, re-launching...
2025-10-09 10:44:54,736 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:44:54,737 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-170' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:44:54,739 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:44:54,739 ERROR api.crypto_toolbox_endpoints: \u274c Crypto-toolbox scraping error
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 377, in get_crypto_toolbox_data
    return await _get_data(force=force)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 345, in _get_data
    data = await _scrape_crypto_toolbox()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 219, in _scrape_crypto_toolbox
    browser = await _ensure_browser()
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 166, in _ensure_browser
    await startup_playwright()
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 109, in startup_playwright
    _playwright_instance = await async_playwright().start()
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 51, in start
    return await self.__aenter__()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 46, in __aenter__
    playwright = AsyncPlaywright(next(iter(done)).result())
                                 ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:44:54,742 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=51s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:54,742 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:44:54,742 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:44:54,743 INFO crypto-rebalancer: {"ts": 1759999494.7434437, "method": "GET", "path": "/api/crypto-toolbox", "status": 502, "duration_ms": 7.79, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:54,743 INFO crypto-rebalancer: GET /api/crypto-toolbox -> 502 (8 ms)
INFO:     127.0.0.1:2242 - "GET /api/crypto-toolbox HTTP/1.1" 502 Bad Gateway
2025-10-09 10:44:54,743 INFO api.deps: Active user: jack
2025-10-09 10:44:54,744 INFO crypto-rebalancer: {"ts": 1759999494.744038, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 2.44, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:54,746 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:44:54,749 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:44:54,749 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:44:54,751 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:44:54,980 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:54,980 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:54,980 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:54,980 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:55,131 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:44:55,131 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:55,131 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:44:55,131 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:44:55,131 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:44:55,131 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:44:55,131 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:55,131 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:55,131 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:55,288 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:44:55,288 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:44:55,289 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:55,289 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:55,289 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:55,289 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:55,289 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:55,546 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63079261519336
2025-10-09 10:44:55,546 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:55,546 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:44:55,546 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226625212667007, 'sharpe_v2': 1.6226625212667007, 'portfolio_structure_score': 82.63079261519336, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763666421847605, 'gri': 16.69284074262188, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.36920738480664, 'final_score': 82.63079261519336, 'inputs': {'hhi': 0.1851293656358313, 'memes_pct': 0.016909166054619014, 'gri': 3.338568148524376, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:55,547 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (808 ms)
INFO:     127.0.0.1:3147 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:44:55,548 INFO crypto-rebalancer: {"ts": 1759999495.5482583, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 806.57, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:55,549 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:44:55,549 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (810 ms)
INFO:     127.0.0.1:9940 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:44:55,550 INFO crypto-rebalancer: {"ts": 1759999495.5501354, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 808.6, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:55,550 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (811 ms)
INFO:     127.0.0.1:13714 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:44:55,551 INFO crypto-rebalancer: {"ts": 1759999495.5513937, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 807.78, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:55,551 INFO crypto-rebalancer: GET /taxonomy -> 200 (808 ms)
INFO:     127.0.0.1:4281 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:44:55,561 INFO crypto-rebalancer: {"ts": 1759999495.561527, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 1.59, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:55,561 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (1 ms)
INFO:     127.0.0.1:4281 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
INFO:     ('127.0.0.1', 9664) - "WebSocket /api/realtime/ws?client_id=nav_badge" [accepted]
2025-10-09 10:44:55,576 INFO services.streaming.realtime_engine: WebSocket connected: nav_badge, total connections: 1
INFO:     connection open
2025-10-09 10:44:55,580 INFO api.deps: Active user: jack
2025-10-09 10:44:55,581 INFO api.deps: Active user: jack
2025-10-09 10:44:55,585 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:44:55,585 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:44:55,588 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:44:55,588 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:44:55,594 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:44:55,594 INFO crypto-rebalancer: {"ts": 1759999495.594569, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 15.39, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:55,594 INFO crypto-rebalancer: {"ts": 1759999495.594705, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 16.93, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:55,594 INFO crypto-rebalancer: {"ts": 1759999495.5948088, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 15.49, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:55,595 INFO crypto-rebalancer: GET /api/users/sources -> 200 (16 ms)
INFO:     127.0.0.1:3147 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:44:55,595 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (17 ms)
INFO:     127.0.0.1:4281 - "GET /api/alerts/active?severity_filter=S3 HTTP/1.1" 200 OK
2025-10-09 10:44:55,595 INFO crypto-rebalancer: GET /balances/current -> 200 (16 ms)
INFO:     127.0.0.1:2242 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:44:55,596 INFO crypto-rebalancer: {"ts": 1759999495.596205, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 17.06, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:55,596 INFO crypto-rebalancer: {"ts": 1759999495.5963519, "method": "GET", "path": "/config/users.json", "status": 200, "duration_ms": 21.38, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:55,596 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (17 ms)
INFO:     127.0.0.1:9940 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:44:55,597 INFO crypto-rebalancer: GET /config/users.json -> 200 (22 ms)
INFO:     127.0.0.1:13714 - "GET /config/users.json HTTP/1.1" 200 OK
2025-10-09 10:44:55,771 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:55,773 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:55,773 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:55,780 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:44:55,914 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:55,914 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:55,914 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:55,914 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:56,064 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:44:56,064 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:56,064 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:44:56,064 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:44:56,064 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:44:56,064 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:44:56,064 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:56,064 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:56,064 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:56,201 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:44:56,201 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:44:56,202 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:56,202 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:56,202 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:56,202 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:44:56,202 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:56,516 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:44:56,517 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:56,517 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:44:56,517 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:56,519 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:44:56,523 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:44:56,523 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:44:56,535 INFO crypto-rebalancer: {"ts": 1759999496.534989, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 765.33, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:56,536 INFO crypto-rebalancer: {"ts": 1759999496.5363936, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 765.97, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:56,536 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (766 ms)
INFO:     127.0.0.1:13714 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:44:56,537 INFO api.deps: Active user: jack
2025-10-09 10:44:56,537 INFO crypto-rebalancer: GET /balances/current -> 200 (767 ms)
INFO:     127.0.0.1:9940 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:44:56,537 INFO api.deps: Active user: jack
2025-10-09 10:44:56,537 INFO crypto-rebalancer: {"ts": 1759999496.5377514, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 2.86, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:56,537 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:44:56,539 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:44:56,539 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:44:56,540 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:44:56,812 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:56,812 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:56,812 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:56,813 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:56,983 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:44:56,983 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:56,984 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:44:56,984 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:44:56,984 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:44:56,984 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:44:56,984 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:56,984 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:56,984 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:57,186 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:44:57,186 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:44:57,186 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:57,186 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:57,186 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:57,186 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:57,186 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:57,444 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63079261519336
2025-10-09 10:44:57,444 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:57,444 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:44:57,444 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226625212667007, 'sharpe_v2': 1.6226625212667007, 'portfolio_structure_score': 82.63079261519336, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763666421847605, 'gri': 16.69284074262188, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.36920738480664, 'final_score': 82.63079261519336, 'inputs': {'hhi': 0.1851293656358313, 'memes_pct': 0.016909166054619014, 'gri': 3.338568148524376, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:57,447 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (913 ms)
INFO:     127.0.0.1:2242 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:44:57,448 INFO crypto-rebalancer: {"ts": 1759999497.4481797, "method": "GET", "path": "/favicon.ico", "status": 200, "duration_ms": 911.48, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:57,448 INFO crypto-rebalancer: {"ts": 1759999497.4488018, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 914.17, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:57,449 INFO crypto-rebalancer: {"ts": 1759999497.449002, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 914.16, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:57,449 INFO crypto-rebalancer: GET /favicon.ico -> 200 (912 ms)
INFO:     127.0.0.1:8150 - "GET /favicon.ico HTTP/1.1" 200 OK
2025-10-09 10:44:57,449 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=54s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:57,449 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:44:57,449 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:44:57,450 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (916 ms)
INFO:     127.0.0.1:4281 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90&risk_version=v2_shadow&use_dual_window=true HTTP/1.1" 200 OK
2025-10-09 10:44:57,450 INFO crypto-rebalancer: GET /api/users/sources -> 200 (916 ms)
INFO:     127.0.0.1:3147 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:44:57,451 INFO crypto-rebalancer: {"ts": 1759999497.4518335, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 3.44, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:57,452 INFO api.deps: Active user: jack
2025-10-09 10:44:57,452 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (4 ms)
INFO:     127.0.0.1:13714 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:44:57,453 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=54s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:57,453 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:44:57,455 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:44:57,455 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:44:57,459 INFO crypto-rebalancer: {"ts": 1759999497.459393, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 7.28, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:57,459 INFO crypto-rebalancer: {"ts": 1759999497.459829, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 9.7, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:57,460 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (8 ms)
INFO:     127.0.0.1:2242 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:44:57,460 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=54s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:57,461 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:44:57,461 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:44:57,461 INFO crypto-rebalancer: GET /balances/current -> 200 (12 ms)
INFO:     127.0.0.1:9940 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:44:57,462 INFO crypto-rebalancer: {"ts": 1759999497.462158, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 2.58, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:57,462 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (3 ms)
INFO:     127.0.0.1:3147 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:44:57,464 INFO crypto-rebalancer: {"ts": 1759999497.4645271, "method": "GET", "path": "/api/phase3/status", "status": 200, "duration_ms": 2.27, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:57,464 INFO api.deps: Active user: jack
2025-10-09 10:44:57,464 INFO crypto-rebalancer: GET /api/phase3/status -> 200 (2 ms)
INFO:     127.0.0.1:13714 - "GET /api/phase3/status?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:44:57,466 INFO crypto-rebalancer: {"ts": 1759999497.4668596, "method": "GET", "path": "/api/users/settings", "status": 200, "duration_ms": 3.37, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:57,467 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=54s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:57,467 INFO crypto-rebalancer: GET /api/users/settings -> 200 (4 ms)
INFO:     127.0.0.1:2242 - "GET /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:44:57,467 INFO crypto-rebalancer: {"ts": 1759999497.467943, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 1.12, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:57,468 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (1 ms)
INFO:     127.0.0.1:3147 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:44:57,472 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=54s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:57,472 INFO crypto-rebalancer: {"ts": 1759999497.4728718, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 0.9, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:57,473 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (1 ms)
INFO:     127.0.0.1:3147 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:44:57,475 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=54s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:44:57,475 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:44:57,475 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:44:57,476 INFO crypto-rebalancer: {"ts": 1759999497.4760299, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 0.98, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:57,476 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (1 ms)
INFO:     127.0.0.1:3147 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:44:57,476 INFO api.deps: Active user: jack
2025-10-09 10:44:57,477 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:44:57,478 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:44:57,478 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:44:57,479 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:44:57,770 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:57,770 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:57,771 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:57,771 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:57,927 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:44:57,927 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:57,927 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:44:57,927 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:44:57,927 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:44:57,927 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:44:57,927 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:57,928 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:57,928 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:58,078 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:44:58,078 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:44:58,078 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:58,078 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:58,078 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:58,078 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:58,078 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:58,320 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63079261519336
2025-10-09 10:44:58,320 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:58,320 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:44:58,320 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226625212667007, 'sharpe_v2': 1.6226625212667007, 'portfolio_structure_score': 82.63079261519336, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763666421847605, 'gri': 16.69284074262188, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.36920738480664, 'final_score': 82.63079261519336, 'inputs': {'hhi': 0.1851293656358313, 'memes_pct': 0.016909166054619014, 'gri': 3.338568148524376, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:58,321 INFO crypto-rebalancer: {"ts": 1759999498.3219388, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 845.94, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:58,323 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (847 ms)
INFO:     127.0.0.1:2242 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90&risk_version=v2_shadow&use_dual_window=true HTTP/1.1" 200 OK
2025-10-09 10:44:58,324 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:44:58,325 INFO api.deps: Active user: jack
2025-10-09 10:44:58,325 INFO crypto-rebalancer: {"ts": 1759999498.325208, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 3.33, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:58,326 INFO api.user_settings_endpoints: Settings saved for user jack: 17 keys
2025-10-09 10:44:58,326 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (4 ms)
INFO:     127.0.0.1:3147 - "GET /api/alerts/active?include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:44:58,326 INFO crypto-rebalancer: {"ts": 1759999498.3267915, "method": "PUT", "path": "/api/users/settings", "status": 200, "duration_ms": 4.98, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:58,326 INFO crypto-rebalancer: PUT /api/users/settings -> 200 (5 ms)
INFO:     127.0.0.1:13714 - "PUT /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:44:58,328 INFO api.deps: Active user: jack
2025-10-09 10:44:58,328 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:44:58,332 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:44:58,332 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:44:58,333 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:44:58,608 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:44:58,608 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:44:58,608 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:58,608 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:58,807 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:44:58,807 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:44:58,807 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:44:58,807 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:44:58,807 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:44:58,807 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:44:58,807 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:44:58,807 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:58,808 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:58,978 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:44:58,978 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:44:58,978 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:44:58,978 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:44:58,978 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:44:58,978 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:44:58,978 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:44:59,224 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63079261519336
2025-10-09 10:44:59,224 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:44:59,224 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:44:59,224 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226625212667007, 'sharpe_v2': 1.6226625212667007, 'portfolio_structure_score': 82.63079261519336, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763666421847605, 'gri': 16.69284074262188, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.36920738480664, 'final_score': 82.63079261519336, 'inputs': {'hhi': 0.1851293656358313, 'memes_pct': 0.016909166054619014, 'gri': 3.338568148524376, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:44:59,225 INFO crypto-rebalancer: {"ts": 1759999499.225392, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 897.41, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:44:59,225 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (897 ms)
INFO:     127.0.0.1:13714 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90&risk_version=v2_shadow&use_dual_window=true HTTP/1.1" 200 OK
2025-10-09 10:45:11,367 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=68s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:11,375 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=68s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:11,375 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=68s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:11,376 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=68s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:11,376 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=68s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:11,376 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:45:11,376 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:45:16,443 INFO api.deps: Active user: jack
2025-10-09 10:45:16,896 INFO httpx: HTTP Request: GET https://api.stlouisfed.org/fred/series/observations?series_id=CBBTCUSD&api_key=9bd7a0628c315137a1a1b404c5dd98cc&file_type=json&observation_start=2014-01-01 "HTTP/1.1 200 OK"
2025-10-09 10:45:16,953 INFO crypto-rebalancer: {"ts": 1759999516.9529822, "method": "GET", "path": "/proxy/fred/bitcoin", "status": 200, "duration_ms": 510.35, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:10382 - "GET /proxy/fred/bitcoin?start_date=2014-01-01 HTTP/1.1" 200 OK
2025-10-09 10:45:16,953 INFO crypto-rebalancer: GET /proxy/fred/bitcoin -> 200 (510 ms)
2025-10-09 10:45:16,961 INFO crypto-rebalancer: {"ts": 1759999516.9612541, "method": "GET", "path": "/static/modules/cycle-navigator.js", "status": 200, "duration_ms": 1.72, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:16,961 INFO crypto-rebalancer: GET /static/modules/cycle-navigator.js -> 200 (1 ms)
INFO:     127.0.0.1:10382 - "GET /static/modules/cycle-navigator.js?v=1759999516957 HTTP/1.1" 200 OK
2025-10-09 10:45:16,969 INFO crypto-rebalancer: {"ts": 1759999516.9695852, "method": "GET", "path": "/static/modules/onchain-indicators.js", "status": 200, "duration_ms": 4.33, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:16,969 INFO crypto-rebalancer: GET /static/modules/onchain-indicators.js -> 200 (4 ms)
INFO:     127.0.0.1:10382 - "GET /static/modules/onchain-indicators.js?v=1759999516957 HTTP/1.1" 200 OK
2025-10-09 10:45:17,587 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:45:17,589 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:45:17,590 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:45:17,601 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:45:17,712 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:45:17,712 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:45:17,712 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:45:17,712 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:17,825 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:45:17,825 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:45:17,825 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:45:17,825 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:45:17,825 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:45:17,825 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:45:17,825 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:45:17,825 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:45:17,825 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:17,952 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:45:17,952 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:45:17,952 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:45:17,952 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:45:17,952 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:45:17,952 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:45:17,952 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:18,165 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:45:18,165 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:45:18,165 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:45:18,165 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:45:18,166 INFO crypto-rebalancer: {"ts": 1759999518.166783, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 581.12, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:18,167 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (581 ms)
INFO:     127.0.0.1:10382 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:45:18,169 INFO crypto-rebalancer: {"ts": 1759999518.1692567, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 1.96, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:18,169 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:45:18,171 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:45:18,171 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:45:18,179 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (12 ms)
INFO:     127.0.0.1:6012 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:45:18,179 INFO crypto-rebalancer: {"ts": 1759999518.1798832, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 12.51, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:18,180 INFO crypto-rebalancer: GET /balances/current -> 200 (13 ms)
INFO:     127.0.0.1:3857 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:45:18,184 INFO crypto-rebalancer: {"ts": 1759999518.1841152, "method": "GET", "path": "/static/modules/onchain-indicators.js", "status": 200, "duration_ms": 16.77, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:18,184 INFO crypto-rebalancer: GET /static/modules/onchain-indicators.js -> 200 (17 ms)
INFO:     127.0.0.1:2594 - "GET /static/modules/onchain-indicators.js?v=1759999518105 HTTP/1.1" 200 OK
2025-10-09 10:45:18,194 INFO crypto-rebalancer: {"ts": 1759999518.194052, "method": "GET", "path": "/static/modules/cycle-navigator.js", "status": 200, "duration_ms": 2.6, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:2594 - "GET /static/modules/cycle-navigator.js?v=1759999518105 HTTP/1.1" 200 OK
2025-10-09 10:45:18,194 INFO crypto-rebalancer: GET /static/modules/cycle-navigator.js -> 200 (2 ms)
2025-10-09 10:45:18,200 INFO api.crypto_toolbox_endpoints: \U0001f504 Scraping fresh data...
2025-10-09 10:45:18,200 WARNING api.crypto_toolbox_endpoints: \u26a0\ufe0f Browser not connected, re-launching...
2025-10-09 10:45:18,200 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:45:18,200 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-224' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:45:18,202 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:45:18,202 ERROR api.crypto_toolbox_endpoints: \u274c Crypto-toolbox scraping error
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 377, in get_crypto_toolbox_data
    return await _get_data(force=force)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 345, in _get_data
    data = await _scrape_crypto_toolbox()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 219, in _scrape_crypto_toolbox
    browser = await _ensure_browser()
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 166, in _ensure_browser
    await startup_playwright()
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 109, in startup_playwright
    _playwright_instance = await async_playwright().start()
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 51, in start
    return await self.__aenter__()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 46, in __aenter__
    playwright = AsyncPlaywright(next(iter(done)).result())
                                 ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:45:18,203 INFO crypto-rebalancer: {"ts": 1759999518.20363, "method": "GET", "path": "/api/crypto-toolbox", "status": 502, "duration_ms": 3.92, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:18,203 INFO crypto-rebalancer: GET /api/crypto-toolbox -> 502 (4 ms)
INFO:     127.0.0.1:2594 - "GET /api/crypto-toolbox HTTP/1.1" 502 Bad Gateway
2025-10-09 10:45:19,298 INFO services.streaming.realtime_engine: WebSocket disconnected: nav_badge, remaining: 0
INFO:     connection closed
2025-10-09 10:45:19,312 INFO crypto-rebalancer: {"ts": 1759999519.3124666, "method": "GET", "path": "/static/analytics-unified.html", "status": 304, "duration_ms": 1.32, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:19,312 INFO crypto-rebalancer: GET /static/analytics-unified.html -> 304 (1 ms)
INFO:     127.0.0.1:2594 - "GET /static/analytics-unified.html HTTP/1.1" 304 Not Modified
2025-10-09 10:45:19,366 INFO crypto-rebalancer: {"ts": 1759999519.3664658, "method": "GET", "path": "/.well-known/appspecific/com.chrome.devtools.json", "status": 404, "duration_ms": 2.01, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:19,366 INFO crypto-rebalancer: GET /.well-known/appspecific/com.chrome.devtools.json -> 404 (2 ms)
INFO:     127.0.0.1:2594 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
INFO:     ('127.0.0.1', 8075) - "WebSocket /api/realtime/ws?client_id=nav_badge" [accepted]
2025-10-09 10:45:19,451 INFO services.streaming.realtime_engine: WebSocket connected: nav_badge, total connections: 1
INFO:     connection open
2025-10-09 10:45:19,453 INFO crypto-rebalancer: {"ts": 1759999519.4529402, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 3.77, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:19,453 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (4 ms)
INFO:     127.0.0.1:2594 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:45:19,458 INFO api.deps: Active user: jack
2025-10-09 10:45:19,462 INFO crypto-rebalancer: {"ts": 1759999519.4620457, "method": "GET", "path": "/config/users.json", "status": 200, "duration_ms": 9.2, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:19,462 INFO crypto-rebalancer: GET /config/users.json -> 200 (9 ms)
INFO:     127.0.0.1:3857 - "GET /config/users.json HTTP/1.1" 200 OK
2025-10-09 10:45:19,462 INFO crypto-rebalancer: {"ts": 1759999519.4625137, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 5.87, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:19,462 INFO crypto-rebalancer: GET /api/users/sources -> 200 (6 ms)
INFO:     127.0.0.1:2594 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:45:19,465 INFO api.crypto_toolbox_endpoints: \U0001f504 Scraping fresh data...
2025-10-09 10:45:19,465 WARNING api.crypto_toolbox_endpoints: \u26a0\ufe0f Browser not connected, re-launching...
2025-10-09 10:45:19,466 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:45:19,466 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-239' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:45:19,470 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:45:19,471 ERROR api.crypto_toolbox_endpoints: \u274c Crypto-toolbox scraping error
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 377, in get_crypto_toolbox_data
    return await _get_data(force=force)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 345, in _get_data
    data = await _scrape_crypto_toolbox()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 219, in _scrape_crypto_toolbox
    browser = await _ensure_browser()
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 166, in _ensure_browser
    await startup_playwright()
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 109, in startup_playwright
    _playwright_instance = await async_playwright().start()
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 51, in start
    return await self.__aenter__()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 46, in __aenter__
    playwright = AsyncPlaywright(next(iter(done)).result())
                                 ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:45:19,475 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=76s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:19,475 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:19,475 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:19,477 INFO crypto-rebalancer: {"ts": 1759999519.4776819, "method": "GET", "path": "/api/crypto-toolbox", "status": 502, "duration_ms": 14.03, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:19,478 INFO api.deps: Active user: jack
2025-10-09 10:45:19,479 INFO crypto-rebalancer: GET /api/crypto-toolbox -> 502 (15 ms)
INFO:     127.0.0.1:6012 - "GET /api/crypto-toolbox HTTP/1.1" 502 Bad Gateway
2025-10-09 10:45:19,479 INFO crypto-rebalancer: {"ts": 1759999519.4794831, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 5.54, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:19,480 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:45:19,481 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:45:19,484 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:45:19,484 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:45:19,485 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:45:19,723 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:45:19,723 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:45:19,723 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:19,723 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:19,917 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:45:19,917 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:45:19,917 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:45:19,918 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:45:19,918 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:45:19,918 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:45:19,918 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:45:19,918 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:19,918 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:20,051 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:45:20,051 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:45:20,051 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:45:20,051 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:45:20,051 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:45:20,051 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:20,051 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:20,307 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63079261519336
2025-10-09 10:45:20,307 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:45:20,307 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:45:20,307 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226625212667007, 'sharpe_v2': 1.6226625212667007, 'portfolio_structure_score': 82.63079261519336, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763666421847605, 'gri': 16.69284074262188, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.36920738480664, 'final_score': 82.63079261519336, 'inputs': {'hhi': 0.1851293656358313, 'memes_pct': 0.016909166054619014, 'gri': 3.338568148524376, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:45:20,308 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (837 ms)
INFO:     127.0.0.1:3857 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:45:20,308 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:45:20,311 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:45:20,312 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:45:20,320 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 365 days
2025-10-09 10:45:20,553 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:45:20,553 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:45:20,553 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:20,553 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:20,722 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 85.0
2025-10-09 10:45:20,722 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:45:20,723 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:45:20,723 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:45:20,723 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:45:20,723 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:45:20,723 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:45:20,723 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:20,723 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:20,890 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:45:20,890 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=85.0, penalties=0.0, final=85.0
2025-10-09 10:45:20,890 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:45:20,890 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:45:20,890 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:45:20,890 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:20,890 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:21,169 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:45:21,169 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.33, Vol=0.20, MaxDD=-10.64%, RiskScore=85.0, RiskStructural=47.0 [Dual-Window: FI fallback only]
2025-10-09 10:45:21,169 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:45:21,169 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 85.0, 'risk_score_v2': 85.0, 'sharpe_legacy': 1.3262890739554856, 'sharpe_v2': 1.3262890739554856, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 47.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 5.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:45:21,171 INFO crypto-rebalancer: {"ts": 1759999521.171874, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 1705.6, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:21,172 INFO crypto-rebalancer: {"ts": 1759999521.1720629, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 1697.76, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:21,172 INFO crypto-rebalancer: {"ts": 1759999521.1725054, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 1695.09, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:21,172 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (1708 ms)
INFO:     127.0.0.1:10382 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:45:21,173 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (1698 ms)
INFO:     127.0.0.1:11682 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:45:21,173 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (1696 ms)
INFO:     127.0.0.1:14160 - "GET /api/risk/dashboard?min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:45:21,175 INFO crypto-rebalancer: {"ts": 1759999521.1751418, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 1696.39, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:21,175 INFO crypto-rebalancer: GET /taxonomy -> 200 (1697 ms)
INFO:     127.0.0.1:2594 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:45:21,181 INFO crypto-rebalancer: {"ts": 1759999521.18133, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 1.93, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:21,181 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:2594 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:45:21,348 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:45:21,352 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:45:21,353 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:45:21,365 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:45:21,495 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:45:21,495 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:45:21,495 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:45:21,495 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:21,639 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:45:21,639 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:45:21,639 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:45:21,639 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:45:21,639 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:45:21,639 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:45:21,639 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:45:21,639 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:45:21,639 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:21,846 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:45:21,846 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:45:21,846 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:45:21,846 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:45:21,846 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:45:21,846 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:45:21,847 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:22,244 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:45:22,244 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:45:22,244 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:45:22,244 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:45:22,245 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:45:22,246 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:45:22,246 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:45:22,255 INFO crypto-rebalancer: {"ts": 1759999522.2551649, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 908.12, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,264 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=79s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:22,265 INFO crypto-rebalancer: {"ts": 1759999522.2651134, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 917.19, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,265 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (918 ms)
INFO:     127.0.0.1:2594 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:45:22,265 INFO api.deps: Active user: jack
2025-10-09 10:45:22,265 INFO crypto-rebalancer: GET /balances/current -> 200 (918 ms)
INFO:     127.0.0.1:14160 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:45:22,266 INFO crypto-rebalancer: {"ts": 1759999522.2665315, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 11.5, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,266 INFO crypto-rebalancer: {"ts": 1759999522.2666483, "method": "GET", "path": "/api/ml/debug/pipeline-info", "status": 200, "duration_ms": 11.59, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,266 INFO crypto-rebalancer: {"ts": 1759999522.2667465, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 11.66, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,269 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (14 ms)
INFO:     127.0.0.1:10382 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:45:22,270 INFO crypto-rebalancer: GET /api/ml/debug/pipeline-info -> 200 (15 ms)
INFO:     127.0.0.1:11682 - "GET /api/ml/debug/pipeline-info HTTP/1.1" 200 OK
2025-10-09 10:45:22,270 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (15 ms)
INFO:     127.0.0.1:3857 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:45:22,271 INFO crypto-rebalancer: {"ts": 1759999522.2713802, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 16.39, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,272 INFO crypto-rebalancer: GET /api/users/sources -> 200 (17 ms)
INFO:     127.0.0.1:6012 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:45:22,273 INFO crypto-rebalancer: {"ts": 1759999522.2735813, "method": "GET", "path": "/favicon.ico", "status": 200, "duration_ms": 2.3, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,273 INFO api.deps: Active user: jack
2025-10-09 10:45:22,274 INFO crypto-rebalancer: GET /favicon.ico -> 200 (3 ms)
INFO:     127.0.0.1:2594 - "GET /favicon.ico HTTP/1.1" 200 OK
2025-10-09 10:45:22,274 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=79s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:22,275 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:45:22,277 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:45:22,277 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:45:22,282 INFO crypto-rebalancer: {"ts": 1759999522.2821918, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 8.41, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,283 INFO crypto-rebalancer: {"ts": 1759999522.2835429, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 11.86, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,283 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (10 ms)
INFO:     127.0.0.1:3857 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:45:22,285 INFO crypto-rebalancer: GET /balances/current -> 200 (13 ms)
INFO:     127.0.0.1:14160 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:45:22,285 INFO crypto-rebalancer: {"ts": 1759999522.2853627, "method": "GET", "path": "/api/ml/volatility/predict/BTC", "status": 200, "duration_ms": 3.6, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,285 INFO api.deps: Active user: jack
2025-10-09 10:45:22,285 INFO crypto-rebalancer: GET /api/ml/volatility/predict/BTC -> 200 (4 ms)
INFO:     127.0.0.1:6012 - "GET /api/ml/volatility/predict/BTC?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:22,289 INFO crypto-rebalancer: {"ts": 1759999522.2889001, "method": "GET", "path": "/api/users/settings", "status": 200, "duration_ms": 5.45, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,289 INFO crypto-rebalancer: GET /api/users/settings -> 200 (6 ms)
INFO:     127.0.0.1:11682 - "GET /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:45:22,297 INFO crypto-rebalancer: {"ts": 1759999522.2979245, "method": "GET", "path": "/api/ml/volatility/predict/ETH", "status": 200, "duration_ms": 0.65, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,298 INFO crypto-rebalancer: GET /api/ml/volatility/predict/ETH -> 200 (0 ms)
INFO:     127.0.0.1:11682 - "GET /api/ml/volatility/predict/ETH?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:22,309 INFO api.deps: Active user: jack
2025-10-09 10:45:22,309 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:45:22,312 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:45:22,312 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:45:22,581 INFO crypto-rebalancer: {"ts": 1759999522.5812094, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 273.33, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,581 INFO api.deps: Active user: jack
2025-10-09 10:45:22,581 INFO crypto-rebalancer: GET /balances/current -> 200 (273 ms)
INFO:     127.0.0.1:6012 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:45:22,582 INFO api.user_settings_endpoints: Settings saved for user jack: 17 keys
2025-10-09 10:45:22,583 INFO crypto-rebalancer: {"ts": 1759999522.5834646, "method": "PUT", "path": "/api/users/settings", "status": 200, "duration_ms": 275.78, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,583 INFO crypto-rebalancer: PUT /api/users/settings -> 200 (276 ms)
INFO:     127.0.0.1:11682 - "PUT /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:45:22,586 INFO crypto-rebalancer: {"ts": 1759999522.5859735, "method": "GET", "path": "/api/config/data-source", "status": 200, "duration_ms": 1.21, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:45:22,586 INFO crypto-rebalancer: GET /api/config/data-source -> 200 (1 ms)
INFO:     127.0.0.1:2255 - "GET /api/config/data-source HTTP/1.1" 200 OK
2025-10-09 10:45:22,586 INFO httpx: HTTP Request: GET http://127.0.0.1:8000/api/config/data-source "HTTP/1.1 200 OK"
2025-10-09 10:45:22,587 INFO services.ml.orchestrator: Using data source from config API: cointracking
2025-10-09 10:45:22,587 INFO crypto-rebalancer: {"ts": 1759999522.587838, "method": "GET", "path": "/api/ml/regime/current", "status": 200, "duration_ms": 278.03, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,588 INFO crypto-rebalancer: GET /api/ml/regime/current -> 200 (278 ms)
INFO:     127.0.0.1:14160 - "GET /api/ml/regime/current HTTP/1.1" 200 OK
2025-10-09 10:45:22,593 INFO crypto-rebalancer: {"ts": 1759999522.593927, "method": "GET", "path": "/api/ml/sentiment/fear-greed", "status": 200, "duration_ms": 1.14, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,594 INFO crypto-rebalancer: GET /api/ml/sentiment/fear-greed -> 200 (1 ms)
INFO:     127.0.0.1:14160 - "GET /api/ml/sentiment/fear-greed?days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:22,807 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=79s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:22,807 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:22,807 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:22,807 INFO crypto-rebalancer: {"ts": 1759999522.8079646, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 1.0, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,808 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (1 ms)
INFO:     127.0.0.1:14160 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:45:22,815 INFO crypto-rebalancer: {"ts": 1759999522.8154893, "method": "GET", "path": "/static/components/UnifiedInsights.js", "status": 200, "duration_ms": 7.56, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,816 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=79s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:22,816 INFO crypto-rebalancer: GET /static/components/UnifiedInsights.js -> 200 (8 ms)
INFO:     127.0.0.1:11682 - "GET /static/components/UnifiedInsights.js?v=2025-10-09T08:45:22.806Z HTTP/1.1" 200 OK
2025-10-09 10:45:22,817 INFO crypto-rebalancer: {"ts": 1759999522.8176093, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 2.22, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,817 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (2 ms)
INFO:     127.0.0.1:14160 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:45:22,823 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=79s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:22,823 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:22,823 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:22,824 INFO crypto-rebalancer: {"ts": 1759999522.8244395, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 1.0, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,824 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (1 ms)
INFO:     127.0.0.1:11682 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:45:22,830 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=79s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:22,830 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:45:22,830 INFO crypto-rebalancer: {"ts": 1759999522.830594, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.54, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,830 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:11682 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:22,831 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=79s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:22,831 INFO crypto-rebalancer: {"ts": 1759999522.8316042, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 0.8, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,831 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (1 ms)
INFO:     127.0.0.1:14160 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:45:22,835 INFO api.deps: Active user: jack
2025-10-09 10:45:22,835 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:45:22,840 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:45:22,840 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:45:22,844 INFO crypto-rebalancer: {"ts": 1759999522.8447456, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 10.27, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,845 INFO crypto-rebalancer: GET /balances/current -> 200 (11 ms)
INFO:     127.0.0.1:14160 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:45:22,846 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:45:22,847 INFO crypto-rebalancer: {"ts": 1759999522.8469987, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 2.33, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,847 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (2 ms)
INFO:     127.0.0.1:11682 - "GET /api/alerts/active?include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:45:22,866 INFO crypto-rebalancer: {"ts": 1759999522.8669004, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.04, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,867 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:11682 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:45:22,877 INFO crypto-rebalancer: {"ts": 1759999522.8775227, "method": "GET", "path": "/static/components/decision-index-panel.js", "status": 200, "duration_ms": 4.03, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,877 INFO crypto-rebalancer: GET /static/components/decision-index-panel.js -> 200 (4 ms)
INFO:     127.0.0.1:11682 - "GET /static/components/decision-index-panel.js?v=1759999522871 HTTP/1.1" 200 OK
2025-10-09 10:45:22,888 INFO crypto-rebalancer: {"ts": 1759999522.8880465, "method": "GET", "path": "/static/core/unified-insights-v2.js", "status": 200, "duration_ms": 5.86, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,888 INFO crypto-rebalancer: GET /static/core/unified-insights-v2.js -> 200 (6 ms)
INFO:     127.0.0.1:11682 - "GET /static/core/unified-insights-v2.js?v=1759999522871 HTTP/1.1" 200 OK
2025-10-09 10:45:22,895 INFO crypto-rebalancer: {"ts": 1759999522.895097, "method": "GET", "path": "/static/utils/di-history.js", "status": 200, "duration_ms": 2.72, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,895 INFO crypto-rebalancer: GET /static/utils/di-history.js -> 200 (3 ms)
INFO:     127.0.0.1:11682 - "GET /static/utils/di-history.js?v=1759999522871 HTTP/1.1" 200 OK
2025-10-09 10:45:22,902 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=79s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:22,902 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:45:22,902 INFO crypto-rebalancer: {"ts": 1759999522.9026024, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.61, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,902 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:11682 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:22,918 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=79s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:22,918 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:45:22,918 INFO crypto-rebalancer: {"ts": 1759999522.9186046, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.8, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:22,918 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (2 ms)
INFO:     127.0.0.1:11682 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:23,316 INFO crypto-rebalancer: {"ts": 1759999523.3165364, "method": "GET", "path": "/static/components/UnifiedInsights.js", "status": 200, "duration_ms": 4.53, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:23,316 INFO crypto-rebalancer: GET /static/components/UnifiedInsights.js -> 200 (4 ms)
INFO:     127.0.0.1:11682 - "GET /static/components/UnifiedInsights.js?v=2025-10-09T08:45:23.310Z HTTP/1.1" 200 OK
2025-10-09 10:45:23,323 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=80s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:23,324 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:45:23,324 INFO crypto-rebalancer: {"ts": 1759999523.3243318, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 0.88, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:23,324 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:11682 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:23,333 INFO crypto-rebalancer: {"ts": 1759999523.3336954, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 1.53, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:23,333 INFO crypto-rebalancer: GET /taxonomy -> 200 (1 ms)
INFO:     127.0.0.1:11682 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:45:23,343 INFO crypto-rebalancer: {"ts": 1759999523.3437722, "method": "GET", "path": "/static/components/decision-index-panel.js", "status": 200, "duration_ms": 3.58, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:11682 - "GET /static/components/decision-index-panel.js?v=1759999523338 HTTP/1.1" 200 OK
2025-10-09 10:45:23,344 INFO crypto-rebalancer: GET /static/components/decision-index-panel.js -> 200 (3 ms)
2025-10-09 10:45:23,354 INFO crypto-rebalancer: {"ts": 1759999523.3546216, "method": "GET", "path": "/static/core/unified-insights-v2.js", "status": 200, "duration_ms": 6.13, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:23,354 INFO crypto-rebalancer: GET /static/core/unified-insights-v2.js -> 200 (6 ms)
INFO:     127.0.0.1:11682 - "GET /static/core/unified-insights-v2.js?v=1759999523338 HTTP/1.1" 200 OK
2025-10-09 10:45:23,362 INFO crypto-rebalancer: {"ts": 1759999523.3627846, "method": "GET", "path": "/static/utils/di-history.js", "status": 200, "duration_ms": 2.57, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:23,362 INFO crypto-rebalancer: GET /static/utils/di-history.js -> 200 (2 ms)
INFO:     127.0.0.1:11682 - "GET /static/utils/di-history.js?v=1759999523338 HTTP/1.1" 200 OK
2025-10-09 10:45:23,367 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=80s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:23,367 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:45:23,368 INFO crypto-rebalancer: {"ts": 1759999523.3682132, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.09, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:23,368 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:11682 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:23,380 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=80s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:23,380 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:45:23,380 INFO crypto-rebalancer: {"ts": 1759999523.3806922, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 0.94, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:23,380 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:11682 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:26,446 INFO apscheduler.executors.default: Running job "P&L Snapshot Intraday (trigger: cron[hour='7-23', minute='*/15'], next run at: 2025-10-09 11:00:51 CEST)" (scheduled at 2025-10-09 10:45:26.433738+02:00)
2025-10-09 10:45:26,446 INFO api.scheduler: \U0001f504 [pnl_intraday] Starting P&L intraday snapshot...
2025-10-09 10:45:26,449 INFO scripts.pnl_snapshot: \U0001f4f8 Creating intraday portfolio snapshot - 2025-10-09 10:45:26
2025-10-09 10:45:26,449 INFO scripts.pnl_snapshot:    User: jack
2025-10-09 10:45:26,449 INFO scripts.pnl_snapshot:    Source: cointracking_api
2025-10-09 10:45:26,449 INFO scripts.pnl_snapshot:    Min USD: 1.0
2025-10-09 10:45:26,862 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:45:26,864 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:45:26,865 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:45:26,908 INFO services.portfolio: Snapshot mis � jour pour jack/cointracking_api le 2025-10-09
2025-10-09 10:45:26,910 INFO services.portfolio: Portfolio snapshot sauv� (453980.83 USD) for user=jack, source=cointracking_api
2025-10-09 10:45:26,911 INFO crypto-rebalancer: {"ts": 1759999526.9115236, "method": "POST", "path": "/portfolio/snapshot", "status": 200, "duration_ms": 50.31, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:45:26,911 INFO crypto-rebalancer: POST /portfolio/snapshot -> 200 (50 ms)
INFO:     127.0.0.1:1850 - "POST /portfolio/snapshot?source=cointracking_api&user_id=jack&min_usd=1.0 HTTP/1.1" 200 OK
2025-10-09 10:45:26,912 INFO httpx: HTTP Request: POST http://localhost:8000/portfolio/snapshot?source=cointracking_api&user_id=jack&min_usd=1.0 "HTTP/1.1 200 OK"
2025-10-09 10:45:26,913 INFO scripts.pnl_snapshot: \u2705 Snapshot created successfully
2025-10-09 10:45:26,913 INFO api.scheduler: \u2705 [pnl_intraday] P&L snapshot completed in 467ms
2025-10-09 10:45:26,914 INFO apscheduler.executors.default: Job "P&L Snapshot Intraday (trigger: cron[hour='7-23', minute='*/15'], next run at: 2025-10-09 11:00:51 CEST)" executed successfully
2025-10-09 10:45:43,435 INFO services.streaming.realtime_engine: WebSocket disconnected: nav_badge, remaining: 0
INFO:     connection closed
2025-10-09 10:45:43,442 INFO crypto-rebalancer: {"ts": 1759999543.4425588, "method": "GET", "path": "/static/analytics-unified.html", "status": 304, "duration_ms": 1.48, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:43,442 INFO crypto-rebalancer: GET /static/analytics-unified.html -> 304 (1 ms)
INFO:     127.0.0.1:13305 - "GET /static/analytics-unified.html HTTP/1.1" 304 Not Modified
2025-10-09 10:45:43,488 INFO crypto-rebalancer: {"ts": 1759999543.4881222, "method": "GET", "path": "/.well-known/appspecific/com.chrome.devtools.json", "status": 404, "duration_ms": 1.72, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:43,488 INFO crypto-rebalancer: GET /.well-known/appspecific/com.chrome.devtools.json -> 404 (2 ms)
INFO:     127.0.0.1:13305 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
INFO:     ('127.0.0.1', 12488) - "WebSocket /api/realtime/ws?client_id=nav_badge" [accepted]
2025-10-09 10:45:43,565 INFO services.streaming.realtime_engine: WebSocket connected: nav_badge, total connections: 1
INFO:     connection open
2025-10-09 10:45:43,569 INFO crypto-rebalancer: {"ts": 1759999543.5694418, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 2.94, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:43,572 INFO api.crypto_toolbox_endpoints: \U0001f504 Scraping fresh data...
2025-10-09 10:45:43,572 WARNING api.crypto_toolbox_endpoints: \u26a0\ufe0f Browser not connected, re-launching...
2025-10-09 10:45:43,572 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:45:43,574 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (7 ms)
INFO:     127.0.0.1:6402 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:45:43,574 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-312' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:45:43,577 INFO api.deps: Active user: jack
2025-10-09 10:45:43,578 INFO api.deps: Active user: jack
2025-10-09 10:45:43,579 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:45:43,579 ERROR api.crypto_toolbox_endpoints: \u274c Crypto-toolbox scraping error
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 377, in get_crypto_toolbox_data
    return await _get_data(force=force)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 345, in _get_data
    data = await _scrape_crypto_toolbox()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 219, in _scrape_crypto_toolbox
    browser = await _ensure_browser()
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 166, in _ensure_browser
    await startup_playwright()
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 109, in startup_playwright
    _playwright_instance = await async_playwright().start()
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 51, in start
    return await self.__aenter__()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 46, in __aenter__
    playwright = AsyncPlaywright(next(iter(done)).result())
                                 ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:45:43,583 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:45:43,585 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:45:43,585 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:45:43,590 INFO crypto-rebalancer: {"ts": 1759999543.590249, "method": "GET", "path": "/api/crypto-toolbox", "status": 502, "duration_ms": 20.99, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:43,590 INFO crypto-rebalancer: {"ts": 1759999543.5909274, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 21.62, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:43,591 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:45:43,592 INFO crypto-rebalancer: GET /api/crypto-toolbox -> 502 (23 ms)
INFO:     127.0.0.1:11297 - "GET /api/crypto-toolbox HTTP/1.1" 502 Bad Gateway
2025-10-09 10:45:43,593 INFO crypto-rebalancer: GET /api/users/sources -> 200 (24 ms)
INFO:     127.0.0.1:8554 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:45:43,594 INFO crypto-rebalancer: {"ts": 1759999543.5943608, "method": "GET", "path": "/config/users.json", "status": 200, "duration_ms": 31.52, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:43,594 INFO crypto-rebalancer: {"ts": 1759999543.5945096, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 25.14, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:43,595 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:45:43,598 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:45:43,598 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:45:43,610 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 365 days
2025-10-09 10:45:43,890 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:45:43,890 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:45:43,890 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:43,890 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:44,016 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 85.0
2025-10-09 10:45:44,016 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:45:44,016 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:45:44,016 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:45:44,016 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:45:44,016 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:45:44,016 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:45:44,016 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:44,016 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:44,174 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:45:44,174 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=85.0, penalties=0.0, final=85.0
2025-10-09 10:45:44,174 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:45:44,174 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:45:44,174 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:45:44,175 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:44,175 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:44,419 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:45:44,419 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.33, Vol=0.20, MaxDD=-10.64%, RiskScore=85.0, RiskStructural=47.0 [Dual-Window: FI fallback only]
2025-10-09 10:45:44,419 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:45:44,419 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 85.0, 'risk_score_v2': 85.0, 'sharpe_legacy': 1.3262890739554856, 'sharpe_v2': 1.3262890739554856, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 47.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 5.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:45:44,420 INFO crypto-rebalancer: GET /config/users.json -> 200 (858 ms)
INFO:     127.0.0.1:13305 - "GET /config/users.json HTTP/1.1" 200 OK
2025-10-09 10:45:44,421 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (851 ms)
INFO:     127.0.0.1:5079 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:45:44,422 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:45:44,652 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:45:44,653 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:45:44,653 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:44,653 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:44,843 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:45:44,843 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:45:44,843 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:45:44,843 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:45:44,843 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:45:44,843 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:45:44,843 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:45:44,843 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:44,843 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:45,003 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:45:45,004 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:45:45,004 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:45:45,004 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:45:45,004 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:45:45,004 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:45,004 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:45,287 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63146823786393
2025-10-09 10:45:45,287 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:45:45,287 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:45:45,287 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226790300213811, 'sharpe_v2': 1.6226790300213811, 'portfolio_structure_score': 82.63146823786393, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763573266090467, 'gri': 16.69217443552703, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.368531762136076, 'final_score': 82.63146823786393, 'inputs': {'hhi': 0.18513007540566773, 'memes_pct': 0.016908933165226167, 'gri': 3.3384348871054055, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:45:45,290 INFO crypto-rebalancer: {"ts": 1759999545.2907372, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 1700.56, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:45,291 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=102s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:45,291 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:45,291 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:45,292 INFO crypto-rebalancer: {"ts": 1759999545.2928338, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 1723.65, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:45,292 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (1703 ms)
INFO:     127.0.0.1:6402 - "GET /api/risk/dashboard?min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:45:45,293 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (1724 ms)
INFO:     127.0.0.1:9495 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:45:45,294 INFO crypto-rebalancer: {"ts": 1759999545.2940307, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 4.06, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:45,294 INFO crypto-rebalancer: {"ts": 1759999545.2943852, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 1704.46, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:45,294 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (873 ms)
INFO:     127.0.0.1:11297 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:45:45,295 INFO crypto-rebalancer: GET /taxonomy -> 200 (1705 ms)
INFO:     127.0.0.1:6806 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:45:45,300 INFO crypto-rebalancer: {"ts": 1759999545.3003387, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.21, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:45,300 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:6806 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:45:45,478 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:45:45,479 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:45:45,479 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:45:45,488 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:45:45,612 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:45:45,612 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:45:45,612 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:45:45,612 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:45,734 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:45:45,734 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:45:45,734 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:45:45,734 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:45:45,734 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:45:45,734 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:45:45,734 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:45:45,734 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:45:45,734 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:45,924 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:45:45,924 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:45:45,924 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:45:45,924 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:45:45,924 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:45:45,924 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:45:45,925 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:46,168 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:45:46,168 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:45:46,168 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:45:46,169 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:45:46,171 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:45:46,175 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:45:46,175 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:45:46,188 INFO crypto-rebalancer: {"ts": 1759999546.1885471, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 711.72, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:46,189 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=103s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:46,202 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (726 ms)
INFO:     127.0.0.1:6806 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:45:46,203 INFO crypto-rebalancer: {"ts": 1759999546.2035499, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 725.88, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:46,203 INFO api.deps: Active user: jack
2025-10-09 10:45:46,204 INFO crypto-rebalancer: {"ts": 1759999546.204159, "method": "GET", "path": "/favicon.ico", "status": 200, "duration_ms": 32.6, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:46,204 INFO crypto-rebalancer: {"ts": 1759999546.204293, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 32.67, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:46,204 INFO crypto-rebalancer: {"ts": 1759999546.2043967, "method": "GET", "path": "/api/ml/debug/pipeline-info", "status": 200, "duration_ms": 32.65, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:46,204 INFO crypto-rebalancer: {"ts": 1759999546.2045426, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 32.75, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:46,204 INFO crypto-rebalancer: GET /balances/current -> 200 (727 ms)
INFO:     127.0.0.1:11297 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:45:46,209 INFO crypto-rebalancer: GET /favicon.ico -> 200 (37 ms)
INFO:     127.0.0.1:8554 - "GET /favicon.ico HTTP/1.1" 200 OK
2025-10-09 10:45:46,209 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (38 ms)
INFO:     127.0.0.1:6402 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:45:46,209 INFO crypto-rebalancer: GET /api/ml/debug/pipeline-info -> 200 (38 ms)
INFO:     127.0.0.1:9495 - "GET /api/ml/debug/pipeline-info HTTP/1.1" 200 OK
2025-10-09 10:45:46,209 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (38 ms)
INFO:     127.0.0.1:5079 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:45:46,210 INFO crypto-rebalancer: {"ts": 1759999546.2106164, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 38.93, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:46,211 INFO crypto-rebalancer: GET /api/users/sources -> 200 (39 ms)
INFO:     127.0.0.1:13305 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:45:46,213 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=103s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:46,214 INFO crypto-rebalancer: {"ts": 1759999546.2142003, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 1.19, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:46,215 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (2 ms)
INFO:     127.0.0.1:13305 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:45:46,216 INFO crypto-rebalancer: {"ts": 1759999546.216115, "method": "GET", "path": "/api/ml/volatility/predict/BTC", "status": 200, "duration_ms": 1.98, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:46,217 INFO crypto-rebalancer: GET /api/ml/volatility/predict/BTC -> 200 (3 ms)
INFO:     127.0.0.1:5079 - "GET /api/ml/volatility/predict/BTC?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:46,217 INFO api.deps: Active user: jack
2025-10-09 10:45:46,219 INFO crypto-rebalancer: {"ts": 1759999546.2196782, "method": "GET", "path": "/api/users/settings", "status": 200, "duration_ms": 3.81, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:46,219 INFO crypto-rebalancer: GET /api/users/settings -> 200 (4 ms)
INFO:     127.0.0.1:6402 - "GET /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:45:46,221 INFO crypto-rebalancer: {"ts": 1759999546.2210174, "method": "GET", "path": "/api/ml/volatility/predict/ETH", "status": 200, "duration_ms": 0.8, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:46,221 INFO crypto-rebalancer: GET /api/ml/volatility/predict/ETH -> 200 (1 ms)
INFO:     127.0.0.1:5079 - "GET /api/ml/volatility/predict/ETH?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:46,432 INFO api.deps: Active user: jack
2025-10-09 10:45:46,433 INFO api.user_settings_endpoints: Settings saved for user jack: 17 keys
2025-10-09 10:45:46,435 INFO crypto-rebalancer: {"ts": 1759999546.435004, "method": "PUT", "path": "/api/users/settings", "status": 200, "duration_ms": 211.37, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:46,435 INFO crypto-rebalancer: PUT /api/users/settings -> 200 (211 ms)
INFO:     127.0.0.1:5079 - "PUT /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:45:46,438 INFO crypto-rebalancer: {"ts": 1759999546.4381998, "method": "GET", "path": "/api/config/data-source", "status": 200, "duration_ms": 2.25, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:45:46,438 INFO crypto-rebalancer: GET /api/config/data-source -> 200 (3 ms)
INFO:     127.0.0.1:3746 - "GET /api/config/data-source HTTP/1.1" 200 OK
2025-10-09 10:45:46,439 INFO httpx: HTTP Request: GET http://127.0.0.1:8000/api/config/data-source "HTTP/1.1 200 OK"
2025-10-09 10:45:46,440 INFO services.ml.orchestrator: Using data source from config API: cointracking
2025-10-09 10:45:46,441 INFO crypto-rebalancer: {"ts": 1759999546.441114, "method": "GET", "path": "/api/ml/regime/current", "status": 200, "duration_ms": 216.75, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:46,441 INFO crypto-rebalancer: GET /api/ml/regime/current -> 200 (217 ms)
INFO:     127.0.0.1:6402 - "GET /api/ml/regime/current HTTP/1.1" 200 OK
2025-10-09 10:45:46,447 INFO crypto-rebalancer: {"ts": 1759999546.4473548, "method": "GET", "path": "/api/ml/sentiment/fear-greed", "status": 200, "duration_ms": 1.3, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:46,447 INFO crypto-rebalancer: GET /api/ml/sentiment/fear-greed -> 200 (1 ms)
INFO:     127.0.0.1:6402 - "GET /api/ml/sentiment/fear-greed?days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:47,235 INFO crypto-rebalancer: {"ts": 1759999547.2353988, "method": "GET", "path": "/static/components/UnifiedInsights.js", "status": 200, "duration_ms": 9.12, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:47,235 INFO crypto-rebalancer: GET /static/components/UnifiedInsights.js -> 200 (9 ms)
INFO:     127.0.0.1:6402 - "GET /static/components/UnifiedInsights.js?v=2025-10-09T08:45:47.224Z HTTP/1.1" 200 OK
2025-10-09 10:45:47,243 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=104s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:47,243 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:45:47,243 INFO crypto-rebalancer: {"ts": 1759999547.243657, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 0.86, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:47,243 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:6402 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:47,247 INFO api.deps: Active user: jack
2025-10-09 10:45:47,247 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:45:47,249 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:45:47,249 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:45:47,252 INFO crypto-rebalancer: {"ts": 1759999547.2526066, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 5.84, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:47,252 INFO crypto-rebalancer: GET /balances/current -> 200 (6 ms)
INFO:     127.0.0.1:6402 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:45:47,383 INFO crypto-rebalancer: {"ts": 1759999547.3831966, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.52, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:47,383 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:6402 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:45:48,393 INFO api.deps: Active user: jack
2025-10-09 10:45:48,394 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:45:48,395 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:45:48,395 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:45:48,400 INFO crypto-rebalancer: {"ts": 1759999548.4003038, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 7.63, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:5079 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:45:48,401 INFO crypto-rebalancer: GET /balances/current -> 200 (8 ms)
2025-10-09 10:45:48,403 INFO crypto-rebalancer: {"ts": 1759999548.403276, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 10.81, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:48,403 INFO crypto-rebalancer: GET /taxonomy -> 200 (11 ms)
INFO:     127.0.0.1:6402 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:45:48,414 INFO crypto-rebalancer: {"ts": 1759999548.41482, "method": "GET", "path": "/static/components/decision-index-panel.js", "status": 200, "duration_ms": 3.76, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:48,415 INFO crypto-rebalancer: GET /static/components/decision-index-panel.js -> 200 (4 ms)
INFO:     127.0.0.1:6402 - "GET /static/components/decision-index-panel.js?v=1759999548408 HTTP/1.1" 200 OK
2025-10-09 10:45:48,424 INFO crypto-rebalancer: {"ts": 1759999548.4244888, "method": "GET", "path": "/static/core/unified-insights-v2.js", "status": 200, "duration_ms": 4.75, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:6402 - "GET /static/core/unified-insights-v2.js?v=1759999548408 HTTP/1.1" 200 OK
2025-10-09 10:45:48,424 INFO crypto-rebalancer: GET /static/core/unified-insights-v2.js -> 200 (5 ms)
2025-10-09 10:45:48,432 INFO crypto-rebalancer: {"ts": 1759999548.4329355, "method": "GET", "path": "/static/utils/di-history.js", "status": 200, "duration_ms": 2.63, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:48,433 INFO crypto-rebalancer: GET /static/utils/di-history.js -> 200 (2 ms)
INFO:     127.0.0.1:6402 - "GET /static/utils/di-history.js?v=1759999548408 HTTP/1.1" 200 OK
2025-10-09 10:45:48,438 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=105s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:48,438 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:45:48,438 INFO crypto-rebalancer: {"ts": 1759999548.438631, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.5, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:48,438 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:6402 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:48,450 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=105s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:48,450 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:45:48,450 INFO crypto-rebalancer: {"ts": 1759999548.4506168, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.5, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:48,450 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:6402 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:45:54,565 INFO services.streaming.realtime_engine: WebSocket disconnected: nav_badge, remaining: 0
INFO:     connection closed
2025-10-09 10:45:54,636 INFO crypto-rebalancer: {"ts": 1759999554.6360335, "method": "GET", "path": "/.well-known/appspecific/com.chrome.devtools.json", "status": 404, "duration_ms": 1.66, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:54,636 INFO crypto-rebalancer: GET /.well-known/appspecific/com.chrome.devtools.json -> 404 (1 ms)
INFO:     127.0.0.1:12354 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
2025-10-09 10:45:54,713 INFO api.crypto_toolbox_endpoints: \U0001f504 Scraping fresh data...
2025-10-09 10:45:54,713 WARNING api.crypto_toolbox_endpoints: \u26a0\ufe0f Browser not connected, re-launching...
2025-10-09 10:45:54,713 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:45:54,713 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-351' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:45:54,716 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:45:54,716 ERROR api.crypto_toolbox_endpoints: \u274c Crypto-toolbox scraping error
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 377, in get_crypto_toolbox_data
    return await _get_data(force=force)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 345, in _get_data
    data = await _scrape_crypto_toolbox()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 219, in _scrape_crypto_toolbox
    browser = await _ensure_browser()
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 166, in _ensure_browser
    await startup_playwright()
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 109, in startup_playwright
    _playwright_instance = await async_playwright().start()
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 51, in start
    return await self.__aenter__()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 46, in __aenter__
    playwright = AsyncPlaywright(next(iter(done)).result())
                                 ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:45:54,720 INFO crypto-rebalancer: {"ts": 1759999554.7206883, "method": "GET", "path": "/api/crypto-toolbox", "status": 502, "duration_ms": 8.57, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:54,722 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=111s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:54,722 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:54,722 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:54,723 INFO crypto-rebalancer: GET /api/crypto-toolbox -> 502 (11 ms)
INFO:     127.0.0.1:12354 - "GET /api/crypto-toolbox HTTP/1.1" 502 Bad Gateway
2025-10-09 10:45:54,725 INFO api.deps: Active user: jack
2025-10-09 10:45:54,726 INFO crypto-rebalancer: {"ts": 1759999554.726049, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 5.58, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:54,726 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:45:54,729 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:45:54,729 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:45:54,731 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:45:54,980 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:45:54,980 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:45:54,980 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:54,980 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:55,085 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:45:55,085 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:45:55,086 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:45:55,086 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:45:55,086 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:45:55,086 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:45:55,086 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:45:55,086 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:55,086 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:55,242 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:45:55,242 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:45:55,242 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:45:55,242 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:45:55,242 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:45:55,242 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:55,242 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:55,536 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63146823786393
2025-10-09 10:45:55,536 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:45:55,536 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:45:55,536 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226790300213811, 'sharpe_v2': 1.6226790300213811, 'portfolio_structure_score': 82.63146823786393, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763573266090467, 'gri': 16.69217443552703, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.368531762136076, 'final_score': 82.63146823786393, 'inputs': {'hhi': 0.18513007540566773, 'memes_pct': 0.016908933165226167, 'gri': 3.3384348871054055, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:45:55,538 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (818 ms)
INFO:     127.0.0.1:3201 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:45:55,539 INFO crypto-rebalancer: {"ts": 1759999555.5393767, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 818.77, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:55,539 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:45:55,540 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (820 ms)
INFO:     127.0.0.1:7516 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:45:55,541 INFO crypto-rebalancer: {"ts": 1759999555.5410845, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 820.69, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:55,541 INFO crypto-rebalancer: {"ts": 1759999555.541216, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 820.67, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:55,541 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (821 ms)
INFO:     127.0.0.1:3231 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:45:55,541 INFO crypto-rebalancer: GET /taxonomy -> 200 (821 ms)
INFO:     127.0.0.1:4962 - "GET /taxonomy HTTP/1.1" 200 OK
INFO:     ('127.0.0.1', 12816) - "WebSocket /api/realtime/ws?client_id=nav_badge" [accepted]
2025-10-09 10:45:55,553 INFO services.streaming.realtime_engine: WebSocket connected: nav_badge, total connections: 1
INFO:     connection open
2025-10-09 10:45:55,555 INFO crypto-rebalancer: {"ts": 1759999555.5549917, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 3.29, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:55,556 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (5 ms)
INFO:     127.0.0.1:3231 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:45:55,557 INFO api.deps: Active user: jack
2025-10-09 10:45:55,563 INFO crypto-rebalancer: {"ts": 1759999555.563541, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 8.66, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:55,565 INFO crypto-rebalancer: GET /api/users/sources -> 200 (11 ms)
INFO:     127.0.0.1:7516 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:45:55,567 INFO api.deps: Active user: jack
2025-10-09 10:45:55,568 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:45:55,571 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:45:55,571 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:45:55,577 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:45:55,578 INFO crypto-rebalancer: {"ts": 1759999555.5783272, "method": "GET", "path": "/config/users.json", "status": 200, "duration_ms": 26.57, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:55,578 INFO crypto-rebalancer: {"ts": 1759999555.5784972, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 15.12, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:55,578 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:45:55,578 INFO crypto-rebalancer: GET /config/users.json -> 200 (27 ms)
INFO:     127.0.0.1:4962 - "GET /config/users.json HTTP/1.1" 200 OK
INFO:     127.0.0.1:3231 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:45:55,579 INFO crypto-rebalancer: GET /balances/current -> 200 (16 ms)
2025-10-09 10:45:55,579 INFO crypto-rebalancer: {"ts": 1759999555.5793662, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 16.39, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:55,579 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (17 ms)
INFO:     127.0.0.1:3201 - "GET /api/alerts/active?severity_filter=S3 HTTP/1.1" 200 OK
2025-10-09 10:45:55,580 INFO crypto-rebalancer: {"ts": 1759999555.5803182, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 16.88, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:12354 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:45:55,581 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (17 ms)
2025-10-09 10:45:55,749 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:45:55,752 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:45:55,752 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:45:55,762 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:45:55,915 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:45:55,915 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:45:55,915 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:45:55,915 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:56,104 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:45:56,104 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:45:56,105 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:45:56,105 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:45:56,105 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:45:56,105 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:45:56,105 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:45:56,105 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:45:56,105 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:56,238 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:45:56,238 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:45:56,238 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:45:56,238 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:45:56,238 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:45:56,238 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:45:56,238 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:56,499 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:45:56,499 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:45:56,499 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:45:56,499 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:45:56,501 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:45:56,505 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:45:56,505 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:45:56,518 INFO crypto-rebalancer: {"ts": 1759999556.51815, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 770.12, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:56,519 INFO crypto-rebalancer: {"ts": 1759999556.5196626, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 771.15, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:56,519 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (771 ms)
INFO:     127.0.0.1:12354 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:45:56,520 INFO api.deps: Active user: jack
2025-10-09 10:45:56,520 INFO api.deps: Active user: jack
2025-10-09 10:45:56,520 INFO crypto-rebalancer: GET /balances/current -> 200 (771 ms)
INFO:     127.0.0.1:3201 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:45:56,521 INFO crypto-rebalancer: {"ts": 1759999556.5213783, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 3.39, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:56,525 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:45:56,528 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:45:56,528 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:45:56,530 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:45:56,754 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:45:56,754 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:45:56,754 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:56,754 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:56,861 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:45:56,861 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:45:56,861 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:45:56,861 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:45:56,861 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:45:56,861 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:45:56,861 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:45:56,861 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:56,862 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:56,985 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:45:56,985 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:45:56,985 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:45:56,985 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:45:56,985 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:45:56,985 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:56,986 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:57,255 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63146823786393
2025-10-09 10:45:57,255 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:45:57,255 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:45:57,256 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226790300213811, 'sharpe_v2': 1.6226790300213811, 'portfolio_structure_score': 82.63146823786393, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763573266090467, 'gri': 16.69217443552703, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.368531762136076, 'final_score': 82.63146823786393, 'inputs': {'hhi': 0.18513007540566773, 'memes_pct': 0.016908933165226167, 'gri': 3.3384348871054055, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:45:57,257 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (739 ms)
INFO:     127.0.0.1:3231 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:45:57,258 INFO crypto-rebalancer: {"ts": 1759999557.2582953, "method": "GET", "path": "/favicon.ico", "status": 200, "duration_ms": 738.3, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:57,258 INFO crypto-rebalancer: {"ts": 1759999557.2587082, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 740.67, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:57,259 INFO crypto-rebalancer: {"ts": 1759999557.2588995, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 740.83, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:57,259 INFO crypto-rebalancer: GET /favicon.ico -> 200 (739 ms)
INFO:     127.0.0.1:2208 - "GET /favicon.ico HTTP/1.1" 200 OK
2025-10-09 10:45:57,260 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=114s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:57,260 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:57,260 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:57,261 INFO crypto-rebalancer: GET /api/users/sources -> 200 (743 ms)
INFO:     127.0.0.1:4962 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:45:57,261 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (743 ms)
INFO:     127.0.0.1:7516 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90&risk_version=v2_shadow&use_dual_window=true HTTP/1.1" 200 OK
2025-10-09 10:45:57,263 INFO crypto-rebalancer: {"ts": 1759999557.2629888, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 4.59, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:57,263 INFO api.deps: Active user: jack
2025-10-09 10:45:57,263 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=114s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:57,264 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (7 ms)
INFO:     127.0.0.1:12354 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:45:57,265 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:45:57,268 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:45:57,268 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:45:57,273 INFO crypto-rebalancer: {"ts": 1759999557.2732537, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 10.53, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:57,274 INFO crypto-rebalancer: {"ts": 1759999557.274404, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 13.3, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:57,274 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (12 ms)
INFO:     127.0.0.1:3231 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:45:57,275 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=114s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:57,276 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:57,276 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
INFO:     127.0.0.1:3201 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:45:57,277 INFO crypto-rebalancer: GET /balances/current -> 200 (19 ms)
2025-10-09 10:45:57,279 INFO api.deps: Active user: jack
2025-10-09 10:45:57,280 INFO crypto-rebalancer: {"ts": 1759999557.2806232, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 6.49, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:57,283 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (10 ms)
INFO:     127.0.0.1:4962 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:45:57,284 INFO crypto-rebalancer: {"ts": 1759999557.284092, "method": "GET", "path": "/api/phase3/status", "status": 200, "duration_ms": 6.49, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:57,284 INFO crypto-rebalancer: GET /api/phase3/status -> 200 (9 ms)
INFO:     127.0.0.1:2208 - "GET /api/phase3/status?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:45:57,285 INFO crypto-rebalancer: {"ts": 1759999557.2850428, "method": "GET", "path": "/api/users/settings", "status": 200, "duration_ms": 10.83, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:57,285 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=114s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:57,286 INFO crypto-rebalancer: GET /api/users/settings -> 200 (12 ms)
INFO:     127.0.0.1:7516 - "GET /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:45:57,286 INFO crypto-rebalancer: {"ts": 1759999557.2868695, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 2.24, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:57,287 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (2 ms)
INFO:     127.0.0.1:3201 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:45:57,301 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=114s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:57,303 INFO crypto-rebalancer: {"ts": 1759999557.303453, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 3.11, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:57,305 INFO api.deps: Active user: jack
2025-10-09 10:45:57,305 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (4 ms)
INFO:     127.0.0.1:3201 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:45:57,306 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:45:57,309 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:45:57,309 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:45:57,311 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:45:57,613 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:45:57,613 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:45:57,613 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:57,613 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:57,790 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:45:57,790 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:45:57,790 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:45:57,790 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:45:57,790 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:45:57,790 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:45:57,790 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:45:57,790 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:57,791 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:57,919 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:45:57,919 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:45:57,919 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:45:57,919 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:45:57,919 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:45:57,919 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:57,920 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:58,210 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63146823786393
2025-10-09 10:45:58,210 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:45:58,210 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:45:58,211 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226790300213811, 'sharpe_v2': 1.6226790300213811, 'portfolio_structure_score': 82.63146823786393, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763573266090467, 'gri': 16.69217443552703, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.368531762136076, 'final_score': 82.63146823786393, 'inputs': {'hhi': 0.18513007540566773, 'memes_pct': 0.016908933165226167, 'gri': 3.3384348871054055, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:45:58,212 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=115s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:45:58,212 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:58,213 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:45:58,213 INFO crypto-rebalancer: {"ts": 1759999558.2137077, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 911.45, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:58,214 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (912 ms)
INFO:     127.0.0.1:7516 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90&risk_version=v2_shadow&use_dual_window=true HTTP/1.1" 200 OK
2025-10-09 10:45:58,214 INFO crypto-rebalancer: {"ts": 1759999558.2145417, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 2.53, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:58,214 INFO api.deps: Active user: jack
2025-10-09 10:45:58,214 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (908 ms)
INFO:     127.0.0.1:4962 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:45:58,216 INFO api.user_settings_endpoints: Settings saved for user jack: 17 keys
2025-10-09 10:45:58,216 INFO crypto-rebalancer: {"ts": 1759999558.2168024, "method": "PUT", "path": "/api/users/settings", "status": 200, "duration_ms": 913.44, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:58,217 INFO crypto-rebalancer: PUT /api/users/settings -> 200 (914 ms)
INFO:     127.0.0.1:2208 - "PUT /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:45:58,219 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:45:58,219 INFO api.deps: Active user: jack
2025-10-09 10:45:58,220 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:45:58,223 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:45:58,223 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:45:58,224 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:45:58,449 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:45:58,449 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:45:58,449 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:58,449 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:58,597 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:45:58,597 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:45:58,598 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:45:58,598 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:45:58,598 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:45:58,598 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:45:58,598 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:45:58,598 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:58,598 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:58,760 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:45:58,761 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:45:58,761 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:45:58,761 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:45:58,761 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:45:58,761 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:45:58,761 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:45:59,038 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63146823786393
2025-10-09 10:45:59,038 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:45:59,038 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:45:59,038 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226790300213811, 'sharpe_v2': 1.6226790300213811, 'portfolio_structure_score': 82.63146823786393, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763573266090467, 'gri': 16.69217443552703, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.368531762136076, 'final_score': 82.63146823786393, 'inputs': {'hhi': 0.18513007540566773, 'memes_pct': 0.016908933165226167, 'gri': 3.3384348871054055, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:45:59,039 INFO crypto-rebalancer: {"ts": 1759999559.0396523, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 822.88, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:59,039 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (823 ms)
INFO:     127.0.0.1:7516 - "GET /api/alerts/active?include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:45:59,040 INFO crypto-rebalancer: {"ts": 1759999559.0402124, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 821.43, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:45:59,040 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (821 ms)
INFO:     127.0.0.1:4962 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90&risk_version=v2_shadow&use_dual_window=true HTTP/1.1" 200 OK
2025-10-09 10:46:01,758 INFO services.streaming.realtime_engine: WebSocket disconnected: nav_badge, remaining: 0
INFO:     connection closed
2025-10-09 10:46:01,779 INFO crypto-rebalancer: {"ts": 1759999561.7789376, "method": "GET", "path": "/static/rebalance.html", "status": 200, "duration_ms": 7.12, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:01,779 INFO crypto-rebalancer: GET /static/rebalance.html -> 200 (7 ms)
INFO:     127.0.0.1:4962 - "GET /static/rebalance.html HTTP/1.1" 200 OK
2025-10-09 10:46:01,843 INFO crypto-rebalancer: {"ts": 1759999561.8435233, "method": "GET", "path": "/.well-known/appspecific/com.chrome.devtools.json", "status": 404, "duration_ms": 1.01, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:4962 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
2025-10-09 10:46:01,843 INFO crypto-rebalancer: GET /.well-known/appspecific/com.chrome.devtools.json -> 404 (1 ms)
2025-10-09 10:46:01,931 INFO crypto-rebalancer: {"ts": 1759999561.931031, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.02, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:01,931 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:4962 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:46:01,936 INFO crypto-rebalancer: {"ts": 1759999561.9369423, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.47, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:01,937 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:4962 - "GET /taxonomy HTTP/1.1" 200 OK
INFO:     ('127.0.0.1', 7318) - "WebSocket /api/realtime/ws?client_id=nav_badge" [accepted]
2025-10-09 10:46:01,945 INFO services.streaming.realtime_engine: WebSocket connected: nav_badge, total connections: 1
INFO:     connection open
2025-10-09 10:46:01,947 INFO crypto-rebalancer: {"ts": 1759999561.9470003, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 4.01, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:01,947 INFO api.crypto_toolbox_endpoints: \U0001f504 Scraping fresh data...
2025-10-09 10:46:01,947 WARNING api.crypto_toolbox_endpoints: \u26a0\ufe0f Browser not connected, re-launching...
2025-10-09 10:46:01,947 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:46:01,948 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=118s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:01,948 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:46:01,949 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:46:01,950 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (7 ms)
INFO:     127.0.0.1:4962 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:46:01,950 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-411' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:46:01,953 INFO api.deps: Active user: jack
2025-10-09 10:46:01,953 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:46:01,953 ERROR api.crypto_toolbox_endpoints: \u274c Crypto-toolbox scraping error
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 377, in get_crypto_toolbox_data
    return await _get_data(force=force)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 345, in _get_data
    data = await _scrape_crypto_toolbox()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 219, in _scrape_crypto_toolbox
    browser = await _ensure_browser()
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 166, in _ensure_browser
    await startup_playwright()
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 109, in startup_playwright
    _playwright_instance = await async_playwright().start()
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 51, in start
    return await self.__aenter__()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 46, in __aenter__
    playwright = AsyncPlaywright(next(iter(done)).result())
                                 ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:46:01,955 INFO crypto-rebalancer: {"ts": 1759999561.9552355, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 8.3, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:01,955 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:46:01,958 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:46:01,958 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:46:01,959 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:46:02,262 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:46:02,262 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:46:02,262 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:46:02,263 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:02,421 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:46:02,421 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:46:02,421 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:46:02,421 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:46:02,421 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:46:02,421 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:46:02,421 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:46:02,421 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:46:02,421 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:02,615 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:46:02,615 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:46:02,615 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:46:02,615 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:46:02,615 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:46:02,615 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:46:02,615 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:02,961 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63146823786393
2025-10-09 10:46:02,961 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:46:02,961 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:46:02,961 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226790300213811, 'sharpe_v2': 1.6226790300213811, 'portfolio_structure_score': 82.63146823786393, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763573266090467, 'gri': 16.69217443552703, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.368531762136076, 'final_score': 82.63146823786393, 'inputs': {'hhi': 0.18513007540566773, 'memes_pct': 0.016908933165226167, 'gri': 3.3384348871054055, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:46:02,963 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (1016 ms)
INFO:     127.0.0.1:12354 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:46:02,963 INFO crypto-rebalancer: {"ts": 1759999562.963474, "method": "GET", "path": "/api/crypto-toolbox", "status": 502, "duration_ms": 1016.61, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:02,964 INFO crypto-rebalancer: {"ts": 1759999562.964545, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 1017.58, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:02,965 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:46:02,965 INFO crypto-rebalancer: GET /api/crypto-toolbox -> 502 (1019 ms)
INFO:     127.0.0.1:2208 - "GET /api/crypto-toolbox HTTP/1.1" 502 Bad Gateway
2025-10-09 10:46:02,966 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (1019 ms)
INFO:     127.0.0.1:3231 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:46:02,967 INFO api.deps: Active user: jack
2025-10-09 10:46:02,967 INFO crypto-rebalancer: {"ts": 1759999562.9678364, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 1020.93, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:02,971 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (1024 ms)
INFO:     127.0.0.1:3201 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:46:02,972 INFO crypto-rebalancer: {"ts": 1759999562.9724517, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 9.02, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:02,973 INFO crypto-rebalancer: {"ts": 1759999562.9732332, "method": "GET", "path": "/api/strategies/list", "status": 200, "duration_ms": 5.64, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:02,973 INFO crypto-rebalancer: {"ts": 1759999562.9733822, "method": "GET", "path": "/config/users.json", "status": 200, "duration_ms": 1029.85, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:02,974 INFO crypto-rebalancer: GET /api/users/sources -> 200 (11 ms)
INFO:     127.0.0.1:4962 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:46:02,975 INFO crypto-rebalancer: GET /api/strategies/list -> 200 (7 ms)
INFO:     127.0.0.1:12354 - "GET /api/strategies/list?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:46:02,975 INFO crypto-rebalancer: GET /config/users.json -> 200 (1032 ms)
INFO:     127.0.0.1:7516 - "GET /config/users.json HTTP/1.1" 200 OK
2025-10-09 10:46:02,976 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:46:02,979 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:46:02,979 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:46:02,991 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:46:03,126 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:46:03,126 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:46:03,126 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:03,126 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:03,309 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:46:03,309 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:46:03,309 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:46:03,309 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:46:03,309 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:46:03,309 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:46:03,309 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:46:03,309 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:03,309 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:03,423 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:46:03,423 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:46:03,423 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:46:03,423 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:46:03,423 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:46:03,423 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:03,424 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:03,701 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:46:03,701 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:46:03,701 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:46:03,702 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:46:03,703 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:46:03,705 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:46:03,705 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:46:03,717 INFO crypto-rebalancer: {"ts": 1759999563.7171304, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 744.94, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:03,717 INFO crypto-rebalancer: {"ts": 1759999563.7173588, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 745.03, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:03,718 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (747 ms)
INFO:     127.0.0.1:2208 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:46:03,719 INFO crypto-rebalancer: GET /balances/current -> 200 (747 ms)
INFO:     127.0.0.1:3231 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:46:03,719 INFO api.deps: Active user: jack
2025-10-09 10:46:03,719 INFO crypto-rebalancer: {"ts": 1759999563.7198477, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 2.97, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:03,720 INFO crypto-rebalancer: {"ts": 1759999563.7200212, "method": "GET", "path": "/favicon.ico", "status": 200, "duration_ms": 3.01, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:03,720 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:46:03,722 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:46:03,722 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:46:03,724 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (8 ms)
INFO:     127.0.0.1:4962 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:46:03,725 INFO crypto-rebalancer: GET /favicon.ico -> 200 (8 ms)
INFO:     127.0.0.1:12354 - "GET /favicon.ico HTTP/1.1" 200 OK
2025-10-09 10:46:03,726 INFO crypto-rebalancer: {"ts": 1759999563.7259753, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 8.89, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:03,726 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=120s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:03,726 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:46:03,726 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:46:03,727 INFO crypto-rebalancer: GET /balances/current -> 200 (11 ms)
INFO:     127.0.0.1:7516 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:46:03,728 INFO crypto-rebalancer: {"ts": 1759999563.7285242, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 2.99, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:03,728 INFO crypto-rebalancer: {"ts": 1759999563.728755, "method": "GET", "path": "/api/strategies/list", "status": 200, "duration_ms": 2.91, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:03,729 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=120s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:03,729 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (4 ms)
INFO:     127.0.0.1:2208 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:46:03,730 INFO crypto-rebalancer: GET /api/strategies/list -> 200 (4 ms)
INFO:     127.0.0.1:3231 - "GET /api/strategies/list?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:46:03,730 INFO api.deps: Active user: jack
2025-10-09 10:46:03,730 INFO crypto-rebalancer: {"ts": 1759999563.7306466, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 2.2, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:03,732 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (4 ms)
INFO:     127.0.0.1:12354 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:46:03,733 INFO crypto-rebalancer: {"ts": 1759999563.7330844, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 4.69, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:03,733 INFO crypto-rebalancer: GET /api/users/sources -> 200 (5 ms)
INFO:     127.0.0.1:4962 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:46:03,735 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=120s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:03,735 INFO crypto-rebalancer: {"ts": 1759999563.7357173, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 0.61, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:03,735 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (0 ms)
INFO:     127.0.0.1:4962 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:46:03,740 INFO api.deps: Active user: jack
2025-10-09 10:46:03,742 INFO crypto-rebalancer: {"ts": 1759999563.742419, "method": "GET", "path": "/api/users/settings", "status": 200, "duration_ms": 2.48, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:03,742 INFO crypto-rebalancer: GET /api/users/settings -> 200 (2 ms)
INFO:     127.0.0.1:4962 - "GET /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:46:03,747 INFO api.deps: Active user: jack
2025-10-09 10:46:03,748 INFO api.user_settings_endpoints: Settings saved for user jack: 17 keys
2025-10-09 10:46:03,749 INFO crypto-rebalancer: {"ts": 1759999563.7491333, "method": "PUT", "path": "/api/users/settings", "status": 200, "duration_ms": 2.92, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:03,749 INFO crypto-rebalancer: PUT /api/users/settings -> 200 (3 ms)
INFO:     127.0.0.1:4962 - "PUT /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:46:03,751 INFO crypto-rebalancer: {"ts": 1759999563.7512379, "method": "GET", "path": "/data/raw/CoinTracking - Coins by Exchange - 26.08.2025.csv", "status": 200, "duration_ms": 774.85, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:03,751 INFO crypto-rebalancer: GET /data/raw/CoinTracking - Coins by Exchange - 26.08.2025.csv -> 200 (775 ms)
INFO:     127.0.0.1:3201 - "GET /data/raw/CoinTracking%20-%20Coins%20by%20Exchange%20-%2026.08.2025.csv HTTP/1.1" 200 OK
2025-10-09 10:46:05,349 INFO services.streaming.realtime_engine: WebSocket disconnected: nav_badge, remaining: 0
INFO:     connection closed
2025-10-09 10:46:05,366 INFO crypto-rebalancer: {"ts": 1759999565.3662634, "method": "GET", "path": "/static/execution.html", "status": 200, "duration_ms": 5.13, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:05,366 INFO crypto-rebalancer: GET /static/execution.html -> 200 (5 ms)
INFO:     127.0.0.1:3201 - "GET /static/execution.html HTTP/1.1" 200 OK
2025-10-09 10:46:05,432 INFO crypto-rebalancer: {"ts": 1759999565.432337, "method": "GET", "path": "/.well-known/appspecific/com.chrome.devtools.json", "status": 404, "duration_ms": 1.7, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:05,432 INFO crypto-rebalancer: GET /.well-known/appspecific/com.chrome.devtools.json -> 404 (2 ms)
INFO:     127.0.0.1:3201 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
2025-10-09 10:46:05,503 INFO crypto-rebalancer: {"ts": 1759999565.5029888, "method": "GET", "path": "/api/execution/history/sessions", "status": 200, "duration_ms": 1.61, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:05,504 INFO crypto-rebalancer: GET /api/execution/history/sessions -> 200 (3 ms)
INFO:     127.0.0.1:3201 - "GET /api/execution/history/sessions?source=cointracking_api&pricing=local&min_usd=1&limit=20 HTTP/1.1" 200 OK
2025-10-09 10:46:05,505 INFO crypto-rebalancer: {"ts": 1759999565.5058951, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 3.02, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     ('127.0.0.1', 9469) - "WebSocket /api/realtime/ws?client_id=nav_badge" [accepted]
2025-10-09 10:46:05,506 INFO services.streaming.realtime_engine: WebSocket connected: nav_badge, total connections: 1
INFO:     connection open
2025-10-09 10:46:05,507 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (4 ms)
INFO:     127.0.0.1:4962 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:46:05,509 INFO crypto-rebalancer: {"ts": 1759999565.509173, "method": "GET", "path": "/config/users.json", "status": 200, "duration_ms": 6.24, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:05,509 INFO crypto-rebalancer: GET /config/users.json -> 200 (6 ms)
INFO:     127.0.0.1:12354 - "GET /config/users.json HTTP/1.1" 200 OK
2025-10-09 10:46:05,515 INFO api.deps: Active user: jack
2025-10-09 10:46:05,522 INFO crypto-rebalancer: {"ts": 1759999565.5225437, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 8.83, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:05,526 INFO api.crypto_toolbox_endpoints: \U0001f504 Scraping fresh data...
2025-10-09 10:46:05,526 WARNING api.crypto_toolbox_endpoints: \u26a0\ufe0f Browser not connected, re-launching...
2025-10-09 10:46:05,527 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:46:05,527 INFO crypto-rebalancer: GET /api/users/sources -> 200 (13 ms)
INFO:     127.0.0.1:12354 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:46:05,528 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-446' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:46:05,532 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=122s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:05,532 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:46:05,532 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:46:05,533 INFO api.deps: Active user: jack
2025-10-09 10:46:05,533 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:46:05,533 ERROR api.crypto_toolbox_endpoints: \u274c Crypto-toolbox scraping error
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 377, in get_crypto_toolbox_data
    return await _get_data(force=force)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 345, in _get_data
    data = await _scrape_crypto_toolbox()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 219, in _scrape_crypto_toolbox
    browser = await _ensure_browser()
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 166, in _ensure_browser
    await startup_playwright()
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 109, in startup_playwright
    _playwright_instance = await async_playwright().start()
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 51, in start
    return await self.__aenter__()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 46, in __aenter__
    playwright = AsyncPlaywright(next(iter(done)).result())
                                 ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:46:05,538 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:46:05,541 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:46:05,541 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:46:05,542 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:46:05,866 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:46:05,866 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:46:05,866 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:46:05,867 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:06,030 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:46:06,030 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:46:06,030 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:46:06,030 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:46:06,031 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:46:06,031 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:46:06,031 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:46:06,031 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:46:06,031 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:06,189 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:46:06,189 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:46:06,189 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:46:06,189 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:46:06,189 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:46:06,189 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:46:06,189 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:06,494 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63146823786393
2025-10-09 10:46:06,494 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:46:06,494 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:46:06,494 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226790300213811, 'sharpe_v2': 1.6226790300213811, 'portfolio_structure_score': 82.63146823786393, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763573266090467, 'gri': 16.69217443552703, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.368531762136076, 'final_score': 82.63146823786393, 'inputs': {'hhi': 0.18513007540566773, 'memes_pct': 0.016908933165226167, 'gri': 3.3384348871054055, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:46:06,496 INFO crypto-rebalancer: {"ts": 1759999566.496515, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 973.28, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:06,497 INFO crypto-rebalancer: {"ts": 1759999566.4973092, "method": "GET", "path": "/api/crypto-toolbox", "status": 502, "duration_ms": 975.01, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:06,497 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (974 ms)
INFO:     127.0.0.1:2208 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:46:06,498 INFO crypto-rebalancer: {"ts": 1759999566.4981766, "method": "GET", "path": "/execution/exchanges", "status": 200, "duration_ms": 964.87, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:06,498 INFO crypto-rebalancer: {"ts": 1759999566.498915, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 976.89, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:06,499 INFO crypto-rebalancer: GET /api/crypto-toolbox -> 502 (977 ms)
INFO:     127.0.0.1:4962 - "GET /api/crypto-toolbox HTTP/1.1" 502 Bad Gateway
2025-10-09 10:46:06,499 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:46:06,500 INFO crypto-rebalancer: GET /execution/exchanges -> 200 (966 ms)
INFO:     127.0.0.1:7516 - "GET /execution/exchanges?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:46:06,500 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (978 ms)
INFO:     127.0.0.1:3231 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:46:06,501 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:46:06,504 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:46:06,504 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:46:06,513 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:46:06,652 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:46:06,652 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:46:06,652 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:06,652 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:06,777 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:46:06,777 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:46:06,777 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:46:06,777 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:46:06,777 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:46:06,777 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:46:06,777 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:46:06,777 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:06,777 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:06,947 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:46:06,947 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:46:06,947 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:46:06,947 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:46:06,947 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:46:06,947 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:06,947 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:07,224 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:46:07,224 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:46:07,225 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:46:07,225 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:46:07,226 INFO crypto-rebalancer: {"ts": 1759999567.2266755, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 1704.52, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:07,227 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (1705 ms)
INFO:     127.0.0.1:3201 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:46:07,228 INFO crypto-rebalancer: {"ts": 1759999567.228575, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 731.4, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:07,230 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (733 ms)
INFO:     127.0.0.1:12354 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:46:07,231 INFO api.deps: Active user: jack
2025-10-09 10:46:07,231 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:46:07,233 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:46:07,233 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:46:07,241 INFO crypto-rebalancer: {"ts": 1759999567.2416115, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 13.47, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:07,244 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (16 ms)
INFO:     127.0.0.1:4962 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:46:07,244 INFO crypto-rebalancer: {"ts": 1759999567.2445707, "method": "GET", "path": "/favicon.ico", "status": 200, "duration_ms": 14.9, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:07,244 INFO crypto-rebalancer: {"ts": 1759999567.2448127, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 17.87, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:07,244 INFO crypto-rebalancer: GET /favicon.ico -> 200 (16 ms)
INFO:     127.0.0.1:3231 - "GET /favicon.ico HTTP/1.1" 200 OK
2025-10-09 10:46:07,245 INFO crypto-rebalancer: {"ts": 1759999567.2453942, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 16.92, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:07,245 INFO crypto-rebalancer: GET /balances/current -> 200 (744 ms)
INFO:     127.0.0.1:2208 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:46:07,245 INFO crypto-rebalancer: {"ts": 1759999567.245679, "method": "GET", "path": "/execution/exchanges", "status": 200, "duration_ms": 4.14, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:07,245 INFO crypto-rebalancer: GET /api/users/sources -> 200 (17 ms)
INFO:     127.0.0.1:7516 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:46:07,246 INFO crypto-rebalancer: GET /execution/exchanges -> 200 (14 ms)
INFO:     127.0.0.1:3201 - "GET /execution/exchanges?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:46:07,252 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=124s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:07,252 INFO api.deps: Active user: jack
2025-10-09 10:46:07,253 INFO crypto-rebalancer: {"ts": 1759999567.2529953, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 1.24, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:07,254 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (2 ms)
INFO:     127.0.0.1:7516 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:46:07,254 INFO crypto-rebalancer: {"ts": 1759999567.2546322, "method": "GET", "path": "/api/users/settings", "status": 200, "duration_ms": 2.98, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:07,254 INFO crypto-rebalancer: GET /api/users/settings -> 200 (3 ms)
INFO:     127.0.0.1:3201 - "GET /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:46:07,261 INFO api.deps: Active user: jack
2025-10-09 10:46:07,262 INFO api.user_settings_endpoints: Settings saved for user jack: 17 keys
2025-10-09 10:46:07,262 INFO crypto-rebalancer: {"ts": 1759999567.2625062, "method": "PUT", "path": "/api/users/settings", "status": 200, "duration_ms": 2.75, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:07,262 INFO crypto-rebalancer: PUT /api/users/settings -> 200 (2 ms)
INFO:     127.0.0.1:3201 - "PUT /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:46:09,070 INFO services.streaming.realtime_engine: WebSocket disconnected: nav_badge, remaining: 0
INFO:     connection closed
2025-10-09 10:46:09,084 INFO crypto-rebalancer: {"ts": 1759999569.0842822, "method": "GET", "path": "/static/analytics-unified.html", "status": 304, "duration_ms": 1.7, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:09,084 INFO crypto-rebalancer: GET /static/analytics-unified.html -> 304 (2 ms)
INFO:     127.0.0.1:3201 - "GET /static/analytics-unified.html HTTP/1.1" 304 Not Modified
2025-10-09 10:46:09,150 INFO crypto-rebalancer: {"ts": 1759999569.150834, "method": "GET", "path": "/.well-known/appspecific/com.chrome.devtools.json", "status": 404, "duration_ms": 0.97, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:09,151 INFO crypto-rebalancer: GET /.well-known/appspecific/com.chrome.devtools.json -> 404 (1 ms)
INFO:     127.0.0.1:3201 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
INFO:     ('127.0.0.1', 4937) - "WebSocket /api/realtime/ws?client_id=nav_badge" [accepted]
2025-10-09 10:46:09,227 INFO services.streaming.realtime_engine: WebSocket connected: nav_badge, total connections: 1
INFO:     connection open
2025-10-09 10:46:09,230 INFO crypto-rebalancer: {"ts": 1759999569.2301059, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 3.0, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:09,230 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (3 ms)
INFO:     127.0.0.1:7516 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:46:09,233 INFO crypto-rebalancer: {"ts": 1759999569.2336457, "method": "GET", "path": "/config/users.json", "status": 200, "duration_ms": 7.01, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:09,233 INFO crypto-rebalancer: GET /config/users.json -> 200 (7 ms)
INFO:     127.0.0.1:3201 - "GET /config/users.json HTTP/1.1" 200 OK
2025-10-09 10:46:09,235 INFO api.deps: Active user: jack
2025-10-09 10:46:09,240 INFO crypto-rebalancer: {"ts": 1759999569.2406743, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 6.25, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:09,241 INFO api.crypto_toolbox_endpoints: \U0001f504 Scraping fresh data...
2025-10-09 10:46:09,242 WARNING api.crypto_toolbox_endpoints: \u26a0\ufe0f Browser not connected, re-launching...
2025-10-09 10:46:09,242 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:46:09,242 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=126s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:09,243 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:46:09,243 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
INFO:     127.0.0.1:7516 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:46:09,244 INFO crypto-rebalancer: GET /api/users/sources -> 200 (10 ms)
2025-10-09 10:46:09,244 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-475' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:46:09,247 INFO api.deps: Active user: jack
2025-10-09 10:46:09,247 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:46:09,247 ERROR api.crypto_toolbox_endpoints: \u274c Crypto-toolbox scraping error
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 377, in get_crypto_toolbox_data
    return await _get_data(force=force)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 345, in _get_data
    data = await _scrape_crypto_toolbox()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 219, in _scrape_crypto_toolbox
    browser = await _ensure_browser()
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 166, in _ensure_browser
    await startup_playwright()
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 109, in startup_playwright
    _playwright_instance = await async_playwright().start()
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 51, in start
    return await self.__aenter__()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 46, in __aenter__
    playwright = AsyncPlaywright(next(iter(done)).result())
                                 ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:46:09,250 INFO crypto-rebalancer: {"ts": 1759999569.2503881, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 9.77, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:09,251 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:46:09,254 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:46:09,254 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:46:09,255 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:46:09,466 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:46:09,466 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:46:09,466 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:46:09,466 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:09,575 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:46:09,575 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:46:09,575 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:46:09,575 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:46:09,575 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:46:09,575 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:46:09,575 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:46:09,575 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:46:09,575 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:09,727 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:46:09,727 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:46:09,728 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:46:09,728 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:46:09,728 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:46:09,728 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:46:09,728 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:10,019 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63146823786393
2025-10-09 10:46:10,020 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:46:10,020 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:46:10,020 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226790300213811, 'sharpe_v2': 1.6226790300213811, 'portfolio_structure_score': 82.63146823786393, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763573266090467, 'gri': 16.69217443552703, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.368531762136076, 'final_score': 82.63146823786393, 'inputs': {'hhi': 0.18513007540566773, 'memes_pct': 0.016908933165226167, 'gri': 3.3384348871054055, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:46:10,022 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (782 ms)
INFO:     127.0.0.1:4962 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:46:10,023 INFO crypto-rebalancer: {"ts": 1759999570.0237906, "method": "GET", "path": "/api/crypto-toolbox", "status": 502, "duration_ms": 783.2, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:10,024 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:46:10,024 INFO crypto-rebalancer: {"ts": 1759999570.024433, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 783.79, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:10,024 INFO crypto-rebalancer: GET /api/crypto-toolbox -> 502 (784 ms)
INFO:     127.0.0.1:3201 - "GET /api/crypto-toolbox HTTP/1.1" 502 Bad Gateway
2025-10-09 10:46:10,025 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:46:10,026 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:46:10,026 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:46:10,035 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 365 days
2025-10-09 10:46:10,258 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:46:10,258 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:46:10,259 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:46:10,259 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:10,431 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 85.0
2025-10-09 10:46:10,431 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:46:10,431 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:46:10,431 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:46:10,431 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:46:10,431 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:46:10,431 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:46:10,431 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:46:10,431 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:10,577 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:46:10,577 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=85.0, penalties=0.0, final=85.0
2025-10-09 10:46:10,577 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:46:10,577 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:46:10,577 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:46:10,577 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:46:10,578 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:10,854 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:46:10,854 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.33, Vol=0.20, MaxDD=-10.64%, RiskScore=85.0, RiskStructural=47.0 [Dual-Window: FI fallback only]
2025-10-09 10:46:10,854 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:46:10,854 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 85.0, 'risk_score_v2': 85.0, 'sharpe_legacy': 1.3262890739554856, 'sharpe_v2': 1.3262890739554856, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 47.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 5.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:46:10,856 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (1615 ms)
INFO:     127.0.0.1:3231 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:46:10,857 INFO crypto-rebalancer: {"ts": 1759999570.857204, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 1616.65, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:10,857 INFO crypto-rebalancer: {"ts": 1759999570.857749, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 1607.61, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:10,857 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (1617 ms)
INFO:     127.0.0.1:2208 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:46:10,858 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (1611 ms)
INFO:     127.0.0.1:12354 - "GET /api/risk/dashboard?min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:46:10,859 INFO crypto-rebalancer: {"ts": 1759999570.8598716, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 835.84, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:10,860 INFO crypto-rebalancer: GET /taxonomy -> 200 (836 ms)
INFO:     127.0.0.1:7516 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:46:10,867 INFO crypto-rebalancer: {"ts": 1759999570.8672564, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.28, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:10,867 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:7516 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:46:11,040 INFO crypto-rebalancer: {"ts": 1759999571.0407178, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 1.81, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:11,041 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:46:11,044 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:46:11,044 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:46:11,058 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:46:11,061 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:46:11,061 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:46:11,071 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:46:11,195 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:46:11,195 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:46:11,195 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:11,195 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:11,373 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:46:11,373 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:46:11,373 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:46:11,374 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:46:11,374 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:46:11,374 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:46:11,374 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:46:11,374 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:11,374 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:11,663 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:46:11,663 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:46:11,663 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:46:11,664 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:46:11,664 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:46:11,664 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:11,664 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:11,951 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:46:11,951 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:46:11,951 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:46:11,951 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:46:11,953 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (915 ms)
INFO:     127.0.0.1:2208 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:46:11,954 INFO crypto-rebalancer: {"ts": 1759999571.9542518, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 915.27, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:11,954 INFO crypto-rebalancer: {"ts": 1759999571.9547243, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 916.95, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:11,968 INFO crypto-rebalancer: GET /balances/current -> 200 (929 ms)
INFO:     127.0.0.1:12354 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:46:11,969 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=128s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:11,970 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (932 ms)
INFO:     127.0.0.1:7516 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:46:11,971 INFO crypto-rebalancer: {"ts": 1759999571.9711382, "method": "GET", "path": "/api/ml/debug/pipeline-info", "status": 200, "duration_ms": 17.07, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:11,971 INFO crypto-rebalancer: {"ts": 1759999571.9714012, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 16.79, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:11,971 INFO crypto-rebalancer: GET /api/ml/debug/pipeline-info -> 200 (18 ms)
INFO:     127.0.0.1:3231 - "GET /api/ml/debug/pipeline-info HTTP/1.1" 200 OK
2025-10-09 10:46:11,972 INFO api.deps: Active user: jack
2025-10-09 10:46:11,972 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (18 ms)
INFO:     127.0.0.1:3201 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:46:11,977 INFO crypto-rebalancer: {"ts": 1759999571.977317, "method": "GET", "path": "/favicon.ico", "status": 200, "duration_ms": 6.42, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:11,978 INFO crypto-rebalancer: GET /favicon.ico -> 200 (7 ms)
INFO:     127.0.0.1:2208 - "GET /favicon.ico HTTP/1.1" 200 OK
2025-10-09 10:46:11,978 INFO crypto-rebalancer: {"ts": 1759999571.9787164, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 24.24, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:11,978 INFO api.deps: Active user: jack
2025-10-09 10:46:11,979 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=128s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:11,979 INFO crypto-rebalancer: GET /api/users/sources -> 200 (25 ms)
INFO:     127.0.0.1:4962 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:46:11,980 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:46:11,981 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:46:11,981 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:46:11,986 INFO crypto-rebalancer: {"ts": 1759999571.986775, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 8.15, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:11,987 INFO crypto-rebalancer: {"ts": 1759999571.9878807, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 14.82, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:11,988 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (9 ms)
INFO:     127.0.0.1:7516 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:46:11,989 INFO crypto-rebalancer: GET /balances/current -> 200 (16 ms)
INFO:     127.0.0.1:12354 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:46:11,989 INFO crypto-rebalancer: {"ts": 1759999571.989943, "method": "GET", "path": "/api/ml/volatility/predict/BTC", "status": 200, "duration_ms": 3.33, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:11,990 INFO crypto-rebalancer: GET /api/ml/volatility/predict/BTC -> 200 (4 ms)
INFO:     127.0.0.1:3201 - "GET /api/ml/volatility/predict/BTC?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:46:11,992 INFO api.deps: Active user: jack
2025-10-09 10:46:11,996 INFO crypto-rebalancer: {"ts": 1759999571.996823, "method": "GET", "path": "/api/users/settings", "status": 200, "duration_ms": 6.64, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:4962 - "GET /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:46:11,997 INFO crypto-rebalancer: GET /api/users/settings -> 200 (7 ms)
2025-10-09 10:46:12,000 INFO crypto-rebalancer: {"ts": 1759999572.000675, "method": "GET", "path": "/api/ml/volatility/predict/ETH", "status": 200, "duration_ms": 1.16, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,000 INFO crypto-rebalancer: GET /api/ml/volatility/predict/ETH -> 200 (1 ms)
INFO:     127.0.0.1:4962 - "GET /api/ml/volatility/predict/ETH?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:46:12,014 INFO api.deps: Active user: jack
2025-10-09 10:46:12,208 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:46:12,210 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:46:12,210 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:46:12,214 INFO crypto-rebalancer: {"ts": 1759999572.214949, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 203.17, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,215 INFO crypto-rebalancer: GET /balances/current -> 200 (203 ms)
INFO:     127.0.0.1:4962 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:46:12,216 INFO api.deps: Active user: jack
2025-10-09 10:46:12,218 INFO api.user_settings_endpoints: Settings saved for user jack: 17 keys
2025-10-09 10:46:12,219 INFO crypto-rebalancer: {"ts": 1759999572.2195704, "method": "PUT", "path": "/api/users/settings", "status": 200, "duration_ms": 207.56, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,221 INFO crypto-rebalancer: PUT /api/users/settings -> 200 (209 ms)
INFO:     127.0.0.1:3201 - "PUT /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:46:12,221 INFO crypto-rebalancer: {"ts": 1759999572.221866, "method": "GET", "path": "/api/config/data-source", "status": 200, "duration_ms": 2.45, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:46:12,222 INFO crypto-rebalancer: GET /api/config/data-source -> 200 (2 ms)
INFO:     127.0.0.1:12814 - "GET /api/config/data-source HTTP/1.1" 200 OK
2025-10-09 10:46:12,223 INFO httpx: HTTP Request: GET http://127.0.0.1:8000/api/config/data-source "HTTP/1.1 200 OK"
2025-10-09 10:46:12,224 INFO services.ml.orchestrator: Using data source from config API: cointracking
2025-10-09 10:46:12,224 INFO crypto-rebalancer: {"ts": 1759999572.2248156, "method": "GET", "path": "/api/ml/regime/current", "status": 200, "duration_ms": 212.26, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,225 INFO crypto-rebalancer: GET /api/ml/regime/current -> 200 (213 ms)
INFO:     127.0.0.1:12354 - "GET /api/ml/regime/current HTTP/1.1" 200 OK
2025-10-09 10:46:12,232 INFO crypto-rebalancer: {"ts": 1759999572.23211, "method": "GET", "path": "/api/ml/sentiment/fear-greed", "status": 200, "duration_ms": 1.03, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,232 INFO crypto-rebalancer: GET /api/ml/sentiment/fear-greed -> 200 (1 ms)
INFO:     127.0.0.1:12354 - "GET /api/ml/sentiment/fear-greed?days=1 HTTP/1.1" 200 OK
2025-10-09 10:46:12,503 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=129s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:12,503 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:46:12,503 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:46:12,504 INFO crypto-rebalancer: {"ts": 1759999572.5041964, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 1.34, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,504 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (1 ms)
INFO:     127.0.0.1:12354 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:46:12,512 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=129s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:12,512 INFO crypto-rebalancer: {"ts": 1759999572.5129535, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 1.28, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,513 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (1 ms)
INFO:     127.0.0.1:12354 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:46:12,520 INFO crypto-rebalancer: {"ts": 1759999572.5201538, "method": "GET", "path": "/static/components/UnifiedInsights.js", "status": 200, "duration_ms": 7.6, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,520 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=129s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:12,520 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:46:12,520 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:46:12,521 INFO crypto-rebalancer: GET /static/components/UnifiedInsights.js -> 200 (9 ms)
INFO:     127.0.0.1:3201 - "GET /static/components/UnifiedInsights.js?v=2025-10-09T08:46:12.510Z HTTP/1.1" 200 OK
2025-10-09 10:46:12,521 INFO crypto-rebalancer: {"ts": 1759999572.5216618, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 1.54, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,521 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (1 ms)
INFO:     127.0.0.1:12354 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:46:12,527 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=129s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:12,527 INFO crypto-rebalancer: {"ts": 1759999572.5277865, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 0.6, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,527 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (0 ms)
INFO:     127.0.0.1:3201 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:46:12,533 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=129s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:12,534 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:46:12,534 INFO crypto-rebalancer: {"ts": 1759999572.5345604, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.56, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,534 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:3201 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:46:12,537 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:46:12,538 INFO crypto-rebalancer: {"ts": 1759999572.5382159, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 1.96, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,538 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (2 ms)
INFO:     127.0.0.1:12354 - "GET /api/alerts/active?include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:46:12,544 INFO api.deps: Active user: jack
2025-10-09 10:46:12,545 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:46:12,549 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:46:12,549 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:46:12,553 INFO crypto-rebalancer: {"ts": 1759999572.553659, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 9.41, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,553 INFO crypto-rebalancer: GET /balances/current -> 200 (9 ms)
INFO:     127.0.0.1:12354 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:46:12,578 INFO crypto-rebalancer: {"ts": 1759999572.5786822, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.16, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,578 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:12354 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:46:12,590 INFO crypto-rebalancer: {"ts": 1759999572.5901148, "method": "GET", "path": "/static/components/decision-index-panel.js", "status": 200, "duration_ms": 4.45, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,590 INFO crypto-rebalancer: GET /static/components/decision-index-panel.js -> 200 (4 ms)
INFO:     127.0.0.1:12354 - "GET /static/components/decision-index-panel.js?v=1759999572583 HTTP/1.1" 200 OK
2025-10-09 10:46:12,601 INFO crypto-rebalancer: {"ts": 1759999572.6018808, "method": "GET", "path": "/static/core/unified-insights-v2.js", "status": 200, "duration_ms": 6.55, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,602 INFO crypto-rebalancer: GET /static/core/unified-insights-v2.js -> 200 (6 ms)
INFO:     127.0.0.1:12354 - "GET /static/core/unified-insights-v2.js?v=1759999572583 HTTP/1.1" 200 OK
2025-10-09 10:46:12,611 INFO crypto-rebalancer: {"ts": 1759999572.611291, "method": "GET", "path": "/static/utils/di-history.js", "status": 200, "duration_ms": 3.01, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,611 INFO crypto-rebalancer: GET /static/utils/di-history.js -> 200 (3 ms)
INFO:     127.0.0.1:12354 - "GET /static/utils/di-history.js?v=1759999572583 HTTP/1.1" 200 OK
2025-10-09 10:46:12,617 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=129s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:12,617 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:46:12,618 INFO crypto-rebalancer: {"ts": 1759999572.6181016, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.92, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,618 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (2 ms)
INFO:     127.0.0.1:12354 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:46:12,637 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=129s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:12,637 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:46:12,638 INFO crypto-rebalancer: {"ts": 1759999572.6382802, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.62, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:12,638 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:12354 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:46:13,020 INFO crypto-rebalancer: {"ts": 1759999573.0204272, "method": "GET", "path": "/static/components/UnifiedInsights.js", "status": 200, "duration_ms": 6.11, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:13,020 INFO crypto-rebalancer: GET /static/components/UnifiedInsights.js -> 200 (6 ms)
INFO:     127.0.0.1:12354 - "GET /static/components/UnifiedInsights.js?v=2025-10-09T08:46:13.012Z HTTP/1.1" 200 OK
2025-10-09 10:46:13,028 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=129s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:13,028 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:46:13,029 INFO crypto-rebalancer: {"ts": 1759999573.0292485, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.39, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:13,029 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:12354 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:46:13,039 INFO crypto-rebalancer: {"ts": 1759999573.0398521, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.24, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:13,040 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:12354 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:46:13,049 INFO crypto-rebalancer: {"ts": 1759999573.0499332, "method": "GET", "path": "/static/components/decision-index-panel.js", "status": 200, "duration_ms": 4.27, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:13,050 INFO crypto-rebalancer: GET /static/components/decision-index-panel.js -> 200 (4 ms)
INFO:     127.0.0.1:12354 - "GET /static/components/decision-index-panel.js?v=1759999573044 HTTP/1.1" 200 OK
2025-10-09 10:46:13,059 INFO crypto-rebalancer: {"ts": 1759999573.0598783, "method": "GET", "path": "/static/core/unified-insights-v2.js", "status": 200, "duration_ms": 6.29, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:13,060 INFO crypto-rebalancer: GET /static/core/unified-insights-v2.js -> 200 (6 ms)
INFO:     127.0.0.1:12354 - "GET /static/core/unified-insights-v2.js?v=1759999573044 HTTP/1.1" 200 OK
2025-10-09 10:46:13,065 INFO crypto-rebalancer: {"ts": 1759999573.065904, "method": "GET", "path": "/static/utils/di-history.js", "status": 200, "duration_ms": 2.35, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:13,066 INFO crypto-rebalancer: GET /static/utils/di-history.js -> 200 (2 ms)
INFO:     127.0.0.1:12354 - "GET /static/utils/di-history.js?v=1759999573044 HTTP/1.1" 200 OK
2025-10-09 10:46:13,070 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=129s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:13,070 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:46:13,071 INFO crypto-rebalancer: {"ts": 1759999573.0712461, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.39, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:13,071 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:12354 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:46:13,082 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=129s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:13,083 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:46:13,083 INFO crypto-rebalancer: {"ts": 1759999573.0834146, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.45, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:13,083 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:12354 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:46:15,171 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=132s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:15,185 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=132s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:15,185 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=132s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:15,186 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=132s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:15,186 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=132s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:46:15,187 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:46:15,187 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:46:17,585 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:46:17,587 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:46:17,587 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:46:17,600 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:46:17,724 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:46:17,724 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:46:17,724 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:17,725 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:17,877 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:46:17,877 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:46:17,877 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:46:17,877 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:46:17,877 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:46:17,877 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:46:17,877 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:46:17,877 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:17,878 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:18,040 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:46:18,041 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:46:18,041 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:46:18,041 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:46:18,041 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:46:18,041 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:18,041 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:18,399 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:46:18,399 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:46:18,399 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:46:18,399 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:46:18,401 INFO crypto-rebalancer: {"ts": 1759999578.4017408, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 817.6, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:18,402 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (818 ms)
INFO:     127.0.0.1:12354 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:46:18,404 INFO crypto-rebalancer: {"ts": 1759999578.404642, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 2.07, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:18,404 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:46:18,408 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:46:18,408 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:46:18,423 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (21 ms)
INFO:     127.0.0.1:10723 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:46:18,423 INFO crypto-rebalancer: {"ts": 1759999578.4239151, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 21.24, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:18,424 INFO crypto-rebalancer: GET /balances/current -> 200 (22 ms)
INFO:     127.0.0.1:4374 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:46:41,600 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:46:41,602 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:46:41,602 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:46:41,608 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:46:41,676 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:46:41,676 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:46:41,676 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:41,676 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:41,766 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:46:41,766 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:46:41,766 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:46:41,766 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:46:41,766 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:46:41,766 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:46:41,766 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:46:41,766 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:41,766 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:41,854 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:46:41,855 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:46:41,855 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:46:41,855 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:46:41,855 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:46:41,855 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:46:41,855 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:46:42,023 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:46:42,023 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:46:42,023 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:46:42,023 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:46:42,024 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:46:42,026 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:46:42,026 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:46:42,034 INFO crypto-rebalancer: {"ts": 1759999602.0342119, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 434.54, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:42,034 INFO crypto-rebalancer: {"ts": 1759999602.0343814, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 434.3, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:42,034 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (434 ms)
INFO:     127.0.0.1:7366 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:46:42,034 INFO crypto-rebalancer: GET /balances/current -> 200 (434 ms)
INFO:     127.0.0.1:8464 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:46:59,838 INFO services.streaming.realtime_engine: WebSocket disconnected: nav_badge, remaining: 0
INFO:     connection closed
2025-10-09 10:46:59,847 INFO crypto-rebalancer: {"ts": 1759999619.8475766, "method": "GET", "path": "/static/analytics-unified.html", "status": 304, "duration_ms": 1.47, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:59,847 INFO crypto-rebalancer: GET /static/analytics-unified.html -> 304 (1 ms)
INFO:     127.0.0.1:12300 - "GET /static/analytics-unified.html HTTP/1.1" 304 Not Modified
2025-10-09 10:46:59,891 INFO crypto-rebalancer: {"ts": 1759999619.8918939, "method": "GET", "path": "/.well-known/appspecific/com.chrome.devtools.json", "status": 404, "duration_ms": 2.02, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:59,892 INFO crypto-rebalancer: GET /.well-known/appspecific/com.chrome.devtools.json -> 404 (2 ms)
INFO:     127.0.0.1:12300 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
2025-10-09 10:46:59,990 INFO crypto-rebalancer: {"ts": 1759999619.9901888, "method": "GET", "path": "/config/users.json", "status": 200, "duration_ms": 2.3, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:59,990 INFO crypto-rebalancer: GET /config/users.json -> 200 (2 ms)
INFO:     127.0.0.1:12300 - "GET /config/users.json HTTP/1.1" 200 OK
INFO:     ('127.0.0.1', 1876) - "WebSocket /api/realtime/ws?client_id=nav_badge" [accepted]
2025-10-09 10:46:59,991 INFO services.streaming.realtime_engine: WebSocket connected: nav_badge, total connections: 1
INFO:     connection open
2025-10-09 10:46:59,993 INFO crypto-rebalancer: {"ts": 1759999619.9931788, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 1.91, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:46:59,993 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (2 ms)
INFO:     127.0.0.1:12844 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:46:59,999 INFO api.deps: Active user: jack
2025-10-09 10:47:00,000 INFO crypto-rebalancer: {"ts": 1759999620.0004985, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 0.77, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:00,002 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (3 ms)
INFO:     127.0.0.1:12300 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:47:00,003 INFO crypto-rebalancer: {"ts": 1759999620.003338, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 4.75, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:00,003 INFO crypto-rebalancer: GET /api/users/sources -> 200 (5 ms)
INFO:     127.0.0.1:12844 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:47:00,006 INFO api.crypto_toolbox_endpoints: \U0001f504 Scraping fresh data...
2025-10-09 10:47:00,006 WARNING api.crypto_toolbox_endpoints: \u26a0\ufe0f Browser not connected, re-launching...
2025-10-09 10:47:00,006 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:47:00,006 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-546' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:47:00,007 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:47:00,007 ERROR api.crypto_toolbox_endpoints: \u274c Crypto-toolbox scraping error
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 377, in get_crypto_toolbox_data
    return await _get_data(force=force)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 345, in _get_data
    data = await _scrape_crypto_toolbox()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 219, in _scrape_crypto_toolbox
    browser = await _ensure_browser()
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 166, in _ensure_browser
    await startup_playwright()
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 109, in startup_playwright
    _playwright_instance = await async_playwright().start()
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 51, in start
    return await self.__aenter__()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 46, in __aenter__
    playwright = AsyncPlaywright(next(iter(done)).result())
                                 ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:47:00,010 INFO crypto-rebalancer: {"ts": 1759999620.0102878, "method": "GET", "path": "/api/crypto-toolbox", "status": 502, "duration_ms": 4.63, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:00,010 INFO crypto-rebalancer: GET /api/crypto-toolbox -> 502 (5 ms)
INFO:     127.0.0.1:12300 - "GET /api/crypto-toolbox HTTP/1.1" 502 Bad Gateway
2025-10-09 10:47:00,013 INFO api.deps: Active user: jack
2025-10-09 10:47:00,014 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=176s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:00,014 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:47:00,014 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:47:00,015 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:47:00,015 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:47:00,017 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:47:00,017 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:47:00,017 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:47:00,019 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:47:00,019 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:47:00,026 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 365 days
2025-10-09 10:47:00,196 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:47:00,196 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:47:00,196 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:00,197 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:00,304 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 85.0
2025-10-09 10:47:00,304 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:47:00,304 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:47:00,305 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:47:00,305 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:47:00,305 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:47:00,305 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:47:00,305 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:00,305 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:00,419 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:47:00,419 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=85.0, penalties=0.0, final=85.0
2025-10-09 10:47:00,420 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:47:00,420 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:47:00,420 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:47:00,420 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:00,420 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:00,620 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:47:00,620 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.33, Vol=0.20, MaxDD=-10.64%, RiskScore=85.0, RiskStructural=47.0 [Dual-Window: FI fallback only]
2025-10-09 10:47:00,620 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:47:00,620 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 85.0, 'risk_score_v2': 85.0, 'sharpe_legacy': 1.3262890739554856, 'sharpe_v2': 1.3262890739554856, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 47.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 5.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:47:00,622 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:47:00,791 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:47:00,791 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:47:00,791 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:00,791 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:00,901 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:47:00,901 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:47:00,901 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:47:00,901 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:47:00,901 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:47:00,901 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:47:00,901 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:47:00,901 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:00,901 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:01,016 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:47:01,016 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:47:01,016 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:47:01,016 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:47:01,016 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:47:01,016 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:01,017 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:01,198 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63146823786393
2025-10-09 10:47:01,198 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:47:01,198 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:47:01,198 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226790300213811, 'sharpe_v2': 1.6226790300213811, 'portfolio_structure_score': 82.63146823786393, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763573266090467, 'gri': 16.69217443552703, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.368531762136076, 'final_score': 82.63146823786393, 'inputs': {'hhi': 0.18513007540566773, 'memes_pct': 0.016908933165226167, 'gri': 3.3384348871054055, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:47:01,199 INFO crypto-rebalancer: {"ts": 1759999621.1995218, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 1187.05, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,199 INFO crypto-rebalancer: {"ts": 1759999621.1998541, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 1190.49, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,200 INFO crypto-rebalancer: {"ts": 1759999621.2000778, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 1188.94, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,200 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (1188 ms)
INFO:     127.0.0.1:14241 - "GET /execution/governance/state HTTP/1.1" 200 OK
INFO:     127.0.0.1:12844 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:47:01,200 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (1191 ms)
2025-10-09 10:47:01,201 INFO crypto-rebalancer: {"ts": 1759999621.2013726, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 1190.28, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,201 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (1190 ms)
INFO:     127.0.0.1:11186 - "GET /api/risk/dashboard?min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:47:01,202 INFO api.deps: Active user: jack
2025-10-09 10:47:01,202 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (1191 ms)
INFO:     127.0.0.1:1620 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:47:01,205 INFO crypto-rebalancer: {"ts": 1759999621.2056286, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 5.66, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,206 INFO crypto-rebalancer: GET /api/users/sources -> 200 (6 ms)
INFO:     127.0.0.1:12300 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:47:01,206 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:47:01,210 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:47:01,210 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:47:01,223 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:47:01,303 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:47:01,303 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:47:01,303 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:01,303 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:01,399 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:47:01,399 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:47:01,399 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:47:01,399 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:47:01,399 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:47:01,399 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:47:01,399 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:47:01,399 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:01,399 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:01,506 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:47:01,506 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:47:01,506 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:47:01,506 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:47:01,506 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:47:01,506 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:01,507 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:01,693 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:47:01,693 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:47:01,694 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:47:01,694 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:47:01,695 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:47:01,696 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:47:01,696 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:47:01,705 INFO crypto-rebalancer: {"ts": 1759999621.7051997, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 503.39, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,705 INFO crypto-rebalancer: {"ts": 1759999621.7054608, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 500.41, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,705 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (504 ms)
INFO:     127.0.0.1:5321 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:47:01,706 INFO crypto-rebalancer: GET /balances/current -> 200 (501 ms)
INFO:     127.0.0.1:14241 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:47:01,706 INFO crypto-rebalancer: {"ts": 1759999621.7064948, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 504.73, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,706 INFO crypto-rebalancer: GET /taxonomy -> 200 (505 ms)
INFO:     127.0.0.1:11085 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:47:01,712 INFO crypto-rebalancer: {"ts": 1759999621.7122273, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 1.11, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,712 INFO crypto-rebalancer: GET /taxonomy -> 200 (1 ms)
INFO:     127.0.0.1:11085 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:47:01,732 INFO crypto-rebalancer: {"ts": 1759999621.7321148, "method": "GET", "path": "/api/ml/debug/pipeline-info", "status": 200, "duration_ms": 7.66, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,733 INFO crypto-rebalancer: GET /api/ml/debug/pipeline-info -> 200 (8 ms)
INFO:     127.0.0.1:11085 - "GET /api/ml/debug/pipeline-info HTTP/1.1" 200 OK
2025-10-09 10:47:01,733 INFO api.deps: Active user: jack
2025-10-09 10:47:01,734 INFO crypto-rebalancer: {"ts": 1759999621.7341673, "method": "GET", "path": "/favicon.ico", "status": 200, "duration_ms": 2.09, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,736 INFO crypto-rebalancer: GET /favicon.ico -> 200 (4 ms)
INFO:     127.0.0.1:5321 - "GET /favicon.ico HTTP/1.1" 200 OK
2025-10-09 10:47:01,736 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=178s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:01,736 INFO crypto-rebalancer: {"ts": 1759999621.7368124, "method": "GET", "path": "/api/users/settings", "status": 200, "duration_ms": 4.77, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,737 INFO crypto-rebalancer: {"ts": 1759999621.7370172, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 2.65, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,737 INFO crypto-rebalancer: GET /api/users/settings -> 200 (5 ms)
INFO:     127.0.0.1:14241 - "GET /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:47:01,737 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (3 ms)
INFO:     127.0.0.1:12300 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:47:01,738 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=178s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:01,739 INFO crypto-rebalancer: {"ts": 1759999621.7391186, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 0.81, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,739 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (1 ms)
INFO:     127.0.0.1:14241 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:47:01,742 INFO api.deps: Active user: jack
2025-10-09 10:47:01,743 INFO api.user_settings_endpoints: Settings saved for user jack: 17 keys
2025-10-09 10:47:01,744 INFO crypto-rebalancer: {"ts": 1759999621.7443905, "method": "PUT", "path": "/api/users/settings", "status": 200, "duration_ms": 2.66, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,745 INFO crypto-rebalancer: PUT /api/users/settings -> 200 (3 ms)
INFO:     127.0.0.1:14241 - "PUT /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:47:01,745 INFO crypto-rebalancer: {"ts": 1759999621.745424, "method": "GET", "path": "/api/ml/volatility/predict/BTC", "status": 200, "duration_ms": 1.07, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,745 INFO crypto-rebalancer: GET /api/ml/volatility/predict/BTC -> 200 (1 ms)
INFO:     127.0.0.1:12300 - "GET /api/ml/volatility/predict/BTC?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:01,750 INFO crypto-rebalancer: {"ts": 1759999621.7500257, "method": "GET", "path": "/api/ml/volatility/predict/ETH", "status": 200, "duration_ms": 0.61, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,750 INFO crypto-rebalancer: GET /api/ml/volatility/predict/ETH -> 200 (0 ms)
INFO:     127.0.0.1:12300 - "GET /api/ml/volatility/predict/ETH?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:01,903 INFO crypto-rebalancer: {"ts": 1759999621.9039276, "method": "GET", "path": "/api/config/data-source", "status": 200, "duration_ms": 0.92, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:47:01,904 INFO crypto-rebalancer: GET /api/config/data-source -> 200 (1 ms)
INFO:     127.0.0.1:5088 - "GET /api/config/data-source HTTP/1.1" 200 OK
2025-10-09 10:47:01,904 INFO httpx: HTTP Request: GET http://127.0.0.1:8000/api/config/data-source "HTTP/1.1 200 OK"
2025-10-09 10:47:01,904 INFO services.ml.orchestrator: Using data source from config API: cointracking
2025-10-09 10:47:01,905 INFO crypto-rebalancer: {"ts": 1759999621.9051702, "method": "GET", "path": "/api/ml/regime/current", "status": 200, "duration_ms": 151.99, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,905 INFO crypto-rebalancer: GET /api/ml/regime/current -> 200 (152 ms)
INFO:     127.0.0.1:12300 - "GET /api/ml/regime/current HTTP/1.1" 200 OK
2025-10-09 10:47:01,909 INFO crypto-rebalancer: {"ts": 1759999621.9092677, "method": "GET", "path": "/api/ml/sentiment/fear-greed", "status": 200, "duration_ms": 0.62, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:01,909 INFO crypto-rebalancer: GET /api/ml/sentiment/fear-greed -> 200 (0 ms)
INFO:     127.0.0.1:12300 - "GET /api/ml/sentiment/fear-greed?days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:02,750 INFO crypto-rebalancer: {"ts": 1759999622.7508705, "method": "GET", "path": "/static/components/UnifiedInsights.js", "status": 200, "duration_ms": 5.75, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:02,751 INFO crypto-rebalancer: GET /static/components/UnifiedInsights.js -> 200 (5 ms)
INFO:     127.0.0.1:12300 - "GET /static/components/UnifiedInsights.js?v=2025-10-09T08:47:02.743Z HTTP/1.1" 200 OK
2025-10-09 10:47:02,767 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=179s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:02,767 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:47:02,767 INFO crypto-rebalancer: {"ts": 1759999622.7678998, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.57, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:02,768 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:12300 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:02,773 INFO api.deps: Active user: jack
2025-10-09 10:47:02,773 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:47:02,778 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:47:02,778 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:47:02,782 INFO crypto-rebalancer: {"ts": 1759999622.7825925, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 10.01, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:02,782 INFO crypto-rebalancer: GET /balances/current -> 200 (10 ms)
INFO:     127.0.0.1:12300 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:47:02,918 INFO crypto-rebalancer: {"ts": 1759999622.917971, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.12, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:02,918 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:12300 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:47:03,937 INFO api.deps: Active user: jack
2025-10-09 10:47:03,937 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:47:03,939 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:47:03,939 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:47:03,942 INFO crypto-rebalancer: {"ts": 1759999623.942785, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 6.0, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:03,943 INFO crypto-rebalancer: GET /balances/current -> 200 (6 ms)
INFO:     127.0.0.1:14241 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:47:03,944 INFO crypto-rebalancer: {"ts": 1759999623.944605, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 7.92, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:03,944 INFO crypto-rebalancer: GET /taxonomy -> 200 (8 ms)
INFO:     127.0.0.1:12300 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:47:03,955 INFO crypto-rebalancer: {"ts": 1759999623.955896, "method": "GET", "path": "/static/components/decision-index-panel.js", "status": 200, "duration_ms": 3.43, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:03,956 INFO crypto-rebalancer: GET /static/components/decision-index-panel.js -> 200 (3 ms)
INFO:     127.0.0.1:12300 - "GET /static/components/decision-index-panel.js?v=1759999623950 HTTP/1.1" 200 OK
2025-10-09 10:47:03,965 INFO crypto-rebalancer: {"ts": 1759999623.9656005, "method": "GET", "path": "/static/core/unified-insights-v2.js", "status": 200, "duration_ms": 4.42, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:03,965 INFO crypto-rebalancer: GET /static/core/unified-insights-v2.js -> 200 (4 ms)
INFO:     127.0.0.1:12300 - "GET /static/core/unified-insights-v2.js?v=1759999623950 HTTP/1.1" 200 OK
2025-10-09 10:47:03,972 INFO crypto-rebalancer: {"ts": 1759999623.9722235, "method": "GET", "path": "/static/utils/di-history.js", "status": 200, "duration_ms": 2.78, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:03,972 INFO crypto-rebalancer: GET /static/utils/di-history.js -> 200 (3 ms)
INFO:     127.0.0.1:12300 - "GET /static/utils/di-history.js?v=1759999623950 HTTP/1.1" 200 OK
2025-10-09 10:47:03,976 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=180s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:03,976 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:47:03,977 INFO crypto-rebalancer: {"ts": 1759999623.9773204, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.41, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:03,977 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:12300 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:03,987 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=180s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:03,988 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:47:03,988 INFO crypto-rebalancer: {"ts": 1759999623.9884813, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.44, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:03,988 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:12300 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:07,746 INFO services.streaming.realtime_engine: WebSocket disconnected: nav_badge, remaining: 0
INFO:     connection closed
2025-10-09 10:47:07,799 INFO crypto-rebalancer: {"ts": 1759999627.798961, "method": "GET", "path": "/.well-known/appspecific/com.chrome.devtools.json", "status": 404, "duration_ms": 1.83, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:07,799 INFO crypto-rebalancer: GET /.well-known/appspecific/com.chrome.devtools.json -> 404 (2 ms)
INFO:     127.0.0.1:12300 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
INFO:     ('127.0.0.1', 5454) - "WebSocket /api/realtime/ws?client_id=nav_badge" [accepted]
2025-10-09 10:47:07,875 INFO services.streaming.realtime_engine: WebSocket connected: nav_badge, total connections: 1
INFO:     connection open
2025-10-09 10:47:07,876 INFO crypto-rebalancer: {"ts": 1759999627.8760698, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 3.02, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:07,876 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (3 ms)
INFO:     127.0.0.1:12300 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:47:07,879 INFO crypto-rebalancer: {"ts": 1759999627.879728, "method": "GET", "path": "/config/users.json", "status": 200, "duration_ms": 6.23, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:07,880 INFO crypto-rebalancer: GET /config/users.json -> 200 (7 ms)
INFO:     127.0.0.1:14241 - "GET /config/users.json HTTP/1.1" 200 OK
2025-10-09 10:47:07,884 INFO crypto-rebalancer: {"ts": 1759999627.884649, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.19, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:07,885 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:14241 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:47:07,891 INFO crypto-rebalancer: {"ts": 1759999627.8918338, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.39, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:07,892 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:14241 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:47:07,899 INFO api.deps: Active user: jack
2025-10-09 10:47:07,904 INFO crypto-rebalancer: {"ts": 1759999627.9049516, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 5.48, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:07,905 INFO crypto-rebalancer: {"ts": 1759999627.905081, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 6.96, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:07,905 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (5 ms)
INFO:     127.0.0.1:12300 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:47:07,905 INFO crypto-rebalancer: GET /api/users/sources -> 200 (7 ms)
INFO:     127.0.0.1:14241 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:47:07,910 INFO api.crypto_toolbox_endpoints: \U0001f504 Scraping fresh data...
2025-10-09 10:47:07,910 WARNING api.crypto_toolbox_endpoints: \u26a0\ufe0f Browser not connected, re-launching...
2025-10-09 10:47:07,910 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:47:07,911 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-603' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:47:07,914 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:47:07,914 ERROR api.crypto_toolbox_endpoints: \u274c Crypto-toolbox scraping error
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 377, in get_crypto_toolbox_data
    return await _get_data(force=force)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 345, in _get_data
    data = await _scrape_crypto_toolbox()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 219, in _scrape_crypto_toolbox
    browser = await _ensure_browser()
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 166, in _ensure_browser
    await startup_playwright()
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 109, in startup_playwright
    _playwright_instance = await async_playwright().start()
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 51, in start
    return await self.__aenter__()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 46, in __aenter__
    playwright = AsyncPlaywright(next(iter(done)).result())
                                 ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:47:07,918 INFO crypto-rebalancer: {"ts": 1759999627.9183846, "method": "GET", "path": "/api/crypto-toolbox", "status": 502, "duration_ms": 9.1, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:07,920 INFO api.deps: Active user: jack
2025-10-09 10:47:07,921 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=184s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:07,921 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:47:07,921 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:47:07,921 INFO crypto-rebalancer: GET /api/crypto-toolbox -> 502 (12 ms)
INFO:     127.0.0.1:14241 - "GET /api/crypto-toolbox HTTP/1.1" 502 Bad Gateway
2025-10-09 10:47:07,922 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:47:07,922 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:47:07,925 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:47:07,925 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:47:07,926 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:47:08,249 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:47:08,249 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:47:08,249 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:08,249 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:08,404 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:47:08,405 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:47:08,405 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:47:08,405 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:47:08,405 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:47:08,405 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:47:08,405 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:47:08,405 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:08,405 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:08,577 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:47:08,577 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:47:08,577 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:47:08,577 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:47:08,577 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:47:08,577 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:08,577 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:08,857 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63146823786393
2025-10-09 10:47:08,857 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:47:08,857 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:47:08,857 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226790300213811, 'sharpe_v2': 1.6226790300213811, 'portfolio_structure_score': 82.63146823786393, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763573266090467, 'gri': 16.69217443552703, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.368531762136076, 'final_score': 82.63146823786393, 'inputs': {'hhi': 0.18513007540566773, 'memes_pct': 0.016908933165226167, 'gri': 3.3384348871054055, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:47:08,859 INFO crypto-rebalancer: {"ts": 1759999628.8591266, "method": "GET", "path": "/api/strategies/list", "status": 200, "duration_ms": 940.88, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:08,859 INFO crypto-rebalancer: {"ts": 1759999628.859288, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 940.98, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:08,859 INFO crypto-rebalancer: {"ts": 1759999628.8595736, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 950.07, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:08,859 INFO crypto-rebalancer: {"ts": 1759999628.859797, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 942.67, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:08,859 INFO crypto-rebalancer: GET /api/strategies/list -> 200 (942 ms)
INFO:     127.0.0.1:9859 - "GET /api/strategies/list?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:47:08,860 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (942 ms)
INFO:     127.0.0.1:1184 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:47:08,860 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (951 ms)
INFO:     127.0.0.1:12300 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:47:08,861 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (944 ms)
INFO:     127.0.0.1:6535 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:47:08,863 INFO api.deps: Active user: jack
2025-10-09 10:47:08,864 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:47:08,865 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:47:08,865 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:47:08,875 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:47:09,014 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:47:09,014 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:47:09,014 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:09,015 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:09,221 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:47:09,221 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:47:09,221 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:47:09,221 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:47:09,221 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:47:09,222 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:47:09,222 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:47:09,222 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:09,222 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:09,370 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:47:09,370 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:47:09,370 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:47:09,370 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:47:09,370 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:47:09,370 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:09,370 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:09,658 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:47:09,658 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:47:09,658 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:47:09,658 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:47:09,662 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=186s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:09,662 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:47:09,662 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:47:09,663 INFO crypto-rebalancer: {"ts": 1759999629.6629846, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 802.02, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:09,663 INFO crypto-rebalancer: {"ts": 1759999629.6631405, "method": "GET", "path": "/favicon.ico", "status": 200, "duration_ms": 799.25, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:09,663 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:47:09,664 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:47:09,664 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:47:09,672 INFO crypto-rebalancer: {"ts": 1759999629.672555, "method": "GET", "path": "/api/strategies/list", "status": 200, "duration_ms": 808.39, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:09,672 INFO crypto-rebalancer: {"ts": 1759999629.6727085, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 811.31, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:09,672 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (812 ms)
INFO:     127.0.0.1:14241 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:47:09,672 INFO crypto-rebalancer: {"ts": 1759999629.6729608, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 13.65, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:09,673 INFO crypto-rebalancer: GET /favicon.ico -> 200 (809 ms)
INFO:     127.0.0.1:1184 - "GET /favicon.ico HTTP/1.1" 200 OK
2025-10-09 10:47:09,673 INFO crypto-rebalancer: GET /api/strategies/list -> 200 (809 ms)
INFO:     127.0.0.1:12300 - "GET /api/strategies/list?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:47:09,673 INFO crypto-rebalancer: GET /api/users/sources -> 200 (812 ms)
INFO:     127.0.0.1:14419 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:47:09,673 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (809 ms)
INFO:     127.0.0.1:6535 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:47:09,674 INFO crypto-rebalancer: {"ts": 1759999629.6743095, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 810.46, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:09,674 INFO crypto-rebalancer: GET /balances/current -> 200 (811 ms)
INFO:     127.0.0.1:9859 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:47:09,682 INFO api.deps: Active user: jack
2025-10-09 10:47:09,685 INFO crypto-rebalancer: {"ts": 1759999629.685379, "method": "GET", "path": "/api/users/settings", "status": 200, "duration_ms": 3.84, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:09,685 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=186s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:09,685 INFO crypto-rebalancer: GET /api/users/settings -> 200 (4 ms)
INFO:     127.0.0.1:9859 - "GET /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:47:09,686 INFO crypto-rebalancer: {"ts": 1759999629.6866074, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 1.28, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:09,686 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (1 ms)
INFO:     127.0.0.1:6535 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:47:09,688 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=186s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:09,688 INFO crypto-rebalancer: {"ts": 1759999629.6885588, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 0.85, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:09,688 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (1 ms)
INFO:     127.0.0.1:9859 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:47:09,691 INFO api.deps: Active user: jack
2025-10-09 10:47:09,693 INFO api.user_settings_endpoints: Settings saved for user jack: 17 keys
2025-10-09 10:47:09,693 INFO crypto-rebalancer: {"ts": 1759999629.6937878, "method": "PUT", "path": "/api/users/settings", "status": 200, "duration_ms": 3.02, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:09,693 INFO crypto-rebalancer: PUT /api/users/settings -> 200 (3 ms)
INFO:     127.0.0.1:9859 - "PUT /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:47:10,654 INFO services.streaming.realtime_engine: WebSocket disconnected: nav_badge, remaining: 0
INFO:     connection closed
2025-10-09 10:47:10,700 INFO crypto-rebalancer: {"ts": 1759999630.700406, "method": "GET", "path": "/.well-known/appspecific/com.chrome.devtools.json", "status": 404, "duration_ms": 2.25, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:10,700 INFO crypto-rebalancer: GET /.well-known/appspecific/com.chrome.devtools.json -> 404 (2 ms)
INFO:     127.0.0.1:9859 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
INFO:     ('127.0.0.1', 9123) - "WebSocket /api/realtime/ws?client_id=nav_badge" [accepted]
2025-10-09 10:47:10,783 INFO services.streaming.realtime_engine: WebSocket connected: nav_badge, total connections: 1
INFO:     connection open
2025-10-09 10:47:10,784 INFO crypto-rebalancer: {"ts": 1759999630.7843342, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 3.24, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:10,784 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (3 ms)
INFO:     127.0.0.1:9859 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:47:10,787 INFO crypto-rebalancer: {"ts": 1759999630.7871761, "method": "GET", "path": "/config/users.json", "status": 200, "duration_ms": 3.42, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:10,787 INFO crypto-rebalancer: GET /config/users.json -> 200 (4 ms)
INFO:     127.0.0.1:6535 - "GET /config/users.json HTTP/1.1" 200 OK
2025-10-09 10:47:10,791 INFO api.deps: Active user: jack
2025-10-09 10:47:10,798 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:47:10,801 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:47:10,802 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:47:10,812 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:47:10,951 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:47:10,951 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:47:10,951 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:10,951 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:11,131 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:47:11,131 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:47:11,131 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:47:11,131 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:47:11,131 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:47:11,131 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:47:11,131 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:47:11,131 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:11,132 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:11,314 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:47:11,314 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:47:11,314 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:47:11,314 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:47:11,314 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:47:11,314 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:11,315 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:11,603 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:47:11,603 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:47:11,603 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:47:11,603 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:47:11,604 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:47:11,607 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:47:11,607 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:47:11,620 INFO api.crypto_toolbox_endpoints: \U0001f504 Scraping fresh data...
2025-10-09 10:47:11,620 WARNING api.crypto_toolbox_endpoints: \u26a0\ufe0f Browser not connected, re-launching...
2025-10-09 10:47:11,620 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:47:11,621 INFO crypto-rebalancer: {"ts": 1759999631.621198, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 833.21, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:11,621 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-639' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:47:11,624 INFO crypto-rebalancer: {"ts": 1759999631.624184, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 833.51, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:11,624 INFO crypto-rebalancer: {"ts": 1759999631.6243684, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 833.76, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:9859 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:47:11,624 INFO crypto-rebalancer: GET /api/users/sources -> 200 (836 ms)
2025-10-09 10:47:11,625 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:47:11,625 ERROR api.crypto_toolbox_endpoints: \u274c Crypto-toolbox scraping error
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 377, in get_crypto_toolbox_data
    return await _get_data(force=force)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 345, in _get_data
    data = await _scrape_crypto_toolbox()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 219, in _scrape_crypto_toolbox
    browser = await _ensure_browser()
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 166, in _ensure_browser
    await startup_playwright()
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 109, in startup_playwright
    _playwright_instance = await async_playwright().start()
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 51, in start
    return await self.__aenter__()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 46, in __aenter__
    playwright = AsyncPlaywright(next(iter(done)).result())
                                 ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:47:11,627 INFO api.deps: Active user: jack
2025-10-09 10:47:11,627 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (837 ms)
INFO:     127.0.0.1:6535 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:47:11,628 INFO crypto-rebalancer: GET /balances/current -> 200 (837 ms)
INFO:     127.0.0.1:14419 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:47:11,628 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:47:11,631 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:47:11,631 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:47:11,632 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:47:11,876 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:47:11,876 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:47:11,876 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:11,877 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:12,068 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:47:12,068 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:47:12,068 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:47:12,068 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:47:12,068 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:47:12,068 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:47:12,068 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:47:12,068 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:12,068 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:12,274 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:47:12,275 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:47:12,275 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:47:12,275 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:47:12,275 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:47:12,275 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:12,275 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:12,549 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63146823786393
2025-10-09 10:47:12,549 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:47:12,549 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:47:12,549 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6226790300213811, 'sharpe_v2': 1.6226790300213811, 'portfolio_structure_score': 82.63146823786393, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6763573266090467, 'gri': 16.69217443552703, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.368531762136076, 'final_score': 82.63146823786393, 'inputs': {'hhi': 0.18513007540566773, 'memes_pct': 0.016908933165226167, 'gri': 3.3384348871054055, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:47:12,552 INFO crypto-rebalancer: {"ts": 1759999632.5519843, "method": "GET", "path": "/api/crypto-toolbox", "status": 502, "duration_ms": 947.5, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:12300 - "GET /api/crypto-toolbox HTTP/1.1" 502 Bad Gateway
2025-10-09 10:47:12,553 INFO crypto-rebalancer: GET /api/crypto-toolbox -> 502 (1755 ms)
2025-10-09 10:47:12,553 INFO crypto-rebalancer: {"ts": 1759999632.5533793, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 934.33, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:12,553 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:47:12,554 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=189s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:12,554 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:47:12,554 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:47:12,555 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (937 ms)
INFO:     127.0.0.1:14241 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:47:12,556 INFO crypto-rebalancer: {"ts": 1759999632.5568602, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 952.31, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:12,557 INFO crypto-rebalancer: {"ts": 1759999632.5577054, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 4.73, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:12,557 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (1760 ms)
INFO:     127.0.0.1:1184 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:47:12,558 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (6 ms)
INFO:     127.0.0.1:9859 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:47:12,559 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:47:12,562 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:47:12,562 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:47:12,574 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 365 days
2025-10-09 10:47:12,827 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:47:12,827 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:47:12,827 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:12,828 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:13,002 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 85.0
2025-10-09 10:47:13,002 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:47:13,002 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:47:13,002 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:47:13,002 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:47:13,002 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:47:13,002 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:47:13,002 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:13,002 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:13,135 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:47:13,135 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=85.0, penalties=0.0, final=85.0
2025-10-09 10:47:13,135 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:47:13,135 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:47:13,135 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:47:13,135 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:47:13,135 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:13,412 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:47:13,412 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.33, Vol=0.20, MaxDD=-10.64%, RiskScore=85.0, RiskStructural=47.0 [Dual-Window: FI fallback only]
2025-10-09 10:47:13,412 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:47:13,413 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 85.0, 'risk_score_v2': 85.0, 'sharpe_legacy': 1.3262890739554856, 'sharpe_v2': 1.3262890739554856, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 47.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 5.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:47:13,415 INFO crypto-rebalancer: {"ts": 1759999633.4154286, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 1787.13, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,415 INFO crypto-rebalancer: {"ts": 1759999633.4155855, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 859.33, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,415 INFO crypto-rebalancer: GET /taxonomy -> 200 (1788 ms)
INFO:     127.0.0.1:6672 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:47:13,416 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (862 ms)
INFO:     127.0.0.1:6535 - "GET /api/risk/dashboard?min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:47:13,422 INFO crypto-rebalancer: {"ts": 1759999633.4224343, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.8, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,422 INFO crypto-rebalancer: GET /taxonomy -> 200 (3 ms)
INFO:     127.0.0.1:6672 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:47:13,589 INFO crypto-rebalancer: {"ts": 1759999633.5891461, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 0.76, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,589 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (1 ms)
INFO:     127.0.0.1:6672 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:47:13,617 INFO crypto-rebalancer: {"ts": 1759999633.6172807, "method": "GET", "path": "/api/ml/debug/pipeline-info", "status": 200, "duration_ms": 16.38, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,617 INFO crypto-rebalancer: GET /api/ml/debug/pipeline-info -> 200 (16 ms)
INFO:     127.0.0.1:6672 - "GET /api/ml/debug/pipeline-info HTTP/1.1" 200 OK
2025-10-09 10:47:13,636 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=190s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:13,637 INFO crypto-rebalancer: {"ts": 1759999633.6374125, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 1.26, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,638 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (2 ms)
INFO:     127.0.0.1:6672 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:47:13,639 INFO api.deps: Active user: jack
2025-10-09 10:47:13,643 INFO crypto-rebalancer: {"ts": 1759999633.6439326, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 6.58, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,644 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=190s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:13,644 INFO crypto-rebalancer: GET /api/users/sources -> 200 (7 ms)
INFO:     127.0.0.1:6535 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:47:13,645 INFO crypto-rebalancer: {"ts": 1759999633.645521, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 1.77, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,645 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (2 ms)
INFO:     127.0.0.1:6672 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:47:13,657 INFO crypto-rebalancer: {"ts": 1759999633.6576378, "method": "GET", "path": "/api/ml/volatility/predict/BTC", "status": 200, "duration_ms": 2.05, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,659 INFO crypto-rebalancer: GET /api/ml/volatility/predict/BTC -> 200 (4 ms)
INFO:     127.0.0.1:6672 - "GET /api/ml/volatility/predict/BTC?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:13,660 INFO api.deps: Active user: jack
2025-10-09 10:47:13,660 INFO crypto-rebalancer: {"ts": 1759999633.6607516, "method": "GET", "path": "/favicon.ico", "status": 200, "duration_ms": 3.18, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,664 INFO crypto-rebalancer: GET /favicon.ico -> 200 (6 ms)
INFO:     127.0.0.1:9859 - "GET /favicon.ico HTTP/1.1" 200 OK
2025-10-09 10:47:13,664 INFO crypto-rebalancer: {"ts": 1759999633.6647933, "method": "GET", "path": "/api/users/settings", "status": 200, "duration_ms": 7.29, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,665 INFO crypto-rebalancer: GET /api/users/settings -> 200 (7 ms)
INFO:     127.0.0.1:6535 - "GET /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:47:13,667 INFO crypto-rebalancer: {"ts": 1759999633.667398, "method": "GET", "path": "/api/ml/volatility/predict/ETH", "status": 200, "duration_ms": 1.5, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,667 INFO crypto-rebalancer: GET /api/ml/volatility/predict/ETH -> 200 (2 ms)
INFO:     127.0.0.1:6672 - "GET /api/ml/volatility/predict/ETH?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:13,926 INFO api.deps: Active user: jack
2025-10-09 10:47:13,927 INFO api.user_settings_endpoints: Settings saved for user jack: 17 keys
2025-10-09 10:47:13,928 INFO crypto-rebalancer: {"ts": 1759999633.9284534, "method": "PUT", "path": "/api/users/settings", "status": 200, "duration_ms": 258.77, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,928 INFO crypto-rebalancer: PUT /api/users/settings -> 200 (259 ms)
INFO:     127.0.0.1:6672 - "PUT /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:47:13,931 INFO crypto-rebalancer: {"ts": 1759999633.931041, "method": "GET", "path": "/api/config/data-source", "status": 200, "duration_ms": 1.89, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:47:13,931 INFO crypto-rebalancer: GET /api/config/data-source -> 200 (2 ms)
INFO:     127.0.0.1:1906 - "GET /api/config/data-source HTTP/1.1" 200 OK
2025-10-09 10:47:13,932 INFO httpx: HTTP Request: GET http://127.0.0.1:8000/api/config/data-source "HTTP/1.1 200 OK"
2025-10-09 10:47:13,932 INFO services.ml.orchestrator: Using data source from config API: cointracking
2025-10-09 10:47:13,933 INFO crypto-rebalancer: {"ts": 1759999633.93332, "method": "GET", "path": "/api/ml/regime/current", "status": 200, "duration_ms": 262.2, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,933 INFO crypto-rebalancer: GET /api/ml/regime/current -> 200 (262 ms)
INFO:     127.0.0.1:6535 - "GET /api/ml/regime/current HTTP/1.1" 200 OK
2025-10-09 10:47:13,938 INFO crypto-rebalancer: {"ts": 1759999633.9383395, "method": "GET", "path": "/api/ml/sentiment/fear-greed", "status": 200, "duration_ms": 1.25, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:13,938 INFO crypto-rebalancer: GET /api/ml/sentiment/fear-greed -> 200 (1 ms)
INFO:     127.0.0.1:6535 - "GET /api/ml/sentiment/fear-greed?days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:14,690 INFO crypto-rebalancer: {"ts": 1759999634.6901562, "method": "GET", "path": "/static/components/UnifiedInsights.js", "status": 200, "duration_ms": 6.84, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:14,690 INFO crypto-rebalancer: GET /static/components/UnifiedInsights.js -> 200 (7 ms)
INFO:     127.0.0.1:6535 - "GET /static/components/UnifiedInsights.js?v=2025-10-09T08:47:14.680Z HTTP/1.1" 200 OK
2025-10-09 10:47:14,705 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=191s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:14,705 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:47:14,706 INFO crypto-rebalancer: {"ts": 1759999634.706252, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.53, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:14,706 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:6535 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:14,717 INFO api.deps: Active user: jack
2025-10-09 10:47:14,717 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:47:14,722 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:47:14,722 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:47:14,727 INFO crypto-rebalancer: {"ts": 1759999634.7270298, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 10.25, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:14,727 INFO crypto-rebalancer: GET /balances/current -> 200 (10 ms)
INFO:     127.0.0.1:6535 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:47:14,728 INFO api.deps: Active user: jack
2025-10-09 10:47:14,729 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:47:14,730 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:47:14,730 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:47:14,734 INFO crypto-rebalancer: {"ts": 1759999634.7348733, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 6.49, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:14,735 INFO crypto-rebalancer: GET /balances/current -> 200 (6 ms)
INFO:     127.0.0.1:6672 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:47:14,737 INFO api.deps: Active user: jack
2025-10-09 10:47:14,737 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:47:14,741 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:47:14,741 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:47:14,746 INFO crypto-rebalancer: {"ts": 1759999634.7460315, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 9.57, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:14,746 INFO crypto-rebalancer: GET /balances/current -> 200 (9 ms)
INFO:     127.0.0.1:6535 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:47:14,772 INFO crypto-rebalancer: {"ts": 1759999634.7725976, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.58, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:14,772 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:6535 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:47:14,783 INFO crypto-rebalancer: {"ts": 1759999634.783641, "method": "GET", "path": "/static/components/decision-index-panel.js", "status": 200, "duration_ms": 4.4, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:14,783 INFO crypto-rebalancer: GET /static/components/decision-index-panel.js -> 200 (4 ms)
INFO:     127.0.0.1:6535 - "GET /static/components/decision-index-panel.js?v=1759999634777 HTTP/1.1" 200 OK
2025-10-09 10:47:14,793 INFO crypto-rebalancer: {"ts": 1759999634.7932243, "method": "GET", "path": "/static/core/unified-insights-v2.js", "status": 200, "duration_ms": 6.04, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:14,793 INFO crypto-rebalancer: GET /static/core/unified-insights-v2.js -> 200 (6 ms)
INFO:     127.0.0.1:6535 - "GET /static/core/unified-insights-v2.js?v=1759999634777 HTTP/1.1" 200 OK
2025-10-09 10:47:14,801 INFO crypto-rebalancer: {"ts": 1759999634.800993, "method": "GET", "path": "/static/utils/di-history.js", "status": 200, "duration_ms": 3.12, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:14,801 INFO crypto-rebalancer: GET /static/utils/di-history.js -> 200 (3 ms)
INFO:     127.0.0.1:6535 - "GET /static/utils/di-history.js?v=1759999634777 HTTP/1.1" 200 OK
2025-10-09 10:47:14,807 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=191s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:14,808 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:47:14,808 INFO crypto-rebalancer: {"ts": 1759999634.8084445, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.49, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:14,808 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:6535 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:14,819 INFO api.deps: Active user: jack
2025-10-09 10:47:14,819 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:47:14,822 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:47:14,822 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:47:14,826 INFO crypto-rebalancer: {"ts": 1759999634.8268182, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 8.37, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:14,827 INFO crypto-rebalancer: GET /balances/current -> 200 (8 ms)
INFO:     127.0.0.1:6535 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:47:14,846 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=191s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:14,846 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:47:14,847 INFO crypto-rebalancer: {"ts": 1759999634.8470218, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.52, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:14,847 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:6535 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:15,245 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=192s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:15,245 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:47:15,245 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:47:15,246 INFO crypto-rebalancer: {"ts": 1759999635.2465184, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 1.29, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:15,246 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (1 ms)
INFO:     127.0.0.1:6535 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:47:15,253 INFO crypto-rebalancer: {"ts": 1759999635.2531857, "method": "GET", "path": "/static/components/UnifiedInsights.js", "status": 200, "duration_ms": 6.7, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:15,253 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=192s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:15,254 INFO crypto-rebalancer: GET /static/components/UnifiedInsights.js -> 200 (7 ms)
INFO:     127.0.0.1:6672 - "GET /static/components/UnifiedInsights.js?v=2025-10-09T08:47:15.244Z HTTP/1.1" 200 OK
2025-10-09 10:47:15,255 INFO crypto-rebalancer: {"ts": 1759999635.255321, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 2.18, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:15,256 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (3 ms)
INFO:     127.0.0.1:6535 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:47:15,262 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=192s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:15,262 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:47:15,262 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:47:15,263 INFO crypto-rebalancer: {"ts": 1759999635.2633674, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 1.26, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:15,263 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (1 ms)
INFO:     127.0.0.1:6672 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:47:15,267 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=192s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:15,267 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:47:15,268 INFO crypto-rebalancer: {"ts": 1759999635.2685792, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.93, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:15,269 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=192s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:15,269 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (2 ms)
INFO:     127.0.0.1:6672 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:15,270 INFO crypto-rebalancer: {"ts": 1759999635.2702208, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 1.71, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:15,270 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (2 ms)
INFO:     127.0.0.1:6535 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:47:15,279 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:47:15,279 INFO crypto-rebalancer: {"ts": 1759999635.2795265, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 2.36, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:15,279 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (2 ms)
INFO:     127.0.0.1:6535 - "GET /api/alerts/active?include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:47:15,281 INFO crypto-rebalancer: {"ts": 1759999635.281674, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 3.29, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:15,281 INFO crypto-rebalancer: GET /taxonomy -> 200 (3 ms)
INFO:     127.0.0.1:6672 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:47:15,292 INFO crypto-rebalancer: {"ts": 1759999635.2923756, "method": "GET", "path": "/static/components/decision-index-panel.js", "status": 200, "duration_ms": 4.09, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:15,292 INFO crypto-rebalancer: GET /static/components/decision-index-panel.js -> 200 (4 ms)
INFO:     127.0.0.1:6672 - "GET /static/components/decision-index-panel.js?v=1759999635286 HTTP/1.1" 200 OK
2025-10-09 10:47:15,302 INFO crypto-rebalancer: {"ts": 1759999635.302074, "method": "GET", "path": "/static/core/unified-insights-v2.js", "status": 200, "duration_ms": 6.23, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:15,302 INFO crypto-rebalancer: GET /static/core/unified-insights-v2.js -> 200 (6 ms)
INFO:     127.0.0.1:6672 - "GET /static/core/unified-insights-v2.js?v=1759999635286 HTTP/1.1" 200 OK
2025-10-09 10:47:15,308 INFO crypto-rebalancer: {"ts": 1759999635.3087204, "method": "GET", "path": "/static/utils/di-history.js", "status": 200, "duration_ms": 2.59, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:6672 - "GET /static/utils/di-history.js?v=1759999635286 HTTP/1.1" 200 OK
2025-10-09 10:47:15,308 INFO crypto-rebalancer: GET /static/utils/di-history.js -> 200 (2 ms)
2025-10-09 10:47:15,313 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=192s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:15,313 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:47:15,314 INFO crypto-rebalancer: {"ts": 1759999635.3140755, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.41, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:15,314 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:6672 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:15,325 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=192s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:15,325 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:47:15,326 INFO crypto-rebalancer: {"ts": 1759999635.326286, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.47, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:15,326 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:6672 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:47:17,594 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:47:17,597 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:47:17,597 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:47:17,610 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:47:17,732 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:47:17,732 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:47:17,732 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:17,732 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:17,941 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:47:17,941 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:47:17,941 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:47:17,941 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:47:17,941 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:47:17,941 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:47:17,941 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:47:17,941 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:17,941 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:18,076 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:47:18,076 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:47:18,076 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:47:18,077 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:47:18,077 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:47:18,077 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:18,077 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:18,331 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:47:18,332 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:47:18,332 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:47:18,332 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:47:18,334 INFO crypto-rebalancer: {"ts": 1759999638.3345804, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 741.35, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:18,336 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (743 ms)
INFO:     127.0.0.1:6672 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:47:18,337 INFO crypto-rebalancer: {"ts": 1759999638.3371391, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 2.65, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:18,337 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:47:18,340 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:47:18,340 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:47:18,353 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (19 ms)
INFO:     127.0.0.1:9859 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:47:18,354 INFO crypto-rebalancer: {"ts": 1759999638.3543975, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 20.0, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:18,354 INFO crypto-rebalancer: GET /balances/current -> 200 (20 ms)
INFO:     127.0.0.1:6535 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:47:18,358 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=195s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:18,359 INFO crypto-rebalancer: {"ts": 1759999638.359156, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 0.95, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:18,359 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (1 ms)
INFO:     127.0.0.1:6535 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:47:19,669 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=196s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:19,983 INFO httpx: HTTP Request: GET https://api.coingecko.com/api/v3/global "HTTP/1.1 429 Too Many Requests"
2025-10-09 10:47:20,391 INFO api.market_endpoints: Fetching market prices for 10 symbols over 30 days
2025-10-09 10:47:20,391 WARNING api.market_endpoints: BTC data not available for relative strength calculation
2025-10-09 10:47:20,391 INFO api.market_endpoints: Market prices returned for 10 symbols
2025-10-09 10:47:20,391 INFO crypto-rebalancer: {"ts": 1759999640.3915834, "method": "GET", "path": "/api/market/prices", "status": 200, "duration_ms": 1.09, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:47:20,391 INFO crypto-rebalancer: GET /api/market/prices -> 200 (1 ms)
INFO:     127.0.0.1:6666 - "GET /api/market/prices?days=30 HTTP/1.1" 200 OK
2025-10-09 10:47:20,392 INFO httpx: HTTP Request: GET http://localhost:8000/api/market/prices?days=30 "HTTP/1.1 200 OK"
2025-10-09 10:47:20,868 INFO api.analytics_endpoints: Calculating market breadth metrics
2025-10-09 10:47:20,868 ERROR api.analytics_endpoints: Error calculating market breadth: No module named 'api.balances'
2025-10-09 10:47:20,868 INFO crypto-rebalancer: {"ts": 1759999640.8687963, "method": "GET", "path": "/api/analytics/market-breadth", "status": 200, "duration_ms": 0.82, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:47:20,868 INFO crypto-rebalancer: GET /api/analytics/market-breadth -> 200 (1 ms)
INFO:     127.0.0.1:6669 - "GET /api/analytics/market-breadth HTTP/1.1" 200 OK
2025-10-09 10:47:20,869 INFO httpx: HTTP Request: GET http://localhost:8000/api/analytics/market-breadth "HTTP/1.1 200 OK"
2025-10-09 10:47:20,881 INFO services.alerts.alert_types: Alert triggered: AlertType.EXEC_COST_SPIKE severity AlertSeverity.S2 value 70
2025-10-09 10:47:20,881 WARNING services.alerts.alert_storage: Retrieved 0 active alerts from MEMORY (degraded mode)
2025-10-09 10:47:20,882 WARNING services.execution.governance: Alert cap reduction applied: 0.0% \u2192 3.0% (Alert: ALR-20251009-104720-b9672b02, Reason: Backend_stale_60min)
2025-10-09 10:47:20,882 WARNING services.alerts.alert_engine: Systemic alert cap reduction applied: -3pts by ALR-20251009-104720-b9672b02 (Backend_stale_60min)
2025-10-09 10:47:20,883 WARNING services.alerts.alert_storage: Alert ALR-20251009-104720-b9672b02 stored in MEMORY (degraded mode)
2025-10-09 10:47:20,883 CRITICAL services.alerts.alert_storage: Alert system degraded: storing in memory only
2025-10-09 10:47:20,883 INFO services.alerts.alert_engine: Alert generated: ALR-20251009-104720-b9672b02 (AlertType.EXEC_COST_SPIKE:AlertSeverity.S2)
2025-10-09 10:47:20,883 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0441 (4.41%), cap_final=0.0441 (4.41%), var_state=normal, stale_state=normal, signals_age=197s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-3.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:20,883 INFO services.execution.governance: Alert cap reduction progressive clear: 2.0% remaining
2025-10-09 10:47:20,883 WARNING services.execution.governance: Auto progressive clear: 3.0% \u2192 2.0% (next clear in 30min)
2025-10-09 10:47:20,883 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0541 (5.41%), cap_final=0.0541 (5.41%), var_state=normal, stale_state=normal, signals_age=197s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-2.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:20,883 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0541 (5.41%), cap_final=0.0541 (5.41%), var_state=normal, stale_state=normal, signals_age=197s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-2.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:20,883 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0541 (5.41%), cap_final=0.0541 (5.41%), var_state=normal, stale_state=normal, signals_age=197s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-2.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:47:20,884 WARNING services.alerts.alert_storage: Retrieved 1 active alerts from MEMORY (degraded mode)
2025-10-09 10:47:20,884 WARNING services.alerts.alert_storage: Retrieved 1 active alerts from MEMORY (degraded mode)
2025-10-09 10:47:20,884 INFO services.streaming.realtime_engine: Initializing RealtimeEngine...
2025-10-09 10:47:20,885 ERROR services.streaming.realtime_engine: Failed to initialize Redis Streams: Redis URL must specify one of the following schemes (redis://, rediss://, unix://)
2025-10-09 10:47:20,885 WARNING services.streaming.realtime_engine: Redis Streams not available - running in WebSocket-only mode
2025-10-09 10:47:20,885 INFO services.streaming.realtime_engine: RealtimeEngine initialized successfully
2025-10-09 10:47:20,885 ERROR services.alerts.alert_engine: Error broadcasting alert ALR-20251009-104720-b9672b02 via Phase 3B: 'Alert' object has no attribute 'message'
2025-10-09 10:47:41,590 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:47:41,591 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:47:41,591 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:47:41,598 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:47:41,667 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:47:41,667 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:47:41,667 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:41,667 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:41,760 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:47:41,760 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:47:41,760 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:47:41,760 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:47:41,760 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:47:41,760 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:47:41,760 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:47:41,760 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:41,760 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:41,853 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:47:41,853 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:47:41,853 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:47:41,853 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:47:41,853 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:47:41,853 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:47:41,853 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:47:42,021 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:47:42,021 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:47:42,021 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:47:42,021 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:47:42,023 INFO crypto-rebalancer: {"ts": 1759999662.0229652, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 433.67, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:42,023 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (434 ms)
INFO:     127.0.0.1:4091 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:47:42,024 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:47:42,026 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:47:42,026 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:47:42,034 INFO crypto-rebalancer: {"ts": 1759999662.0346444, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 11.06, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:47:42,034 INFO crypto-rebalancer: GET /balances/current -> 200 (11 ms)
INFO:     127.0.0.1:4117 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:48:11,592 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:48:11,594 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:48:11,594 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:48:11,600 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:48:11,664 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:48:11,665 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:48:11,665 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:48:11,665 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:11,752 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:48:11,752 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:48:11,752 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:48:11,752 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:48:11,752 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:48:11,752 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:48:11,752 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:48:11,752 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:48:11,752 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:11,842 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:48:11,842 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:48:11,842 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:48:11,842 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:48:11,842 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:48:11,842 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:48:11,842 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:12,005 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:48:12,005 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:48:12,005 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:48:12,005 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:48:12,006 INFO crypto-rebalancer: {"ts": 1759999692.0066805, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 415.09, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:12,007 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (415 ms)
INFO:     127.0.0.1:9266 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:48:12,007 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:48:12,008 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:48:12,008 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:48:12,016 INFO crypto-rebalancer: {"ts": 1759999692.0166876, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 10.12, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:12,016 INFO crypto-rebalancer: GET /balances/current -> 200 (10 ms)
INFO:     127.0.0.1:1213 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:48:17,598 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:48:17,600 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:48:17,600 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:48:17,607 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:48:17,681 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:48:17,681 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:48:17,681 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:48:17,681 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:17,775 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:48:17,775 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:48:17,775 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:48:17,775 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:48:17,775 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:48:17,775 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:48:17,775 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:48:17,775 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:48:17,775 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:17,887 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:48:17,887 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:48:17,887 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:48:17,887 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:48:17,887 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:48:17,887 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:48:17,887 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:18,060 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:48:18,060 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:48:18,060 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:48:18,060 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:48:18,061 INFO crypto-rebalancer: {"ts": 1759999698.061494, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 463.9, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:18,061 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (464 ms)
INFO:     127.0.0.1:8142 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:48:18,063 INFO crypto-rebalancer: {"ts": 1759999698.0631473, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 1.13, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:18,063 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:48:18,064 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:48:18,064 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:48:18,072 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (11 ms)
INFO:     127.0.0.1:6637 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:48:18,073 INFO crypto-rebalancer: {"ts": 1759999698.073288, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 11.31, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:18,073 INFO crypto-rebalancer: GET /balances/current -> 200 (11 ms)
INFO:     127.0.0.1:1100 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:48:28,920 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0541 (5.41%), cap_final=0.0541 (5.41%), var_state=normal, stale_state=normal, signals_age=265s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-2.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:28,920 INFO services.execution.governance: Alert cap reduction progressive clear: 1.0% remaining
2025-10-09 10:48:28,920 WARNING services.execution.governance: Auto progressive clear: 2.0% \u2192 1.0% (next clear in 30min)
2025-10-09 10:48:28,928 INFO services.alerts.alert_types: Alert triggered: AlertType.EXEC_COST_SPIKE severity AlertSeverity.S2 value 70
2025-10-09 10:48:28,928 WARNING services.alerts.alert_storage: Retrieved 1 active alerts from MEMORY (degraded mode)
2025-10-09 10:48:28,930 INFO services.execution.governance: Alert cap reduction ignored (cooldown until 2025-10-09 11:47:20.882754)
2025-10-09 10:48:28,930 INFO services.alerts.alert_engine: Systemic alert cap reduction not applied for ALR-20251009-104828-9f16f600 (cooldown ou plus forte r�duction active)
2025-10-09 10:48:28,930 WARNING services.alerts.alert_storage: Alert ALR-20251009-104828-9f16f600 stored in MEMORY (degraded mode)
2025-10-09 10:48:28,930 CRITICAL services.alerts.alert_storage: Alert system degraded: storing in memory only
2025-10-09 10:48:28,930 INFO services.alerts.alert_engine: Alert generated: ALR-20251009-104828-9f16f600 (AlertType.EXEC_COST_SPIKE:AlertSeverity.S2)
2025-10-09 10:48:28,930 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=265s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:28,930 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=265s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:28,930 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=265s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:28,930 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=265s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:28,931 WARNING services.alerts.alert_storage: Retrieved 2 active alerts from MEMORY (degraded mode)
2025-10-09 10:48:28,931 WARNING services.alerts.alert_storage: Retrieved 2 active alerts from MEMORY (degraded mode)
2025-10-09 10:48:28,931 ERROR services.alerts.alert_engine: Error broadcasting alert ALR-20251009-104828-9f16f600 via Phase 3B: 'Alert' object has no attribute 'message'
2025-10-09 10:48:41,583 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:48:41,584 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:48:41,584 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:48:41,590 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:48:41,659 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:48:41,659 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:48:41,659 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:48:41,659 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:41,745 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:48:41,745 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:48:41,746 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:48:41,746 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:48:41,746 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:48:41,746 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:48:41,746 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:48:41,746 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:48:41,746 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:41,835 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:48:41,835 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:48:41,835 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:48:41,835 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:48:41,835 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:48:41,835 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:48:41,835 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:42,018 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:48:42,018 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:48:42,018 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:48:42,018 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:48:42,019 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:48:42,020 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:48:42,020 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:48:42,028 INFO crypto-rebalancer: {"ts": 1759999722.0288458, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 447.24, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:42,028 INFO crypto-rebalancer: {"ts": 1759999722.028949, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 446.73, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:42,029 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (447 ms)
INFO:     127.0.0.1:7959 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:48:42,029 INFO crypto-rebalancer: GET /balances/current -> 200 (447 ms)
INFO:     127.0.0.1:3566 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:48:44,105 INFO services.streaming.realtime_engine: WebSocket disconnected: nav_badge, remaining: 0
INFO:     connection closed
2025-10-09 10:48:44,111 INFO crypto-rebalancer: {"ts": 1759999724.1114466, "method": "GET", "path": "/static/analytics-unified.html", "status": 304, "duration_ms": 1.19, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:44,111 INFO crypto-rebalancer: GET /static/analytics-unified.html -> 304 (1 ms)
INFO:     127.0.0.1:3566 - "GET /static/analytics-unified.html HTTP/1.1" 304 Not Modified
2025-10-09 10:48:44,148 INFO crypto-rebalancer: {"ts": 1759999724.1488023, "method": "GET", "path": "/.well-known/appspecific/com.chrome.devtools.json", "status": 404, "duration_ms": 0.96, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:44,148 INFO crypto-rebalancer: GET /.well-known/appspecific/com.chrome.devtools.json -> 404 (1 ms)
INFO:     127.0.0.1:3566 - "GET /.well-known/appspecific/com.chrome.devtools.json HTTP/1.1" 404 Not Found
INFO:     ('127.0.0.1', 13294) - "WebSocket /api/realtime/ws?client_id=nav_badge" [accepted]
2025-10-09 10:48:44,240 INFO services.streaming.realtime_engine: WebSocket connected: nav_badge, total connections: 1
INFO:     connection open
2025-10-09 10:48:44,242 INFO crypto-rebalancer: {"ts": 1759999724.2426124, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 1.0, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:3566 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:48:44,243 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (1 ms)
2025-10-09 10:48:44,246 INFO crypto-rebalancer: {"ts": 1759999724.2467659, "method": "GET", "path": "/config/users.json", "status": 200, "duration_ms": 4.22, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:7959 - "GET /config/users.json HTTP/1.1" 200 OK
2025-10-09 10:48:44,247 INFO crypto-rebalancer: GET /config/users.json -> 200 (4 ms)
2025-10-09 10:48:44,250 INFO api.crypto_toolbox_endpoints: \U0001f504 Scraping fresh data...
2025-10-09 10:48:44,250 INFO api.deps: Active user: jack
2025-10-09 10:48:44,251 WARNING api.crypto_toolbox_endpoints: \u26a0\ufe0f Browser not connected, re-launching...
2025-10-09 10:48:44,251 INFO api.crypto_toolbox_endpoints: \U0001f3ad Initializing Playwright browser...
2025-10-09 10:48:44,251 ERROR asyncio: Task exception was never retrieved
future: <Task finished name='Task-732' coro=<Connection.run() done, defined at D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py:303> exception=NotImplementedError()>
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_connection.py", line 310, in run
    await self._transport.connect()
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 133, in connect
    raise exc
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:48:44,256 ERROR api.crypto_toolbox_endpoints: \u274c Failed to launch Playwright browser: 
2025-10-09 10:48:44,256 ERROR api.crypto_toolbox_endpoints: \u274c Crypto-toolbox scraping error
Traceback (most recent call last):
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 377, in get_crypto_toolbox_data
    return await _get_data(force=force)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 345, in _get_data
    data = await _scrape_crypto_toolbox()
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 219, in _scrape_crypto_toolbox
    browser = await _ensure_browser()
              ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 166, in _ensure_browser
    await startup_playwright()
  File "D:\Python\crypto-rebal-starter\api\crypto_toolbox_endpoints.py", line 109, in startup_playwright
    _playwright_instance = await async_playwright().start()
                           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 51, in start
    return await self.__aenter__()
           ^^^^^^^^^^^^^^^^^^^^^^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\async_api\_context_manager.py", line 46, in __aenter__
    playwright = AsyncPlaywright(next(iter(done)).result())
                                 ~~~~~~~~~~~~~~~~~~~~~~~^^
  File "D:\Python\crypto-rebal-starter\.venv\Lib\site-packages\playwright\_impl\_transport.py", line 120, in connect
    self._proc = await asyncio.create_subprocess_exec(
                 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<9 lines>...
    )
    ^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\subprocess.py", line 224, in create_subprocess_exec
    transport, protocol = await loop.subprocess_exec(
                          ^^^^^^^^^^^^^^^^^^^^^^^^^^^
    ...<3 lines>...
        stderr=stderr, **kwds)
        ^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 1802, in subprocess_exec
    transport = await self._make_subprocess_transport(
                ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        protocol, popen_args, False, stdin, stdout, stderr,
        ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
        bufsize, **kwargs)
        ^^^^^^^^^^^^^^^^^^
  File "C:\Users\jacks\AppData\Local\Programs\Python\Python313\Lib\asyncio\base_events.py", line 539, in _make_subprocess_transport
    raise NotImplementedError
NotImplementedError
2025-10-09 10:48:44,259 INFO api.deps: Active user: jack
2025-10-09 10:48:44,259 INFO crypto-rebalancer: {"ts": 1759999724.259761, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 10.51, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:44,260 INFO crypto-rebalancer: {"ts": 1759999724.2601535, "method": "GET", "path": "/api/crypto-toolbox", "status": 502, "duration_ms": 10.05, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:44,260 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:48:44,262 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:48:44,262 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:48:44,263 INFO crypto-rebalancer: GET /api/users/sources -> 200 (14 ms)
INFO:     127.0.0.1:2545 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:48:44,263 INFO crypto-rebalancer: GET /api/crypto-toolbox -> 502 (14 ms)
INFO:     127.0.0.1:1346 - "GET /api/crypto-toolbox HTTP/1.1" 502 Bad Gateway
2025-10-09 10:48:44,264 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=281s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:44,407 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:48:44,409 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:48:44,409 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:48:44,416 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 365 days
2025-10-09 10:48:44,568 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:48:44,568 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:48:44,568 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:48:44,568 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:44,663 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 85.0
2025-10-09 10:48:44,663 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:48:44,663 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:48:44,663 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:48:44,663 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:48:44,663 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:48:44,663 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:48:44,663 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:48:44,663 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:44,858 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:48:44,858 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=85.0, penalties=0.0, final=85.0
2025-10-09 10:48:44,858 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:48:44,859 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:48:44,859 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:48:44,859 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:48:44,859 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:45,050 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:48:45,050 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.33, Vol=0.20, MaxDD=-10.64%, RiskScore=85.0, RiskStructural=47.0 [Dual-Window: FI fallback only]
2025-10-09 10:48:45,050 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:48:45,051 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 85.0, 'risk_score_v2': 85.0, 'sharpe_legacy': 1.3262890739554856, 'sharpe_v2': 1.3262890739554856, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 47.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 5.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:48:45,052 WARNING services.alerts.alert_storage: Retrieved 2 active alerts from MEMORY (degraded mode)
2025-10-09 10:48:45,053 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 192 assets over 365 days
2025-10-09 10:48:45,224 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:48:45,224 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:48:45,224 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:48:45,224 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:45,337 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 90.0
2025-10-09 10:48:45,337 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:48:45,337 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 85 points available)
2025-10-09 10:48:45,337 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 85 points available)
2025-10-09 10:48:45,337 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 85 points available)
2025-10-09 10:48:45,337 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 85 points available)
2025-10-09 10:48:45,337 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:48:45,337 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:48:45,337 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:45,438 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 85d (no long-term cohort)
2025-10-09 10:48:45,438 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=90.0, penalties=0.0, final=90.0
2025-10-09 10:48:45,438 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:48:45,438 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:48:45,438 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:48:45,438 INFO services.portfolio_metrics: Calculating portfolio metrics for 85 data points
2025-10-09 10:48:45,438 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:45,632 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=82.63513203036524
2025-10-09 10:48:45,632 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=1.62, Vol=0.20, MaxDD=-10.43%, RiskScore=90.0, RiskStructural=52.0 [Dual-Window: FI fallback only]
2025-10-09 10:48:45,632 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=jack, source=cointracking_api, taxonomy=v2:6af8d6a3
2025-10-09 10:48:45,632 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 90.0, 'risk_score_v2': 90.0, 'sharpe_legacy': 1.6219900278383605, 'sharpe_v2': 1.6219900278383605, 'portfolio_structure_score': 82.63513203036524, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6760719404665989, 'gri': 16.688796029168152, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 17.36486796963475, 'final_score': 82.63513203036524, 'inputs': {'hhi': 0.18523343614256982, 'memes_pct': 0.016901798511664973, 'gri': 3.3377592058336307, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 52.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 10.0, 'risk_adjusted_perf': 10.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:48:45,634 INFO crypto-rebalancer: {"ts": 1759999725.634399, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 1375.69, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:45,635 INFO crypto-rebalancer: {"ts": 1759999725.6353528, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 1381.59, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:45,635 INFO crypto-rebalancer: {"ts": 1759999725.6355271, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 1381.82, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:45,635 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (1379 ms)
INFO:     127.0.0.1:3566 - "GET /api/risk/dashboard?min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:48:45,636 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (1384 ms)
INFO:     127.0.0.1:14218 - "GET /api/alerts/active?source=cointracking_api&pricing=local&min_usd=1&include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:48:45,636 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (1384 ms)
INFO:     127.0.0.1:11069 - "GET /api/risk/dashboard?source=cointracking_api&pricing=local&min_usd=1&price_history_days=365&lookback_days=90 HTTP/1.1" 200 OK
2025-10-09 10:48:45,636 INFO crypto-rebalancer: {"ts": 1759999725.636727, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 1377.71, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:45,637 INFO crypto-rebalancer: GET /taxonomy -> 200 (1378 ms)
INFO:     127.0.0.1:7959 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:48:45,642 INFO crypto-rebalancer: {"ts": 1759999725.6424673, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 1.28, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:45,642 INFO crypto-rebalancer: GET /taxonomy -> 200 (1 ms)
INFO:     127.0.0.1:7959 - "GET /taxonomy HTTP/1.1" 200 OK
2025-10-09 10:48:45,833 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:48:45,834 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:48:45,834 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:48:45,846 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:48:45,849 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:48:45,849 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:48:45,855 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:48:45,934 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:48:45,934 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:48:45,934 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:48:45,934 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:46,055 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:48:46,055 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:48:46,055 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:48:46,055 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:48:46,055 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:48:46,055 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:48:46,055 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:48:46,055 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:48:46,055 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:46,150 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:48:46,150 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:48:46,150 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:48:46,150 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:48:46,150 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:48:46,150 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:48:46,151 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:48:46,470 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:48:46,471 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:48:46,471 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:48:46,471 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:48:46,473 INFO httpx: HTTP Request: GET https://api.coingecko.com/api/v3/global "HTTP/1.1 200 OK"
2025-10-09 10:48:46,474 INFO crypto-rebalancer: {"ts": 1759999726.4749334, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 642.39, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:46,475 INFO crypto-rebalancer: {"ts": 1759999726.4750495, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 643.03, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:46,638 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=283s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:46,656 INFO crypto-rebalancer: GET /balances/current -> 200 (824 ms)
INFO:     127.0.0.1:11069 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:48:46,657 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (825 ms)
INFO:     127.0.0.1:7959 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:48:46,658 INFO api.deps: Active user: jack
2025-10-09 10:48:46,658 INFO crypto-rebalancer: {"ts": 1759999726.6587474, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 184.24, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:46,658 INFO crypto-rebalancer: {"ts": 1759999726.6588407, "method": "GET", "path": "/api/ml/debug/pipeline-info", "status": 200, "duration_ms": 184.02, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:46,658 INFO crypto-rebalancer: {"ts": 1759999726.658895, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 184.02, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:46,662 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (188 ms)
INFO:     127.0.0.1:2545 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:48:46,662 INFO crypto-rebalancer: GET /api/ml/debug/pipeline-info -> 200 (188 ms)
INFO:     127.0.0.1:14218 - "GET /api/ml/debug/pipeline-info HTTP/1.1" 200 OK
2025-10-09 10:48:46,662 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (188 ms)
INFO:     127.0.0.1:3566 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:48:46,663 INFO crypto-rebalancer: {"ts": 1759999726.6635592, "method": "GET", "path": "/api/users/sources", "status": 200, "duration_ms": 189.12, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:46,664 INFO crypto-rebalancer: GET /api/users/sources -> 200 (191 ms)
INFO:     127.0.0.1:1346 - "GET /api/users/sources HTTP/1.1" 200 OK
2025-10-09 10:48:46,665 INFO crypto-rebalancer: {"ts": 1759999726.6656308, "method": "GET", "path": "/favicon.ico", "status": 200, "duration_ms": 2.39, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:46,666 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=283s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:46,666 INFO crypto-rebalancer: GET /favicon.ico -> 200 (3 ms)
INFO:     127.0.0.1:7959 - "GET /favicon.ico HTTP/1.1" 200 OK
2025-10-09 10:48:46,667 INFO crypto-rebalancer: {"ts": 1759999726.6672611, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 1.98, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:46,668 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (3 ms)
INFO:     127.0.0.1:11069 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:48:46,669 INFO crypto-rebalancer: {"ts": 1759999726.6694572, "method": "GET", "path": "/api/ml/volatility/predict/BTC", "status": 200, "duration_ms": 2.33, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:46,671 INFO crypto-rebalancer: GET /api/ml/volatility/predict/BTC -> 200 (4 ms)
INFO:     127.0.0.1:1346 - "GET /api/ml/volatility/predict/BTC?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:48:46,671 INFO api.deps: Active user: jack
2025-10-09 10:48:46,675 INFO crypto-rebalancer: {"ts": 1759999726.675381, "method": "GET", "path": "/api/users/settings", "status": 200, "duration_ms": 6.29, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:46,676 INFO crypto-rebalancer: GET /api/users/settings -> 200 (7 ms)
INFO:     127.0.0.1:3566 - "GET /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:48:46,677 INFO crypto-rebalancer: {"ts": 1759999726.6772177, "method": "GET", "path": "/api/ml/volatility/predict/ETH", "status": 200, "duration_ms": 1.89, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:46,677 INFO crypto-rebalancer: GET /api/ml/volatility/predict/ETH -> 200 (2 ms)
INFO:     127.0.0.1:1346 - "GET /api/ml/volatility/predict/ETH?horizon_days=1 HTTP/1.1" 200 OK
2025-10-09 10:48:46,905 INFO api.deps: Active user: jack
2025-10-09 10:48:46,906 INFO api.user_settings_endpoints: Settings saved for user jack: 17 keys
2025-10-09 10:48:46,907 INFO crypto-rebalancer: {"ts": 1759999726.9071596, "method": "PUT", "path": "/api/users/settings", "status": 200, "duration_ms": 226.05, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:46,908 INFO crypto-rebalancer: PUT /api/users/settings -> 200 (227 ms)
INFO:     127.0.0.1:1346 - "PUT /api/users/settings HTTP/1.1" 200 OK
2025-10-09 10:48:46,908 INFO crypto-rebalancer: {"ts": 1759999726.9089642, "method": "GET", "path": "/api/config/data-source", "status": 200, "duration_ms": 1.84, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:48:46,909 INFO crypto-rebalancer: GET /api/config/data-source -> 200 (2 ms)
INFO:     127.0.0.1:8163 - "GET /api/config/data-source HTTP/1.1" 200 OK
2025-10-09 10:48:46,910 INFO httpx: HTTP Request: GET http://127.0.0.1:8000/api/config/data-source "HTTP/1.1 200 OK"
2025-10-09 10:48:46,910 INFO services.ml.orchestrator: Using data source from config API: cointracking
2025-10-09 10:48:46,911 INFO crypto-rebalancer: {"ts": 1759999726.9114, "method": "GET", "path": "/api/ml/regime/current", "status": 200, "duration_ms": 229.01, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:46,911 INFO api.market_endpoints: Fetching market prices for 10 symbols over 30 days
2025-10-09 10:48:46,911 WARNING api.market_endpoints: BTC data not available for relative strength calculation
2025-10-09 10:48:46,911 INFO api.market_endpoints: Market prices returned for 10 symbols
2025-10-09 10:48:46,912 INFO crypto-rebalancer: GET /api/ml/regime/current -> 200 (229 ms)
INFO:     127.0.0.1:3566 - "GET /api/ml/regime/current HTTP/1.1" 200 OK
2025-10-09 10:48:46,912 INFO crypto-rebalancer: {"ts": 1759999726.9124305, "method": "GET", "path": "/api/market/prices", "status": 200, "duration_ms": 1.13, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:48:46,912 INFO crypto-rebalancer: GET /api/market/prices -> 200 (1 ms)
INFO:     127.0.0.1:8164 - "GET /api/market/prices?days=30 HTTP/1.1" 200 OK
2025-10-09 10:48:46,913 INFO httpx: HTTP Request: GET http://localhost:8000/api/market/prices?days=30 "HTTP/1.1 200 OK"
2025-10-09 10:48:47,112 INFO crypto-rebalancer: {"ts": 1759999727.11199, "method": "GET", "path": "/api/ml/sentiment/fear-greed", "status": 200, "duration_ms": 0.66, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:47,112 INFO crypto-rebalancer: GET /api/ml/sentiment/fear-greed -> 200 (1 ms)
INFO:     127.0.0.1:3566 - "GET /api/ml/sentiment/fear-greed?days=1 HTTP/1.1" 200 OK
2025-10-09 10:48:47,372 INFO api.analytics_endpoints: Calculating market breadth metrics
2025-10-09 10:48:47,372 ERROR api.analytics_endpoints: Error calculating market breadth: No module named 'api.balances'
2025-10-09 10:48:47,372 INFO crypto-rebalancer: {"ts": 1759999727.372724, "method": "GET", "path": "/api/analytics/market-breadth", "status": 200, "duration_ms": 0.9, "client_ip": "127.0.0.1", "user_agent": "python-httpx/0.28.1"}
2025-10-09 10:48:47,372 INFO crypto-rebalancer: GET /api/analytics/market-breadth -> 200 (1 ms)
INFO:     127.0.0.1:8166 - "GET /api/analytics/market-breadth HTTP/1.1" 200 OK
2025-10-09 10:48:47,373 INFO httpx: HTTP Request: GET http://localhost:8000/api/analytics/market-breadth "HTTP/1.1 200 OK"
2025-10-09 10:48:47,373 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:48:47,373 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:48:47,374 INFO crypto-rebalancer: {"ts": 1759999727.3744464, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 3114.15, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:47,374 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (3114 ms)
INFO:     127.0.0.1:3945 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:48:47,700 INFO crypto-rebalancer: {"ts": 1759999727.7002978, "method": "GET", "path": "/static/components/UnifiedInsights.js", "status": 200, "duration_ms": 6.24, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:47,700 INFO crypto-rebalancer: GET /static/components/UnifiedInsights.js -> 200 (6 ms)
INFO:     127.0.0.1:3945 - "GET /static/components/UnifiedInsights.js?v=2025-10-09T08:48:47.692Z HTTP/1.1" 200 OK
2025-10-09 10:48:47,713 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=284s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:47,713 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:48:47,714 INFO crypto-rebalancer: {"ts": 1759999727.714022, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 0.87, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:47,714 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:3945 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:48:47,717 INFO api.deps: Active user: jack
2025-10-09 10:48:47,717 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:48:47,720 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:48:47,720 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:48:47,725 INFO crypto-rebalancer: {"ts": 1759999727.7257452, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 8.77, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:47,726 INFO crypto-rebalancer: GET /balances/current -> 200 (9 ms)
INFO:     127.0.0.1:3945 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:48:47,864 INFO crypto-rebalancer: {"ts": 1759999727.8647704, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.1, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:47,865 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:3945 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:48:48,891 INFO api.deps: Active user: jack
2025-10-09 10:48:48,891 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:48:48,894 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:48:48,894 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:48:48,897 INFO crypto-rebalancer: {"ts": 1759999728.8978095, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 6.88, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:48,898 INFO crypto-rebalancer: GET /balances/current -> 200 (7 ms)
INFO:     127.0.0.1:3566 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:48:48,898 INFO crypto-rebalancer: {"ts": 1759999728.898819, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 8.0, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:48,899 INFO crypto-rebalancer: GET /taxonomy -> 200 (8 ms)
INFO:     127.0.0.1:3945 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:48:48,909 INFO crypto-rebalancer: {"ts": 1759999728.9095109, "method": "GET", "path": "/static/components/decision-index-panel.js", "status": 200, "duration_ms": 4.04, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:48,909 INFO crypto-rebalancer: GET /static/components/decision-index-panel.js -> 200 (4 ms)
INFO:     127.0.0.1:3945 - "GET /static/components/decision-index-panel.js?v=1759999728903 HTTP/1.1" 200 OK
2025-10-09 10:48:48,919 INFO crypto-rebalancer: {"ts": 1759999728.9195652, "method": "GET", "path": "/static/core/unified-insights-v2.js", "status": 200, "duration_ms": 5.56, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:48,919 INFO crypto-rebalancer: GET /static/core/unified-insights-v2.js -> 200 (5 ms)
INFO:     127.0.0.1:3945 - "GET /static/core/unified-insights-v2.js?v=1759999728903 HTTP/1.1" 200 OK
2025-10-09 10:48:48,925 INFO crypto-rebalancer: {"ts": 1759999728.9258668, "method": "GET", "path": "/static/utils/di-history.js", "status": 200, "duration_ms": 2.22, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:48,926 INFO crypto-rebalancer: GET /static/utils/di-history.js -> 200 (2 ms)
INFO:     127.0.0.1:3945 - "GET /static/utils/di-history.js?v=1759999728903 HTTP/1.1" 200 OK
2025-10-09 10:48:48,930 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=285s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:48,930 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:48:48,931 INFO crypto-rebalancer: {"ts": 1759999728.931126, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.37, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:48,931 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:3945 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:48:48,941 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=285s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:48,941 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:48:48,942 INFO crypto-rebalancer: {"ts": 1759999728.9421914, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 0.87, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:48,942 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:3945 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:48:58,055 INFO crypto-rebalancer: {"ts": 1759999738.0552466, "method": "GET", "path": "/api/ml/sentiment/fear-greed", "status": 200, "duration_ms": 1.11, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,055 INFO crypto-rebalancer: GET /api/ml/sentiment/fear-greed -> 200 (1 ms)
INFO:     127.0.0.1:10520 - "GET /api/ml/sentiment/fear-greed?source=cointracking_api&pricing=local&min_usd=1&days=1 HTTP/1.1" 200 OK
2025-10-09 10:48:58,058 INFO crypto-rebalancer: {"ts": 1759999738.0584934, "method": "GET", "path": "/api/ml/sentiment/fear-greed", "status": 200, "duration_ms": 1.01, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,059 INFO crypto-rebalancer: GET /api/ml/sentiment/fear-greed -> 200 (1 ms)
INFO:     127.0.0.1:10520 - "GET /api/ml/sentiment/fear-greed?source=cointracking_api&pricing=local&min_usd=1&days=1 HTTP/1.1" 200 OK
2025-10-09 10:48:58,063 INFO api.deps: Active user: jack
2025-10-09 10:48:58,063 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:48:58,068 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:48:58,068 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:48:58,073 INFO crypto-rebalancer: {"ts": 1759999738.0729816, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 10.29, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,073 INFO crypto-rebalancer: GET /balances/current -> 200 (10 ms)
INFO:     127.0.0.1:10520 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:48:58,074 INFO api.deps: Active user: jack
2025-10-09 10:48:58,074 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:48:58,077 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:48:58,077 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:48:58,081 INFO crypto-rebalancer: {"ts": 1759999738.0810883, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 6.95, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,081 INFO crypto-rebalancer: GET /balances/current -> 200 (7 ms)
INFO:     127.0.0.1:12341 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:48:58,594 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=295s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:58,594 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:48:58,594 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:48:58,594 INFO crypto-rebalancer: {"ts": 1759999738.5946553, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 0.89, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,594 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (1 ms)
INFO:     127.0.0.1:12341 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:48:58,603 INFO crypto-rebalancer: {"ts": 1759999738.603722, "method": "GET", "path": "/static/components/UnifiedInsights.js", "status": 200, "duration_ms": 5.38, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,604 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=295s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:58,604 INFO crypto-rebalancer: GET /static/components/UnifiedInsights.js -> 200 (6 ms)
INFO:     127.0.0.1:12341 - "GET /static/components/UnifiedInsights.js?v=2025-10-09T08:48:58.596Z HTTP/1.1" 200 OK
2025-10-09 10:48:58,605 INFO crypto-rebalancer: {"ts": 1759999738.6057239, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 2.04, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,606 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (2 ms)
INFO:     127.0.0.1:10520 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:48:58,612 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=295s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:58,612 WARNING api.execution_endpoints: Error building unified signals: 1 validation error for CycleSignals
btc_cycle.position
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='mid_cycle', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:48:58,612 WARNING api.execution_endpoints: Error generating IA suggestion: 3 validation errors for SuggestionIA
targets.0.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='BTC', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.1.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='ETH', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
targets.2.symbol
  Input should be a valid number, unable to parse string as a number [type=float_parsing, input_value='SOL', input_type=str]
    For further information visit https://errors.pydantic.dev/2.9/v/float_parsing
2025-10-09 10:48:58,613 INFO crypto-rebalancer: {"ts": 1759999738.6130443, "method": "GET", "path": "/execution/governance/state", "status": 200, "duration_ms": 1.05, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,613 INFO crypto-rebalancer: GET /execution/governance/state -> 200 (1 ms)
INFO:     127.0.0.1:12341 - "GET /execution/governance/state HTTP/1.1" 200 OK
2025-10-09 10:48:58,617 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=295s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:58,617 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:48:58,617 INFO crypto-rebalancer: {"ts": 1759999738.6176207, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.11, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,617 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:12341 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:48:58,619 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=295s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:58,620 INFO crypto-rebalancer: {"ts": 1759999738.6201298, "method": "GET", "path": "/execution/governance/signals", "status": 200, "duration_ms": 0.91, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,620 INFO crypto-rebalancer: GET /execution/governance/signals -> 200 (1 ms)
INFO:     127.0.0.1:12341 - "GET /execution/governance/signals HTTP/1.1" 200 OK
2025-10-09 10:48:58,623 INFO api.deps: Active user: jack
2025-10-09 10:48:58,624 INFO crypto-rebalancer: Resolving balances for user 'jack' with source 'cointracking_api'
2025-10-09 10:48:58,627 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user jack
2025-10-09 10:48:58,627 INFO crypto-rebalancer: \U0001f3af Effective source for user 'jack': cointracking_api
2025-10-09 10:48:58,637 INFO crypto-rebalancer: {"ts": 1759999738.637568, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 14.46, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,638 INFO crypto-rebalancer: GET /balances/current -> 200 (15 ms)
INFO:     127.0.0.1:12341 - "GET /balances/current?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:48:58,639 WARNING services.alerts.alert_storage: Retrieved 2 active alerts from MEMORY (degraded mode)
2025-10-09 10:48:58,639 INFO crypto-rebalancer: {"ts": 1759999738.6397364, "method": "GET", "path": "/api/alerts/active", "status": 200, "duration_ms": 2.2, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,639 INFO crypto-rebalancer: GET /api/alerts/active -> 200 (2 ms)
INFO:     127.0.0.1:10520 - "GET /api/alerts/active?include_snoozed=false HTTP/1.1" 200 OK
2025-10-09 10:48:58,657 INFO crypto-rebalancer: {"ts": 1759999738.6576297, "method": "GET", "path": "/taxonomy", "status": 200, "duration_ms": 2.11, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,657 INFO crypto-rebalancer: GET /taxonomy -> 200 (2 ms)
INFO:     127.0.0.1:10520 - "GET /taxonomy?source=cointracking_api&pricing=local&min_usd=1 HTTP/1.1" 200 OK
2025-10-09 10:48:58,668 INFO crypto-rebalancer: {"ts": 1759999738.6686816, "method": "GET", "path": "/static/components/decision-index-panel.js", "status": 200, "duration_ms": 4.43, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,668 INFO crypto-rebalancer: GET /static/components/decision-index-panel.js -> 200 (4 ms)
INFO:     127.0.0.1:10520 - "GET /static/components/decision-index-panel.js?v=1759999738662 HTTP/1.1" 200 OK
2025-10-09 10:48:58,678 INFO crypto-rebalancer: {"ts": 1759999738.678611, "method": "GET", "path": "/static/core/unified-insights-v2.js", "status": 200, "duration_ms": 5.92, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,678 INFO crypto-rebalancer: GET /static/core/unified-insights-v2.js -> 200 (6 ms)
INFO:     127.0.0.1:10520 - "GET /static/core/unified-insights-v2.js?v=1759999738662 HTTP/1.1" 200 OK
2025-10-09 10:48:58,685 INFO crypto-rebalancer: {"ts": 1759999738.6851516, "method": "GET", "path": "/static/utils/di-history.js", "status": 200, "duration_ms": 2.5, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,685 INFO crypto-rebalancer: GET /static/utils/di-history.js -> 200 (2 ms)
INFO:     127.0.0.1:10520 - "GET /static/utils/di-history.js?v=1759999738662 HTTP/1.1" 200 OK
2025-10-09 10:48:58,690 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=295s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:58,690 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:48:58,690 INFO crypto-rebalancer: {"ts": 1759999738.6906831, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.48, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,690 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:10520 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:48:58,702 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=295s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:48:58,702 ERROR api.unified_ml_endpoints: Error in sentiment analysis for BTC: unsupported operand type(s) for *: 'dict' and 'int'
2025-10-09 10:48:58,703 INFO crypto-rebalancer: {"ts": 1759999738.7032883, "method": "GET", "path": "/api/ml/sentiment/symbol/BTC", "status": 200, "duration_ms": 1.42, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:48:58,703 INFO crypto-rebalancer: GET /api/ml/sentiment/symbol/BTC -> 200 (1 ms)
INFO:     127.0.0.1:10520 - "GET /api/ml/sentiment/symbol/BTC?days=1 HTTP/1.1" 200 OK
2025-10-09 10:49:16,587 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:49:16,589 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:49:16,589 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:49:16,595 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:49:16,663 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:49:16,663 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:49:16,663 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:49:16,663 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:49:16,753 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:49:16,753 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:49:16,753 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:49:16,753 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:49:16,753 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:49:16,753 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:49:16,753 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:49:16,753 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:49:16,753 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:49:16,842 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:49:16,842 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:49:16,842 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:49:16,842 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:49:16,842 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:49:16,842 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:49:16,842 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:49:17,003 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:49:17,003 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:49:17,003 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:49:17,003 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:49:17,004 INFO crypto-rebalancer: {"ts": 1759999757.0046818, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 417.87, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:4184 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:49:17,005 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (418 ms)
2025-10-09 10:49:17,005 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:49:17,006 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:49:17,006 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:49:17,014 INFO crypto-rebalancer: {"ts": 1759999757.0149412, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 10.36, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:49:17,015 INFO crypto-rebalancer: GET /balances/current -> 200 (10 ms)
INFO:     127.0.0.1:14720 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:49:17,595 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:49:17,598 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:49:17,598 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:49:17,607 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:49:17,697 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:49:17,697 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:49:17,697 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:49:17,697 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:49:17,796 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:49:17,796 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:49:17,796 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:49:17,796 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:49:17,796 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:49:17,796 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:49:17,796 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:49:17,796 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:49:17,796 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:49:17,912 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:49:17,912 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:49:17,912 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:49:17,912 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:49:17,912 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:49:17,912 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:49:17,913 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:49:18,096 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:49:18,096 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:49:18,096 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:49:18,096 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:49:18,098 INFO crypto-rebalancer: {"ts": 1759999758.0980797, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 503.95, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
INFO:     127.0.0.1:14720 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:49:18,098 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (504 ms)
2025-10-09 10:49:18,099 INFO crypto-rebalancer: {"ts": 1759999758.0994391, "method": "GET", "path": "/api/phase3/intelligence/human-decisions", "status": 200, "duration_ms": 1.4, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:49:18,099 INFO crypto-rebalancer: GET /api/phase3/intelligence/human-decisions -> 200 (1 ms)
INFO:     127.0.0.1:4184 - "GET /api/phase3/intelligence/human-decisions HTTP/1.1" 200 OK
2025-10-09 10:49:18,100 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:49:18,101 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:49:18,101 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:49:18,110 INFO crypto-rebalancer: {"ts": 1759999758.1102548, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 11.19, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:49:18,110 INFO crypto-rebalancer: GET /balances/current -> 200 (11 ms)
INFO:     127.0.0.1:6395 - "GET /balances/current HTTP/1.1" 200 OK
2025-10-09 10:49:30,696 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0641 (6.41%), cap_final=0.0641 (6.41%), var_state=normal, stale_state=normal, signals_age=327s, prudent_mode=True, mode=Slow [ALERT_REDUCTION(-1.0%), HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:49:30,696 INFO services.execution.governance: Alert cap reduction progressive clear: 0.0% remaining
2025-10-09 10:49:30,696 WARNING services.execution.governance: Auto progressive clear: 1.0% \u2192 0.0% (next clear in 30min)
2025-10-09 10:49:30,696 INFO services.alerts.alert_types: Alert triggered: AlertType.VOL_Q90_CROSS severity AlertSeverity.S3 value 0.5533333333333333
2025-10-09 10:49:30,696 WARNING services.alerts.alert_storage: Retrieved 2 active alerts from MEMORY (degraded mode)
2025-10-09 10:49:30,697 WARNING services.alerts.alert_storage: Alert ALR-20251009-104930-6f41983a stored in MEMORY (degraded mode)
2025-10-09 10:49:30,697 CRITICAL services.alerts.alert_storage: Alert system degraded: storing in memory only
2025-10-09 10:49:30,697 INFO services.alerts.alert_engine: Alert generated: ALR-20251009-104930-6f41983a (AlertType.VOL_Q90_CROSS:AlertSeverity.S3)
2025-10-09 10:49:30,706 INFO services.alerts.alert_types: Alert triggered: AlertType.DECISION_DROP severity AlertSeverity.S1 value 0.16338541666666673
2025-10-09 10:49:30,706 WARNING services.alerts.alert_storage: Retrieved 3 active alerts from MEMORY (degraded mode)
2025-10-09 10:49:30,707 WARNING services.alerts.alert_storage: Alert ALR-20251009-104930-59309a05 stored in MEMORY (degraded mode)
2025-10-09 10:49:30,707 CRITICAL services.alerts.alert_storage: Alert system degraded: storing in memory only
2025-10-09 10:49:30,707 INFO services.alerts.alert_engine: Alert generated: ALR-20251009-104930-59309a05 (AlertType.DECISION_DROP:AlertSeverity.S1)
2025-10-09 10:49:30,707 INFO services.alerts.alert_types: Alert triggered: AlertType.EXEC_COST_SPIKE severity AlertSeverity.S2 value 70
2025-10-09 10:49:30,707 WARNING services.alerts.alert_storage: Retrieved 4 active alerts from MEMORY (degraded mode)
2025-10-09 10:49:30,708 INFO services.execution.governance: Alert cap reduction ignored (cooldown until 2025-10-09 11:47:20.882754)
2025-10-09 10:49:30,708 INFO services.alerts.alert_engine: Systemic alert cap reduction not applied for ALR-20251009-104930-6622cc80 (cooldown ou plus forte r�duction active)
2025-10-09 10:49:30,708 WARNING services.alerts.alert_storage: Alert ALR-20251009-104930-6622cc80 stored in MEMORY (degraded mode)
2025-10-09 10:49:30,708 CRITICAL services.alerts.alert_storage: Alert system degraded: storing in memory only
2025-10-09 10:49:30,708 INFO services.alerts.alert_engine: Alert generated: ALR-20251009-104930-6622cc80 (AlertType.EXEC_COST_SPIKE:AlertSeverity.S2)
2025-10-09 10:49:30,709 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=327s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:49:30,709 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=327s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:49:30,709 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=327s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:49:30,709 INFO services.execution.governance: [CAP_FLOW] contradiction=0.475, confidence=0.782, cap_raw=0.0741 (7.41%), cap_smoothed=0.0741 (7.41%), cap_engine=0.0741 (7.41%), cap_stale=N/A, cap_error=N/A, cap_alert=0.0741 (7.41%), cap_final=0.0741 (7.41%), var_state=normal, stale_state=normal, signals_age=327s, prudent_mode=True, mode=Slow [HYSTERESIS_PRUDENT_LEGACY]
2025-10-09 10:49:30,709 WARNING services.alerts.alert_storage: Retrieved 5 active alerts from MEMORY (degraded mode)
2025-10-09 10:49:30,709 WARNING services.alerts.alert_storage: Retrieved 5 active alerts from MEMORY (degraded mode)
2025-10-09 10:49:30,709 ERROR services.alerts.alert_engine: Error broadcasting alert ALR-20251009-104930-6f41983a via Phase 3B: 'Alert' object has no attribute 'message'
2025-10-09 10:49:30,710 ERROR services.alerts.alert_engine: Error broadcasting alert ALR-20251009-104930-59309a05 via Phase 3B: 'Alert' object has no attribute 'message'
2025-10-09 10:49:30,710 ERROR services.alerts.alert_engine: Error broadcasting alert ALR-20251009-104930-6622cc80 via Phase 3B: 'Alert' object has no attribute 'message'
2025-10-09 10:49:46,584 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:49:46,586 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:49:46,586 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:49:46,592 INFO api.risk_endpoints: \U0001f3af Using centralized metrics service for 183 assets over 30 days
2025-10-09 10:49:46,662 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: risk_version received = 'v2_shadow', use_dual_window = True
2025-10-09 10:49:46,662 INFO api.risk_endpoints: \U0001f9ea SHADOW MODE DEBUG: compute_legacy = True, compute_v2 = True
2025-10-09 10:49:46,662 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:49:46,662 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:49:46,752 INFO api.risk_endpoints: \U0001f4ca LEGACY Risk Score calculated: 75.0
2025-10-09 10:49:46,752 INFO services.portfolio_metrics: \U0001f50d Dual Window: min_history=180d, min_coverage=80.0%, min_assets=5
2025-10-09 10:49:46,752 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 365d (only 61 points available)
2025-10-09 10:49:46,752 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 180d (only 61 points available)
2025-10-09 10:49:46,752 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 120d (only 61 points available)
2025-10-09 10:49:46,752 WARNING services.portfolio_metrics: \u23ed\ufe0f  Skip cascade 90d (only 61 points available)
2025-10-09 10:49:46,752 WARNING services.portfolio_metrics: \u26a0\ufe0f  No valid long-term cohort found, using full intersection as fallback
2025-10-09 10:49:46,752 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:49:46,752 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:49:46,841 WARNING api.risk_endpoints: \u26a0\ufe0f  Using FULL INTERSECTION only: 61d (no long-term cohort)
2025-10-09 10:49:46,841 INFO api.risk_endpoints: \U0001f4ca Risk Score V2 (Full only): base=75.0, penalties=0.0, final=75.0
2025-10-09 10:49:46,841 INFO api.risk_endpoints: \u26a0\ufe0f  Penalties: excluded=0.0, young_memes=0.0 (0 memes)
2025-10-09 10:49:46,841 ERROR api.risk_endpoints: \u274c Dual window V2 calculation failed: 'PortfolioMetrics' object has no attribute '_replace'
2025-10-09 10:49:46,841 WARNING api.risk_endpoints: \u26a0\ufe0f  V2 requested but failed, falling back to legacy calculation
2025-10-09 10:49:46,841 INFO services.portfolio_metrics: Calculating portfolio metrics for 61 data points
2025-10-09 10:49:46,841 INFO services.portfolio_metrics: Portfolio weights: 132 assets, total weight after normalization: 1.000
2025-10-09 10:49:47,000 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: About to create dashboard_data with risk_version=v2_shadow, active_version=legacy, structural_score_v2=83.13489929481241
2025-10-09 10:49:47,000 INFO api.risk_endpoints: \u2705 Centralized metrics calculated: Sharpe=0.93, Vol=0.22, MaxDD=-10.64%, RiskScore=75.0, RiskStructural=37.0 [Dual-Window: FI fallback only]
2025-10-09 10:49:47,000 INFO api.risk_endpoints: \U0001f3f7\ufe0f Risk dashboard metadata: user=demo, source=cointracking, taxonomy=v2:6af8d6a3
2025-10-09 10:49:47,000 INFO api.risk_endpoints: \U0001f9ea SHADOW V2 DEBUG: dashboard_data['risk_metrics']['risk_version_info'] = {'active_version': 'legacy', 'requested_version': 'v2_shadow', 'risk_score_legacy': 75.0, 'risk_score_v2': 75.0, 'sharpe_legacy': 0.9255992428851038, 'sharpe_v2': 0.9255992428851038, 'portfolio_structure_score': 83.13489929481241, 'structure_breakdown': {'hhi': 0.0, 'memecoins': 0.6391540436771669, 'gri': 16.225946661510427, 'low_diversification': 0.0, 'base': 100.0, 'total_penalties': 16.865100705187594, 'final_score': 83.13489929481241, 'inputs': {'hhi': 0.18138790259356477, 'memes_pct': 0.01597885109192917, 'gri': 3.2451893323020853, 'effective_assets': 131.99999999999997, 'top5_pct': 0.0}}, 'structure_label': 'structure_pure', 'integrated_structural_legacy': 37.0, 'integrated_breakdown_legacy': {'var95': -5.0, 'cvar95': -3.0, 'drawdown': -10.0, 'volatility': 5.0, 'risk_adjusted_perf': 0.0, 'stables': 0.0, 'concentration': 0.0, 'diversification': 0.0, 'gri': 0.0}, 'integrated_label': 'structure_plus_performance', 'blend_metadata': None}
2025-10-09 10:49:47,001 INFO crypto-rebalancer: Resolving balances for user 'demo' with source 'cointracking'
2025-10-09 10:49:47,003 INFO api.services.data_router: \U0001f464 User preference: API explicitly configured for user demo
2025-10-09 10:49:47,003 INFO crypto-rebalancer: \U0001f3af Effective source for user 'demo': cointracking_api
2025-10-09 10:49:47,010 INFO crypto-rebalancer: {"ts": 1759999787.0107296, "method": "GET", "path": "/api/risk/dashboard", "status": 200, "duration_ms": 427.65, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:49:47,010 INFO crypto-rebalancer: {"ts": 1759999787.0108602, "method": "GET", "path": "/balances/current", "status": 200, "duration_ms": 427.19, "client_ip": "127.0.0.1", "user_agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/141.0.0.0 Safari/537.36"}
2025-10-09 10:49:47,010 INFO crypto-rebalancer: GET /api/risk/dashboard -> 200 (427 ms)
INFO:     127.0.0.1:6045 - "GET /api/risk/dashboard HTTP/1.1" 200 OK
2025-10-09 10:49:47,011 INFO crypto-rebalancer: GET /balances/current -> 200 (427 ms)
INFO:     127.0.0.1:5823 - "GET /balances/current HTTP/1.1" 200 OK
WARNING:  WatchFiles detected changes in 'services\execution\governance.py'. Reloading...
