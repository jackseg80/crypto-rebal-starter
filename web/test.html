<!doctype html>
<html lang="fr">
  <meta charset="utf-8"/>
  <title>Test API</title>
  <body>
    <h1>⚠️ DEPRECATED - Use loadBalanceData() instead</h1>
    <p>Ce fichier utilise fetch() direct qui contourne l'isolation multi-user.</p>
    <p>Voir <code>static/global-config.js::loadBalanceData()</code> pour usage correct.</p>

    <h2>Test /balances/current (stub)</h2>
    <pre id="out"></pre>

    <script src="/static/global-config.js"></script>
    <script>
      // ❌ MAUVAIS - Bypass cache et headers X-User
      // fetch('/balances/current?source=stub').then(...)

      // ✅ BON - Utiliser loadBalanceData()
      (async () => {
        try {
          const result = await window.loadBalanceData(true); // forceRefresh=true
          document.getElementById('out').textContent = JSON.stringify(result, null, 2);
        } catch (error) {
          document.getElementById('out').textContent = 'Error: ' + error.message;
        }
      })();
    </script>
  </body>
</html>
